<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//GB2312-CN">
<!-- the English version was saved from url=(0037)http://www.lifewithqmail.org/lwq.html -->
<HTML><HEAD><TITLE>Life with qmail</TITLE>
<META http-equiv=Content-Type content="text/html; charset=gb2312">
</HEAD>
<BODY vLink=#0000ff link=#ff0000 bgColor=#ffffff>
<DIV class=header>
<DIV class=navigate></DIV></DIV>
<DIV class=title>
  <P><IMG src="http://www.lifewithqmail.com/logo-small.gif" width="151" height="92" align=right></P>
  <H1 class=doc-title>Life with qmail -- HTTP格式中文版</H1>
<ADDRESS class=doc-author>
  原(英)文作者: Dave Sill 
  </ADDRESS>
  <ADDRESS class=doc-modified>
  原文发布时间: 23 February 2003<br>
  原文web地址: <a href="http://www.lifewithqmail.org/lwq.html%20">http://www.lifewithqmail.org/lwq.html 
  </a> 
  </ADDRESS>
  <p>翻译：Jerry Zhou (Jerry underline ZhiJun@21cn-dot-com) <br>
    原始版权由作者Dave Sill拥有 <br>
    中文翻译版使用权由原作者和翻译者共同所有 <br>
    请不要用于商业用途. <br>
    转载, 刊登, 摘录请首先取得原作者和译者的同意 <br>
    本文版本: 目前翻译的英文版本 2003年2月23日 <br>
    <br>
    <font color="#FF00FF" size="-1">紫色小字号为译者注</font>, 包括英文原文考量和一些基础知识. <br>
    文中将统一应用英文逗号(,) 和句号(.) 以及引号(&quot;)等英文标点符号. 这个beta版本为中(GB码)英文对照HTTP格式版本, 在审核内容基本无误之后将删除英文对照部分, 
    发布完整的中文版本. 如果哪位港台同胞乐意制作Big5码的版本, 请和我联系.Jerry underline ZhiJun@21cn-dot-com. 
  </p>
  <p>如果你对里面翻译的文字有任何意见和商榷, 请e-mail译者, 我们一起来把LWQ翻译的更好! </p>
  <p>中文翻译 版本: 2003. 18. 08<br>
    <br>
    给译者信箱发送邮件, 请指定<strong>标题</strong>为&quot;<strong>For Translations of LWQ</strong>&quot;. 
    否则将被作为垃圾邮件处理, 不情之请, 希望见谅. </p>
  <p>以下为Life with qmail 中文版正文</p>
  <p> </p>
  </DIV>
<DIV class=contents>
<HR>

  <H2>目录</H2>
  <UL>
    <A href="#introduction">1. 介绍</A> 
    <UL>
      <A href="#audience">1.1. 适合阅读本文的读者</A> 
      <BR>
      <A 
    href="#whatitis">1.2. 什么是qmail?</A> <BR>
      <A 
    href="#whyuseit">1.3. 为什么用qmail?</A> 
      <BR>
      <A 
    href="#history">1.4. 发展历史</A><BR>
      <A 
    href="#features">1.5. 特点</A> <BR>
      <A href="#related-packages">1.6. 相关的软件包</A> 
      <BR>
      <A 
    href="#architecture">1.7. 体系结构</A><BR>
      <A 
    href="#license">1.8. 版权许可信息</A><BR>
      <A 
    href="#comparison">1.9. 和其他MTA相比较</A> 
      <BR>
      <A 
    href="#documentation">1.10. 文档</A><BR>
      <A 
    href="#support">1.11. 技术支持</A> 
    </UL>
    <BR>
    <A 
  href="#installation">2. 安装</A> 
    <UL>
      <A href="#installation-issues">2.1. 
      不同的安装形式以及相互的比较 </A><BR>
      <A 
    href="#preparation">2.2. 准备工作</A><BR>
      <A 
    href="#system-requirements">2.3. 系统要求</A> 
      <BR>
      <A 
    href="#download">2.4. 下载源代码</A> <BR>
      <A href="#build">2.5. 编译源代码</A> <BR>
      <A 
    href="#install-ucspi">2.6. 安装 ucspi-tcp</A> 
      <BR>
      <A 
    href="#install-daemontools">2.7. 安装daemontools</A> 
      <BR>
      <A 
    href="#start-qmail">2.8. 运行 qmail</A> 
      <BR>
      <A 
    href="#test">2.9. 测试</A> 
    </UL>
    <BR>
    <A 
  href="#configuration">3. 配置</A> 
    <UL>
      <A href="#config-files">3.1. 配置文件</A><BR>
      <A 
    href="#relaying">3.2. 中继转信</A> <BR>
      <A href="#multiple-hostnames">3.3. 
      多主机名 </A><BR>
      <A 
    href="#virtual-domains">3.4. 虚拟域</A><BR>
      <A href="#aliases">3.5. 别名</A> <BR>
      <A 
    href="#qmail-users">3.6. 关于 qmail-users</A> 
      <BR>
      <A 
    href="#spam">3.7. 反垃圾邮件</A> <BR>
      <A href="#viruses">3.8. 病毒扫描</A> 
    </UL>
    <BR>
    <A href="#usage">4. 使用方法</A> 
    <UL>
      <A href="#dot-qmail-files">4.1. .qmail 
      文件 </A><BR>
      <A 
    href="#sending-messages">4.2. 发送邮件</A><BR>
      <A 
    href="#environment-variables">4.3. 环境变量</A> 
    </UL>
    <BR>
    <A 
  href="#advanced-topics">5. 高级话题</A> 
    <UL>
      <A href="#procmail">5.1. 关于 procmail</A> 
      <BR>
      <A 
    href="#pop-imap-servers">5.2. POP 和 IMAP 
      服务器 </A> <BR>
      <A 
    href="#pop-imap-clients">5.3. POP 和 IMAP 
      客户端</A> <BR>
      <A 
    href="#multi-rcpt">5.4. Multi-RCPT 与 
      Single RCPT 传送方式的比较</A><BR>
      <A 
    href="#verp">5.5. 关于 VERP</A> <BR>
      <A 
    href="#troubleshooting">5.6. 故障处理</A> 
      <BR>
      <A 
    href="#big-servers">5.7. 大型服务器</A> <BR>
      <A 
    href="#migrating-to-qmail">5.8. 从 Sendmail 
      转移到 qmail</A> <BR>
      <A 
    href="#mailing-list-managers">5.9. 邮件列表管理器</A> 
      <BR>
      <A 
    href="#patches">5.10. 补丁</A><BR>
      <A href="#qmtp">5.11. QMTP</A> 
    </UL>
    <BR>
    <A 
  href="#acknowledgments">附录 A. 致谢</A><BR>
    <A 
  href="#related_packages">附录 B. 相关软件包介绍</A> 
    <UL>
      <A href="#dot-forward">B.1. dot-forward</A> 
      <BR>
      <A 
    href="#fastforward">B.2. fastforward</A> 
      <BR>
      <A 
    href="#ucspi-tcp">B.3. ucspi-tcp</A> 
      <BR>
      <A 
    href="#daemontools">B.4. daemontools</A> 
      <BR>
      <A 
    href="#qmailanalog">B.5. qmailanalog</A> 
      <BR>
      <A 
    href="#rblsmtpd">B.6. rblsmtpd</A> <BR>
      <A 
    href="#serialmail">B.7. serialmail</A> 
      <BR>
      <A 
    href="#mess822">B.8. mess822</A> <BR>
      <A href="#ezmlm">B.9. ezmlm</A> <BR>
      <A 
    href="#safecat">B.10. safecat</A> <BR>
      <A 
    href="#djbdns">B.11. djbdns</A> <BR>
      <A href="#maildrop">B.12. maildrop</A> 
      <BR>
      <A 
    href="#syncdir">B.13. syncdir</A> 
    </UL>
    <BR>
    <A 
  href="#how-mail-works">附录 C. 因特网邮件工作原理</A> 
    <UL>
      <A href="#from-a-to-b">C.1. 邮件如何从A点到达B点</A> 
      <BR>
      <A 
    href="#more-information">C.2. 其他资料</A> 
    </UL>
    <BR>
    <A 
  href="#architecture-apdx">附录 D. 体系结构</A> 
    <UL>
      <A href="#modular">D.1. 模块化系统结构</A> 
      <BR>
      <A 
    href="#file-structure">D.2. 文件结构</A><BR>
      <A 
    href="#queue-structure">D.3. 队列结构</A> 
      <BR>
      <A 
    href="#pictures">D.4. 图片</A> 
    </UL>
    <BR>
    <A href="#IAQ">附录 E. 一些不常见的问题</A> 
    <UL>
      <A href="#retry-schedule">E.1. qmail如何处理延期发送的邮件? 
      </A><BR>
      <A 
    href="#dns-problem">E.2. 为什么我无法给一个有很多MX记录的大站点发送邮件? 
      </A> <BR>
      <A 
    href="#queue_extra">E.3. QUEUE_EXTRA是什么? 
      </A> 
    </UL>
    <BR>
    <A 
  href="#error-messages">附录 F. 错误讯息</A> <BR>
    <A href="#gotchas">附录 G. 新手常见问题</A> 
    <UL>
      <A href="#root-delivery">G.1. qmail 
      不能给超级用户发邮件</A> <BR>
      <A 
    href="#home-dir-ownership">G.2. qmail 
      不能给没有主目录的用户发邮件</A><BR>
      <A 
    href="#uppercase-usernames">G.3. qmail 
      不能给名字含有大写字符的用户发邮件 </A><BR>
      <A 
    href="#dots-in-extensions">G.4. qmail 
      处理扩展地址的时候用冒号(:)替换掉了点(.)</A><BR>
      <A 
    href="#uppercase-in-extensions">G.5. 
      qmail 处理扩展地址的时候把大写字符转换成了小写字符</A><BR>
      <A 
    href="#etc-hosts">G.6. qmail 不使用/etc/hosts 
      文件.</A> <BR>
      <A 
    href="#no-smtp-logging">G.7. qmail 不在日志记录 
      SMTP 的活动</A><BR>
      <A 
    href="#deferral-notices">G.8. qmail 不生成邮件延迟通知 
      </A> <BR>
      <A 
    href="#trigger">G.9. qmail 由于/var/qmail/queue/lock/trigger 
      文件丢失、权限设置错误或者错误的文件属性设置等原因变的很慢</A> <BR>
      <A 
    href="#smtp-slow">G.10. DNS 或者 IDENT 
      查询使 SMTP变慢</A><BR>
      <A 
    href="#cr">G.11. 回车(Return)和换行(CRLF) 
      不同</A> <BR>
      <A 
    href="#log-block">G.12. 日志回滚造成qmail-send 
      和 tcpserver 停止</A><BR>
      <A href="#smtp-rejection">G.13.  qmail-smtpd
      不能使地址的本地部分生效</A><BR>
      <A href="#firewalls">G.14. 设置防火墙导致远程无法连接 
      SMTP/POP3/IMAP 服务器</A> <BR>
      <A 
    href="#anonymous">G.15. 如果USER 
      和 LOGNAME 没有设置的话, qmail-inject 将设置邮件发送方字段(From)为匿名(anonymous) 
      </A> 
    </UL>
    <BR>
    <A 
  href="#lwq-faq">附录 H. <U>关于本文Life with 
    qmail 的常见话题</U></A> 
    <UL>
      <A href="#lwq-version">H.1. <U>这个Life 
      with qmail</U> 的版本是多少?</A> <BR>
      <A 
    href="#lwq-copyright">H.2. <U>谁拥有Life 
      with qmail</U>?</A> <BR>
      <A 
    href="#lwq-license">H.3. <U>Life with 
      qmail</U> 的版权信息?</A> <BR>
      <A 
    href="#lwq-announce-list">H.4. 我怎么取得新版 
      LWQ 的发布通知?</A> <BR>
      <A 
    href="#lwq-list">H.5. 在哪里可以为 LWQ 投稿, 
      捐助以及讨论它?</A> <BR>
      <A 
    href="#lwq-translations">H.6. <U>Life 
      with qmail</U> 被翻译成其他语言了吗?</A> <BR>
      <A 
    href="#lwq-formats">H.7. <U>Life with 
      qmail</U> 有没有 PostScript, PDF, plain text, 或者其他任何除了HTML的格式?</A> <BR>
      <A 
    href="#lwq-warranty">H.8. <U>我按照 Life 
      with qmail</U> 说的作了, 可是我的系统崩溃了, 或者弄坏了我的硬盘, 或者毁了我的爱情, 或者弄死了我的狗, 等等问题, 我该怎么办?</A> 
      <font color="#FF00FF" size="-1">(这属于老外的幽默啦. ^_^, 译者注)</font><BR>
      <A 
    href="#contributions">H.9. 我怎么为 LWQ捐赠和投稿?</A> 
    </UL>
  </UL>
</DIV>
<DIV class=main>
<HR>

<H1><A name=introduction>1. 介绍</A></H1>
<H2><A name=audience>1.1. 适合阅读本文的读者</A></H2>
  <P><U>Life with qmail</U> 的目标读者是那些对qmail有兴趣, 却被归类于业余爱好者, 新手的人, 那些在一台<font color="#000000">空闲</font><font color="#FF00FF" size="-1">(原文为: 
    a spare PC 译者注)</font>PC机上操作Linux, 希望日后成为经验丰富的系统管理员或邮件系统管理员的人写作的. 如果你发现文章中有缺陷或者不清楚的地方, 
    请用电子邮件告诉我. (英文) lwq at sill dot org.<font color="#FF00FF" size="-1"> (译者的电子邮件: 
    Jerry underline ZhiJun@21cn-dot-com 译者注).</font></P>
  <P>各种不同的来源存在着丰富的 qmail相关信息. 其中一些是以新手为目标, 另外一些假定读者具有比较多的经验, <U>Life with qmail</U> 
    就是一篇试图成为&quot;胶水&quot;性质的文章, 集合这些信息为一体, 不过读者必须首先掌握下面这些基础知识: </P>
<UL>
    <LI>在UNIX环境下熟练的操作文件和目录的能力 
    <LI>会使用web浏览器和FTP客户端软件 
    <LI>能够读懂下面的使用方法 </LI>
</UL>
<H2><A name=whatitis>1.2. 什么是 qmail?</A></H2>
  <P>qmail是一个因特网邮件传送代理, <font color="#FF00FF" size="-1">(英文: Mail Transfer Agent, 
    简写为MTA, 译者注)</font> 它运行在UNIX兼容系统下, 是一个直接代替UNIX下 Sendmail软件的邮件传送程序. qmail 使用简单报文传送代理协议 
    SMTP 传输邮件(Simple Mail Transfer Protocol). </P>
<P>
  <HR align=left width="80%">
  <STRONG>注意: </STRONG>它的名字是 "qmail" , 而不是 "Qmail". 
  <HR align=left width="80%">

<P></P>
<H2><A name=whyuseit>1.3. 为什么用 qmail?</A></H2>
  <P>你的操作系统如果包含一个MTA, 那很有可能是Sendmail, 而你阅读了下面的文档之后, 你可能想(抛弃Sendmail, 另外)找一个更好的MTA了. 
  </P>
<p></p>
<H3><A name=security>1.3.1. 安全</A></H3>
  <P><I>qmail</I> 是面向安全而设计的. <I>Sendmail</I> 的历史上出现过很多严重的安全问题. 在编写Sendmail的时代, 
    网络是非常友好的地方, 每个在网上交流的人都能够很容易的了解对方, 几乎没有必要为了安全而设计软件, 编写代码. 而现在的因特网对于网络服务器却是险象丛生. 
    Eric Allman, Sendmail的作者, 为了加强Sendmail的安全做了很多工作, 但是无论如何, 除了重新设计, 怎样的修正也不能让Sendmail达到真正的安全. 
  </P>
  <P>&nbsp; </P>
<H3><A name=performance>1.3.2. 性能</A></H3>
  <P>qmail 并行处理邮件传送, 缺省配置情况下, 能够达到20个并行邮件同时传送. </P>
<H3><A name=reliability>1.3.3. 可靠性</A></H3>
  <P>qmail保证已经接收的新邮件不被丢失, qmail使用一种新的邮箱格式, 其可靠性超过了没有文件锁的NFS存储系统. </P>
<H3><A name=simplicity>1.3.4. 简单Simplicity</A></H3>
  <P>qmail 比其他实现同样功能的MTA都要小.<I> </I></P>
<p></p>
<P>
  <HR align=left width="80%">
  <STRONG>注意: </STRONG>qmail 的正式主页, <A 
href="http://cr.yp.to/qmail.html">http://cr.yp.to/qmail.html</A> 有更多的 qmail 特色介绍. 
  <HR align=left width="80%">

<P></P>
  <H2><A name=history>1.4. 发展历史</A></H2>
<P>qmail由 Dan Bernstein (DJB)博士编写, 他的主页 <A 
href="http://cr.yp.to/djb.html">http://cr.yp.to/djb.html</A><I> . </I>他现在任职于 Illinois 
    大学 Chicago 分校数学教授. 它在密码术研究方面的工作, 以及他关于密码术源代码的出版问题对美国政府的诉讼也是很有名的, 关于这次诉讼的新闻详见 
    <A 
href="http://www.news.com/News/Item/0,4,36217,00.html?owv">http://www.news.com/News/Item/0,4,36217,00.html?owv</A> 
    或 <A href="http://cr.yp.to/export.html">http://cr.yp.to/export.html</A> 查看关于诉讼的信息. 
  </P>
  <P>第一个公开发行的 qmail 版本是1996年1月24日发表的 0.70 beta 版. 第一个 gamma 发行版是在1996年8月1日的0.90版. 
  </P>
  <P>第一个常规发行版本是1.0, 时间是1997年2月20日. 现在使用的1.03版本, 发行于1998年6月15日. </P>
  <P>预期下一个版本将是2.0评估版, 即将在2.0版里面出现的一些新功能可以在<A 
href="http://cr.yp.to/qmail/future.html">http://cr.yp.to/qmail/future.html</A> 
    找到. </P>
  <H2><A name=features>1.5. 特点 </A></H2>
  <P>qmail 的web页 <A 
href="http://cr.yp.to/qmail.html">http://cr.yp.to/qmail.html</A> 列出了非常全面的qmail的特点. 
    本节即针对这个页面列出的特点予以着重介绍. </P>
  <H3><A name=feature-setup>1.5.1. 安装</A></H3>
<UL>
    <LI>自动适应于UNIX的各种版本
    <LI>自动适应于单主机配置
    <LI>快速安装--不必作大量的配置工作</LI>
</UL>
  <H3><A name=feature-security>1.5.2. 安全 </A></H3>
<UL>
    <LI>地址, 文件以及程序之间分隔清晰
    <LI>最少限度的应用setuid方式
    <LI>最少限度的应用root权限
    <LI>五个不同安全权限分级运行<font color="#FF00FF" size="-1">(指利用五个分隔的uid运行qmail的不同功能模块. 译者注)</font>
    <LI>可选的邮件单向散列计算功能, 包括整个邮件内容的hash计算等功能. (参考 附录 E 的<a href="#queue_extra">什么是 QUEUE 
      EXTRA?</a>) </LI>
</UL>
  <H3><A name=feature-messcon>1.5.3. 邮件结构 </A></H3>
<UL>
    <LI>符合<A href="#rfcs">RFC 822</A> 和<A 
  href="#rfcs">RFC 1123</A> 标准. 
    <LI>邮件地址组的完整支持. 
    <LI>自动转换旧格式地址为RFC 822 格式. 
    <LI>支持sendmail命令, 与目前的邮件用户代理兼容. 
    <LI>仅受限于内存大小的长邮件头支持. 
    <LI>主机伪装(参见 <A 
  href="#defaulthost">defaulthost</A>)
    <LI>用户伪装(参见 <A 
  href="#MAILUSER">MAILUSER</A>和 <a 
  href="#MAILHOST">MAILHOST</a>)
    <LI>自动生成邮件跟踪列表(参见 <a 
  href="#QMAILMFTFILE">QMAILMFTFILE</a> ) </LI>
</UL>
  <H3><A name=feature-smtpserv>1.5.4. SMTP 服务 </A></H3>
  <UL>
    <LI>兼容<A href="#rfcs"> RFC 821, RFC 1123, RFC 1651, RFC 1652, 和 RFC 1854</A> 
      标准 
    <LI>全 8-bit 操作<font color="#FF00FF" size="-1">(qmail直接对邮件进行8bit操作. 译者注)</font> 
    <LI>支持 <A href="#rfcs">RFC 931/1413</A>/ident/TAP 回查--用来跟踪垃圾邮件和伪造邮件 <A href="#rfcs"> 
      </A> 
    <LI>转信控制--阻止未授权的外来转信请求. 
    <LI>转信控制与别名无冲突. 
    <LI>自动识别本地IP地址. 
    <LI>每缓冲超时 
    <LI>跃点计算 
    <LI>并行访问限制(通过 <A 
  href="#ucspi-tcp">ucspi-tcp</A>) 
    <LI>对已知的垃圾邮件发送者, 拒绝连接(通过 <A 
  href="#ucspi-tcp">ucspi-tcp</A>) 
    <LI>支持授权用户转信和消息重写 
    <LI>可选的黑洞名单(Realtime Blackhole List, RBL)和开放转信系统修正(Open Relay Behavior-modification 
      System, ORBS) 支持(通过 <A 
  href="#rblsmtpd">rblsmtpd</A>)</LI>
  </UL>
  <H3><A name=feature-queueman>1.5.5. 队列管理</A></H3>
<UL>
    <LI>对加入队列的邮件即时处理
    <LI>并行处理限定 
    <LI>分割队列目录--队列很大时不降低处理速度 
    <LI>二次幂重试时间表排定算法--队列内越陈旧的消息得到的发送机会相对新消息越小 (参考 <a href="#retry-schedule">附录 
      E</a>) 
    <LI>每个邮件独立的重试时间表
    <LI>自动安全队列--系统崩溃情况下不丢失邮件. 
    <LI>自动每邮件接收者检查 
    <LI>自动队列清除
    <LI>队列观察(参看 qmail-qread) 
    <LI>详细的传送过程分析 (通过 <A 
  href="#qmailanalog">qmailanalog</A>) </LI>
</UL>
  <H3><A name=feature-bounces>1.5.6. 邮件反弹 </A></H3>
<UL>
    <LI>QSBMF反弹邮件--包括机器易读和人类易读两种格式 
    <LI>HCMSSC 支持--不受语言约束的<A 
  href="#rfcs"> RFC 1893</A> 错误代码 
    <LI>发送两次反弹邮件给系统管理员(postmaster) </LI>
</UL>
  <H3><A name=feature-routing>1.5.7. 基于域名的邮件路由 </A></H3>
<UL>
    <LI>支持任意数量的本地主机名(参看 <A 
  href="#locals">locals</A>) 
    <LI>支持任意数量的虚拟域 (参看 <A 
  href="#virtualdomains"> virtualdomains</A>) 
    <LI>支持域名通配符 (参看 <A 
  href="#virtualdomains">virtualdomains</A>) 
    <LI>可配置的&quot;percent hack&quot;支持 (参看 <A 
  href="#percenthack">percenthack</A>) 
    <LI>UUCP 钩 (UUCP hook) </LI>
</UL>
  <H3><A name=feature-smtpdeliv>1.5.8. SMTP 传输 </A></H3>
<UL>
    <LI>兼容 <A href="#rfcs"> RFC 821, RFC 974, 和 RFC 1123 协议</A> 
    <LI>全8-bit字符支持 
    <LI>对关闭主机自动补偿 
    <LI>人工路由--smarthost, localnet, mailertable (参考 <A 
  href="#smtproutes">smtproutes</A>) 
    <LI>每缓冲超时 
    <LI>被动SMTP队列--对(低速)SLIP/PPP线路的完美支持 (通过 <A 
  href="#serialmail">serialmail</A>) 
    <LI>Auto TURN支持 (通过 <A 
  href="#serialmail">serialmail</A>) </LI>
</UL>
  <H3><A name=feature-forwardlists>1.5.9. 转发和邮件列表 </A></H3>
<UL>
    <LI>兼容Sendmail的 .forward控制文件(通过 <A 
  href="#dot-forward">dot-forward</A>). 
    <LI>散列的转发数据库(通过 <A 
  href="#fastforward">fastforward</A>) 
    <LI>兼容Sendmail的 /etc/aliases 控制文件(通过 <A 
  href="#fastforward">fastforward</A>) 
    <LI>地址通配符 (参见 <A 
  href="#extension-addresses">.qmail-default</A>) 
    <LI>邮件列表所有者--自动转移反弹邮件和假期邮件 
    <LI>VERPs--自动邮件列表反弹邮件接收者识别 
    <LI>自动防止循环成环邮件传送, 甚至可以避免对于交叉并联主机的配置方式成环邮件传送 </LI>
</UL>
  <H3><A name=feature-localdeliv>1.5.10. 本地(邮件)传送 </A></H3>
<UL>
    <LI>支持用户控制的地址分级--任意FRED<font color="#FF00FF" size="-1">(Fast Random Enquiry 
      Display 快速随 机询问显示, 译者注) </font>mbox传送 
    <LI>可靠的NFS传输(参见 <A 
  href="#maildir-delivery">maildir</A>) 
    <LI>支持用户可控的邮件程序传送, 比如procmail等, (参见 <A 
  href="#program-delivery">qmail-command</A>) 
    <LI>可选的新邮件通知(参见 qbiff) 
    <LI>可选的NRUDT返回收条(参见 qreceipt) 
    <LI>条件过滤(参见 condredirect 和 bouncesaying) </LI>
</UL>
  <H3><A name=feature-pop3>1.5.11. POP3 服务 </A></H3>
<UL>
    <LI>兼容<A href="#rfcs"> RFC 1939 </A>
    <LI>支持UIDL 
    <LI>支持TOP 
    <LI>APOP钩 
    <LI>模块化的密码检查(通过 <A 
  href="http://www.qmail.org/top.html#checkpassword">checkpassword</A>) </LI>
</UL>
  <H2><A name=related-packages>1.6. 相关的软件包</A></H2>
  <P>qmail遵循经典UNIX哲学: 每个软件工具都要有专一的, 规范良好的功能; 而复杂的功能应该由一系列多个独立的简单工具联合完成, 形成一个&quot;流水线&quot;模式. 
    另外一种方式是在更为简单的工具上不断的建立和丰富越来越复杂的的功能来完成大量的复杂的功能.</P>
  <P> qmail并没有拥有所有人要求的任意功能, 这点并不令人惊讶惊讶. 相反的, qmail拥有的是一些实现那些功能的流行的插件(add-ons). 当然了, 
    许多标准UNIX实用工具也都可以作为插件和qmail协同工作. 下面介绍一些插件: </P>
<UL>
    <LI><a href="#dot-forward">dot-forward</a> --一个兼容Sendmail的.forward控制文件的插件
    <LI><A 
  href="#fastforward">fastforward</A> -- 一个兼容Sendmail别名数据库的插件 
    <LI><A 
  href="#ucspi-tcp">ucspi-tcp</A> -- 一个inetd超级服务器的替换程序 
    <LI><A 
  href="#daemontools">daemontools</A> -- 一个管理后台服务程序以及日志的工具套件 
    <LI><a href="#qmailanalog">qmailanalog</a> -- 一个qmail日志文件分析工具套件 
    <LI><a href="#serialmail">serialmail</a> -- 用于低速网络邮件传送的工具 
    <LI><a href="#mess822">mess822</a> -- 剖析因特网邮件的工具 
    <LI><a href="#ezmlm">ezmlm</a> -- 一个基于qmail的管理邮件列表的工具 </LI>
</UL>
  <H2><A name=architecture>1.7. 体系结构 </A></H2>
  <P><a href="#architecture-apdx">附录 D</a> 介绍了qmail的功能和结构. 简单的说, qmail包含了一系列的程序(模块)来完成不同的任务. 
  </P>
  <H2><A name=license>1.8. 版权许可信息</A></H2>
  <P>qmail的版权由作者Dan Bernstein所有, qmail没有和用户权利声明一同发布. 在web页面 <A 
href="http://cr.yp.to/softwarelaw.html">http://cr.yp.to/softwarelaw.html</A> 上, 
    作者Dan Bernstein概要陈述了他认为用户在美国版权法下拥有的权利和义务. 在web页 <A 
href="http://cr.yp.to/qmail/dist.html">http://cr.yp.to/qmail/dist.html</A> 上描述了作者授权给qmail的源代码分发用户的权利和义务. 
    二进制发行遵循条款在下面这个web页面上可以找到 <A 
href="http://cr.yp.to/qmail/var-qmail.html">http://cr.yp.to/qmail/var-qmail.html</A>.<I> 
    </I></P>
  <P>发行权限的最底线: 你<strong>可以</strong>将qmail用于任何用途, 你可以再次分发<em>未修改</em>的qmail源代码和有资格的<em>var-qmail</em>二进制发行包, 
    你也可以发行qmail补丁程序. 但是你<strong>不能</strong>发行修改过的qmail源代码和<em>non-var-qmail</em>二进制发行包. 
  </P>
  <H2><A name=comparison>1.9. 和其他MTA相比较 </A></H2>
  <P>这个题目完全可以写一本书啦. 不过可能是很单调乏味的一本. 这里给出一个qmail和其他最常见的UNIX MTA的快速比较表格<font color="#FF00FF" size="-1">(中: 
    medium, 高: high, 低: low, 是: yes, 否: no, 插件: addons, 可选的: optional. 译者注) </font></P>
<TABLE class=columns border=1>
  <TBODY>
    <TR class=heading> 
      <TD><STRONG>MTA</STRONG> </TD>
      <TD><strong>成熟度</strong></TD>
      <TD><strong>安全性</strong> </TD>
      <TD><strong>特色</strong></TD>
      <TD><STRONG>性能</STRONG></TD>
        <TD><STRONG>是否兼容Sendmail</STRONG> </TD>
      <TD><STRONG>模块化</STRONG> </TD>
    </TR>
    <TR> 
      <TD><I>qmail</I> </TD>
      <TD>中</TD>
      <TD>高</TD>
      <TD>高</TD>
      <TD>高</TD>
      <TD>插件</TD>
      <TD>是</TD>
    </TR>
    <TR> 
      <TD><I>Sendmail</I> </TD>
      <TD>高</TD>
      <TD>低</TD>
      <TD>高</TD>
      <TD>低</TD>
      <TD>-</TD>
      <TD>否</TD>
    </TR>
    <TR> 
      <TD><I>Postfix</I> </TD>
      <TD>中</TD>
      <TD>高</TD>
      <TD>中</TD>
      <TD>高</TD>
      <TD>是</TD>
      <TD>是</TD>
    </TR>
    <TR> 
      <TD><I>exim</I> </TD>
      <TD>中</TD>
      <TD>低</TD>
      <TD>高</TD>
      <TD>中</TD>
      <TD>是</TD>
      <TD>否</TD>
    </TR>
    <TR> 
      <TD><I>Courier</I> </TD>
      <TD>低</TD>
      <TD>中</TD>
      <TD>高</TD>
      <TD>中</TD>
      <TD>可选的</TD>
      <TD>是</TD>
    </TR>
  </TBODY>
</TABLE>
  <P>兼容Sendmail意思是MTA运转是否类似于Sendmail, 从而可以在某种用户透明度上从此MTA和Sendmail之间过渡和切换, 比如.forward控制文件, 
    /etc/aliases文件以及是否传送邮件到目录 /var/spool/mail等等行为. <I> </I></P>
  <P>Jonathan de Boyne Pollard 曾经回顾了很多UNIX下的MTA, web页面在<A 
href="http://homepages.tesco.net/~J.deBoynePollard/Reviews/UnixMTSes/">http://homepages.tesco.net/~J.deBoynePollard/Reviews/UnixMTSes/</A> 
    . 另外一个很详细的的比较文章请参考<A 
href="http://www.geocities.com/mailsoftware42/">http://www.geocities.com/mailsoftware42/</A>. 
  </P>
  <H2><A name=documentation>1.10. 文档 </A></H2>
  <H3><A name=man-pages>1.10.1. man 帮助手册 </A></H3>
  <P>qmail发行包包含了完整的man手册. 安装qmail之后, 他们通常位于 /var/qmail/man. 你可能需要自己手动增加这个手册目录路径到你的环境变量MANPATH里面. 
  </P>
<TABLE class=columns border=1>
  <TBODY>
  <TR class=heading>
        <TD><STRONG>Shell 解释器</STRONG></TD>  <TD><STRONG>命令行</STRONG></TD>
    </TR>
  <TR>
    <TD>Bourne (/bin/sh) </TD>
    <TD>MANPATH=$MANPATH:/var/qmail/man; export MANPATH </TD></TR>
  <TR>
    <TD>bash, Korn </TD>
    <TD>export MANPATH=$MANPATH:/var/qmail/man </TD></TR>
  <TR>
    <TD>C Shell </TD>
    <TD>setenv MANPATH $MANPATH:/var/qmail/man </TD></TR></TBODY></TABLE>
  <P><font color="#FF00FF" size="-1">(上面表格为各个不同shell下运行的增加环境变量的命令行格式, 故不予翻译, 用户也可以参考man 
    man来查阅直接指定man的指定目录开关的设定, 在Bourne下, 这个开关一般是 -M.译者注)</font> (修改环境变量之后) 用型如&quot;man 
    name-of-qmail-man-page&quot;的命令格式即可调出相关的手册页面. </P>
  <P> 也可以访问man手册页面的在线web页面形式, 地址是:</P>
<UL>
  <LI><A 
  href="http://www.qmail.org/man/index.html">http://www.qmail.org/man/index.html</A></LI></UL>
<P>
<HR align=left width="80%">
  <STRONG>注意:</STRONG> qmail的man手册页面承载了大量的信息, 它的写作语言偏重技术术语, 可能相当晦涩难懂, 必须仔细加以研读. 
  你可能需要通读一遍来熟悉它. 因为很少有重复性的内容, 你必须首先知道里面都写了哪些内容,以及你感兴趣的那些内容在哪里, 否则你可能根本找不到你要的东西.<strong> 
  </strong>
<HR align=left width="80%">

<P></P>
  <H3><A name=docs>1.10.2. 文档 </A></H3>
  <P>qmail发行版包含了一系列文档, 通常安装在/var/qmail/doc目录下. 它们包括以下内容: <font color="#FF00FF" size="-1">(本文中默认的两个位置,一个就是文档的根位置/var/qmail/doc, 
    这个位置的文档也通常被作者描述为qmail源代码文件目录下的doc文档, 内容是一致的. 还有一个就是qmail 的安装后的主目录下的控制文档, 通常为/var/qmail/control下面, 
    在很多情况下, 作者并不明确指出这两个具体位置. 译者注)</font></P>
<UL>
    <LI>FAQ: 常见问题以及回答. 
    <LI>INSTALL.* 文件集: 安装文档. 
    <LI>PIC.*文件集: 描述了qmail如何完成核心任务的文档. 查找更多相关信息, 请参看附录<a href="#pictures">体系结构</a>. 
      
    <LI>其他几个安装相关文档. </LI>
</UL>
  <P>这些文档也可以在线查看, 请到web页面: </P>
<UL>
  <LI><A 
  href="http://www.qmail.org/man/index.html">http://www.qmail.org/man/index.html</A></LI></UL>
<H3><A name=faqs>1.10.3. 常见问题 FAQs</A></H3>
  <P>有两个正式的常见问题(Frequently Asked Questions, FAQ. 附相关回答)文档: </P>
<UL>
    <LI>/var/qmail/doc/FAQ 目录下, 纯文本版本, 以及 
    <LI>web页面FAQ, 地址: <A 
  href="http://cr.yp.to/qmail/faq.html">http://cr.yp.to/qmail/faq.html</A>. </LI>
</UL>
  <P>web页面的FAQ更完整一些. </P>
  <H3><A name=book>1.10.4. 书籍</A></H3>
  <H4><A name=qmail-handbook>1.10.4.1. <U>qmail 手册 (英文书名: The qmail Handbook) </U></A></H4>
  <P>作者Dave Sill, 也是本文<u>Life with qmail</u>的作者, 曾经为Apress(<A href="http://www.apress.com/">http://www.apress.com/</A>)出版社撰写了一本qmail书籍. 
    这本<U>qmail 手册 (英文书名: The qmail Handbook)</U>, 包括了本文所有内容, 某些方面更为详细, 同时也介绍了大量的新领域. </A> 
  </P>
  <P>更多信息, 请参看 <A 
href="http://www.apress.com/catalog/book/1893115402/">http://www.apress.com/catalog/book/1893115402/</A>. 
    需要定购本书, 请参看 <A 
href="http://www.amazon.com/exec/obidos/ASIN/1893115402/davesill">http://www.amazon.com/exec/obidos/ASIN/1893115402/davesill</A>. 
  </P>
  <H4><A name=oreilly-book>1.10.4.2. <U>qmail (英文书名: qmail) </U></A></H4>
  <P>据报道, John Levine为O'Reilly &amp; Associates (<A href="http://www.oreilly.com/">http://www.oreilly.com/</A>).出版社写作的一本qmail书籍. 
  </P>
  <H4><A name=sams-book>1.10.4.3. <U>Running qmail (英文书名: Running qmail) </U></A></H4>
  <P>作者Richard Blum, Sams出版. 这本书被认为接受了很多qmail的邮件列表里面的不同观点. </P>
  <P>定购本书, 请参看 <A 
href="http://www.amazon.com/exec/obidos/ASIN/0672319454/davesill">http://www.amazon.com/exec/obidos/ASIN/0672319454/davesill</A>. 
  </P>
  <H3><A name=list-archives>1.10.5. 邮件列表文档 </A></H3>
  <P>qmail的邮件列表, 由Dan Bernstein 维护, 极为有价值的信息来源. web文档保存在以下位置: </P>
<UL>
  <LI><A 
  href="http://www.ornl.gov/its/archives/mailing-lists/qmail/">http://www.ornl.gov/its/archives/mailing-lists/qmail/</A>.</LI></UL>
  <P>这个文档的一个搜索引擎位置在: </P>
<UL>
  <LI><A 
  href="http://www-archive.ornl.gov:8000/">http://www-archive.ornl.gov:8000/</A>.</LI></UL>
  <P>其他web文档可以在以下地址访问到: </P>
<UL>
  <LI><A 
  href="http://www.egroups.com/list/djb-qmail/?refstop=1">http://www.egroups.com/list/djb-qmail/?refstop=1</A> 
    和
<LI><A 
  href="http://msgs.securepoint.com/qmail/">http://msgs.securepoint.com/qmail/</A>.</LI></UL>
  <P>大多数关于qmail的问题的答案都可以首先在这个邮件列表的文档里面搜索到. </P>
  <H3><A name=other-web-sites>1.10.6. 其他Web站点 </A></H3>
<UL>
    <LI><A href="http://cr.yp.to/qmail.html">http://cr.yp.to/qmail.html</A> : qmail的正式主页. 
    <LI><A href="http://www.qmail.org/">http://www.qmail.org/</A>. qmail的非正式主页. 
      包含了大量关于功能插件和补丁的信息, 以及很多很棒的关于qmail的web页面的链接. 
    <LI><A 
  href="http://www.flounder.net/qmail/qmail-howto.html">http://www.flounder.net/qmail/qmail-howto.html</A>: 
      Adam McKenna 制作的HOWTO.</LI>
</UL>
  <H2><A name=support>1.11. 技术支持 </A></H2>
  <H3><A name=mailing-lists>1.11.1. 邮件列表 </A></H3>
  <P>下面的这些列表位于主机 list.cr.yp.to. 为了防止被发送垃圾邮件者获取地址, 我没有使用完整有效的邮件地址, 以及&quot;mailto&quot;格式的URL.<font color="#FF00FF" size="-1">(这里隐去了真实的listname, 
    具体请参看qmail的正式主页介绍或者查看1.11.1.节, 也就是本节的几个小节的带有下划线的英文标题名字, 译者注)</font> </P>
  <P>这些邮件列表由ezmlm管理, 使用不同的地址实现不同的功能. </P>
<UL>
    <LI><I>listname</I>@list.cr.yp.to: 订阅地址. 发送到这个地址的邮件将会被发送给列表的所有用户. 
      请<strong>不要</strong>发送订阅和退订要求到这个地址, 这样作是无效的, 而且还会打扰其他订阅者. <I> </I>
    <LI><I>listname</I>-help@list.cr.yp.to: 这是&quot;帮助&quot;地址. 发送邮件到这个地址将会返回使用信息.<I> 
      </I>
    <LI><I>listname</I>-subscribe: 发送空消息到这个地址订阅列表. 
    <LI><I>listname</I>-unsubscribe: 发送空消息到这个地址退订列表.</LI>
</UL>
  <P>举例, 一个订阅或者退订地址, 比如 joe@example.com, 发送邮件到这个地址订阅列表: </P>
<UL>
  <LI><I>listname</I>-subscribe-joe=example.com@list.cr.yp.to.</LI></UL>
<H4><A name=qmail-list>1.11.1.1. <U>qmail</U></A></H4>
  <P>这是一个主要的qmail邮件列表.讨论和提问/回答很多有关于qmail的问题. 不过不包括有关于他们自己的列表的问题. 在这个列表提问之前请阅读Charles 
    Cazabon的"12 Steps to qmail List Bliss" web页面位置 <A 
href="http://www.qcc.sk.ca/~charlesc/writings/12-steps-to-qmail-list-bliss.html">http://www.qcc.sk.ca/~charlesc/writings/12-steps-to-qmail-list-bliss.html</A> 
    .同时请首先阅读FAQ或者<a href="#list-archives">在这里</a>搜索列表的过去的文章. 提问的时候, 请尽量包含充分详尽的细节, 
    便于其他人回答. 请注意以下这些提问要点: </P>
<UL>
    <LI><B><I>你做了什么? </I></B>你的配置? 如果你不清楚哪些比较重要, 那就把qmail-showctl 的输出算上. 你都做了那些举动? 
      如果是新安装的qmail, 讲述一下你如何安装的. 
    <LI><B><I>你期待发生什么? </I></B>你想达到一个什么目的? 不要假设读者会猜到你的想法. 
    <LI><B><I><u>曾经</u>发生了什么? </I></B>描述一下实际的结果. 包括log文件的部分剪辑, 消息的副本, 包括头部分. <B></B></LI>
</UL>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>qmail的邮件列表使用了一个叫做qsecretary的工具来校验投递到列表的邮件是否是垃圾邮件. 每封到达列表的邮件都会首先由qsecretary返回一个确认邮件. 
  用户阅读确认邮件并且按照返回邮件上的指令确认你的邮件--通常就是回复qsecretary的确认信息就可以了. 经常在列表投递的订户一般使用类似Charles 
  Cazabon<I>的pymsgauth</I> (<A 
href="http://www.qcc.ca/~charlesc/software/pymsgauth/pymsgauth.html">http://www.qcc.ca/~charlesc/software/pymsgauth/pymsgauth.html</A>.) 
  的自动回复程序来自动完成邮件确认. <I>pymsgauth </I>校验发往列表的邮件的确是你发出的, 所以它不会确认那些冒充你的名字发送到列表的邮件.<I> 
  </I><STRONG> </STRONG>
<P></P>
<P>
<HR align=left width="80%">

<P></P>
<H4><A name=qmailannounce-list>1.11.1.2. <U>qmailannounce</U></A></H4>
  <P>qmail的公告邮件列表. 没有投稿地址, 这是个只读的列表. </P>
<H4><A name=serialmail-list>1.11.1.3. <U>serialmail</U></A></H4>
  <P>讨论<I>serialmail</I> 软件的列表. </P>
<H4><A name=ezmlm-list>1.11.1.4. <U>ezmlm</U></A></H4>
  <P><I>ezmlm</I> 邮件列表管理器的的讨论列表. </P>
  <H3><A name=consultants>1.11.2. 咨询者 </A></H3>
<P>参看 <A 
href="http://www.qmail.org/top.html#paidsup">http://www.qmail.org/top.html#paidsup</A> 
    的商业支持提供者名单. </P>
  <H3><A name=faqts>1.11.3. FAQTS 知识库 </A></H3>
<P><A 
href="http://qmail.faqts.com/">http://qmail.faqts.com/</A> 一个qmail相关问题的数据库, 包括问题解答.如果你在FAQ里面找不到回答, 
    试试搜索这个知识库. 它的专长在于回答&quot;如何去作&quot;的问题. </P>
  <HR align="left">

  <H1><A name=installation>2. 安装 </A></H1>
  <P>这一节介绍qmail的安装. 如果你是个经验丰富的系统管理员, 你完全可以按照qmail的发布源文件里面的INSTALL文件的指导完成安装. INSTALL文件并不是<strong>正式</strong>的安装指导. 
    哪个指导比 <U>Life with qmail</U>, 也就是本文的指导复杂很多. INSTALL文件假定读者是一个经验丰富的系统管理员或者邮件管理员. 
    而且那个文件也比较陈旧, 反映不了Bernstein(qmail作者)最近的操作规程建议. </P>
<P>
<HR align=left width="80%">
  <STRONG>注意:</STRONG> 如果你选择使用下面的安装指导, 请你一定要通读下面整个小节以熟悉全部安装过程. <STRONG> </STRONG>
<HR align=left width="80%">

<P></P>
  <H2><A name=installation-issues>2.1. 不同的安装发布形式以及相互的比较 </A></H2>
  <H3><A name=binary-vs-source>2.1.1. 二进制安装对比源代码安装 </A></H3>
  <P>由于qmail关于预先编译包的限制性的许可, 通常qmail都是由源代码安装的. </P>
  <P>如果你不是很熟悉源代码和二进制的区别, 想像一下你订了一个pizza饼. &quot;二进制&quot;形式的pizza饼送来了立刻就能吃, 而&quot;源代码&quot;pizza饼就像全部制作pizza的材料, 
    面粉, 发酵粉, 干酪, 沙司还有浇头调料, 以及烹饪pizza的指导, 你必须自己作pizza. 虽然有点费劲, 不过如果你仔细的按照指导来作, 
    结果是一样的, 甚至更好. 自己作的pizza更新鲜, 你也可以按照自己的配置调整浇头调料, 并且你更多的了解了你的pizza以及它是如何&quot;工作&quot;的. 
  </P>
  <P>安全的运行一个因特网服务并不容易. 一个不适当配置的服务可能给你的主机系统带来被攻击以及被用来攻击其他站点的风险--有可能让管理员承担法律责任的安全风险. 
    更多的知道你的网络服务如何运行的, 就更有可能让他们正确和安全的工作. </P>
  <H3><A name=tar-vs-package>2.1.2. Tarball 对比 特定操作系统安装包 (Tarball vs. OS-specific 
    package) </A></H3>
  <P>一些操作系统提供一种自动源代码安装机制. 回到上文我们的pizza制作分析里面. 这就好像把所有的pizza的成分和制作指导都打包到一起, 这样你简单的按一下按钮pizza就能把自己烤好啦. 
  </P>
  <P>觉得这样作很不错, 是吧? </P>
  <P>实际上, 那可不是一个想当然的好主意. 组装这些包是个相当困难的工作, 它们有时并不是按照假定的方式工作的. 这是软件, 而且和其他软件一样, 他们会有bugs. 
    即使不提那些bugs, 那些安装的方便也是用牺牲你自己烤的pizza饼的很多优点来达到的. 比如你自己调整浇头调料的的能力, 还有知道怎么作pizza饼, 
    以及pizza如何工作等等. </P>
  <P>如果qmail仅仅是一个pizza, 哪自安装方式还是可以接受的. 不过qmail可是个相当复杂的系统. 安装和维护qmail的人都需要对它相当的了解才能平稳的运行它. 
    自安装方式的qmail更容易安装, 不过用户手动安装方式更容易调整配置和查找故障. 你可能就安装一次qmail, 但是你可能要几次才能调整好它, 或者当邮件并不是按照你想要的方式运行的时候, 
    设法找出并解决问题. </P>
  <P>由于这些原因, 我建议使用源代码的tarball方式安装, 而不是Red Hat RPM或者其他自安装包方式. </P>
  <H2><A name=preparation>2.2. 准备工作 </A></H2>
  <P>安装qmail之前, 尤其如果是你第一次安装qmail, 有几个需要注意的地方. </P>
<UL>
    <LI>如果可能, 尽量在一个&quot;试验&quot;系统上安装qmail. 这样的话可以有机会犯错, 不至于在正在工作的服务器上安装时丢失重要的邮件或者中断mail服务. 
    <LI>如果你没有空闲的计算机系统, 而你要安装的系统上面已经运行sendamil, smail或者其他的MTA投递邮件的时候, 你可以安装大部分的qmail而不中断现有的邮件服务.
    <LI>如果从其他MTA移植到qmail--即使你在qmail上已经很有经验--首先制订一个计划, 也是非常必要的. </LI>
</UL>
  <H2><A name=system-requirements>2.3. 系统要求 </A></H2>
  <P>qmail 必须安装在UNIX或者类UNIX系统上, 一些系统要求: </P>
<UL>
    <LI>安装需要大约10兆空间. 安装之后可以删除目标文件释放出大约4兆空间. 
    <LI>一个完整的C开发环境, 包括编译器, 系统头文件, 以及函数库. 构建指导将告诉你如何显示你是否拥有这些必要的部分. 
    <LI>二进制代码, 文档, 和配置文件需要几兆空间. 
    <LI>队列需要一个安全的文件系统. qmail 的可靠性要求文件系统兼容传统的BSD FFS语义. 大多数现代的本地文件系统都符合这个要求除了一个很重要的例外: 
      link()系统调用常常是异步的--这意味着link()操作返回时不会将数据写入磁盘. Bruce Guenter 的<I>syncdir</I> 
      库可以用来解决这个问题. 更多信息请参见附录里面相关软件包 <A 
  href="#syncdir">syncdir</A>. 
    <LI>队列需要的足够的磁盘空间. 小型单用户系统仅仅需要2兆. 大型系统可能需要2吉(2G). 
    <LI>兼容的操作系统. 多数变种UNIX都可以. 参考qmail源代码里面的README文件, 里面有已知的兼容系统版本列表. 
    <LI>最好有权使用域名服务器. 没有这个条件, qmail就只能按照smtproutes配置文件里面配置的远程主机发送邮件. 
    <LI>足够的网络带宽. qmail是为良好接入网络的系统设计的, 所以你不可能在一个28.8k的拨号线路上运行一个邮件列表. serialmail软件包是为在低速连接上的系统运行qmail而设计的. 
      更多信息请参见附录内<A 
  href="#serialmail">serialmail</A>相关的节. </LI>
</UL>
  <H2><A name=download>2.4. 下载源代码 </A></H2>
<P>好了, 你已经准备好安装qmail的系统了. 第一步就是下载qmail和插件的源代码. 当然了, 你需要qmail, 还有ucspi-tcp和daemontools. 
  </P>
<UL>
  <LI><I>qmail</I>, <A 
  href="ftp://cr.yp.to/software/qmail-1.03.tar.gz">ftp://cr.yp.to/software/qmail-1.03.tar.gz</A> 

  <LI><I>ucspi-tcp</I>, <A 
  href="ftp://cr.yp.to/ucspi-tcp/ucspi-tcp-0.88.tar.gz">ftp://cr.yp.to/ucspi-tcp/ucspi-tcp-0.88.tar.gz</A> 

  <LI><I>daemontools</I>, <A 
  href="ftp://cr.yp.to/daemontools/daemontools-0.76.tar.gz">ftp://cr.yp.to/daemontools/daemontools-0.76.tar.gz</A></LI></UL>
  <P>用你的web浏览器, 或者web客户端(比如wget), FTP客户端下载这些源代码. </P>
<P>
  <HR align=left width="80%">
  <STRONG>注意: </STRONG>如果这些链接的其中任何一个失效, 都有可能由于他们已经升级了, 如果是这种情况, 你需要到<A 
href="http://cr.yp.to/software.html">http://cr.yp.to/software.html</A> 查找相应软件包的链接下载最新版本. 
  有可能升级版本不兼容下面的指导内容, 所以请一定阅读这些发行版本的&quot;Upgrading from previous version...&quot;小节中的注意事项.<STRONG> 
  </STRONG>
  <HR align=left width="80%">

<P></P>
  <H2><A name=build>2.5. 编译源代码 </A></H2>
  <H3><A name=verify-compiler>2.5.1. 检验编译(源代码)环境 </A></H3>
  <P>首先你要确定的是你有编译程序的必要的工具. 如何确定取决于你使用的UNIX变种. 虽然不能保证可靠, 但最简单的断定方式就是去试. </P>
<P>
  <HR align=left width="80%">
  <STRONG>注意: </STRONG>下面任何一个测试通过了, 你都可以停下来直接跳到下一节. <STRONG> </STRONG>
  <HR align=left width="80%">

<P></P>
<UL>
    <LI>在计算机的命令提示行下, 敲入 cc 然后回车. </LI>
</UL><PRE>    $ cc
    cc: No input files specified
    $
</PRE>
<UL>
    <LI>如果你得到类似上面的反应, 表明你的缺省搜索访问路径上有一个可用的C编译器. 如果没有类似反应, 也不意味着你必然没安装任何C编译器. 也有可能那个编译器不在你的缺省搜索访问路径上, 
      当然, 也有可能你根本没有编译器. 接着来试这几个命令: 
      <UL>
      <LI>/usr/bin/cc 
      <LI>/usr/bin/gcc 
      <LI>/usr/local/bin/cc 
      <LI>/usr/local/bin/gcc 
      <LI>/usr/ccs/bin/cc</LI>
    </UL>
    <LI>如果他们中间没有一个命令起作用, 你可能要多试点和平台有关的命令啦. 在命令提示符下, 区别于你使用的平台不同, 分别敲入以下命令: 
      <UL>
        <LI>对于 Red Hat Linux, 使用: rpm -qa | grep gcc 或者 rpm -qa | 
          grep egcs 
        <LI>对于 FreeBSD: 默认安装已经包括了GCC编译器. </LI>
    </UL>
    <LI>如果你找不到编译器, 你必须确定它的位置或者安装一个. 请联络你的操作系统销售商或者操作系统技术支持. </LI>
</UL>
  <P>这节我们将要实现编译qmail的步骤. 剪切/粘贴<font color="#FF00FF" size="-1">(意思是复制或者粘贴脚本和命令行. 
    译者注)</font> 会很方便, 不过也不是必须的. </P>
  <H3><A name=unpack>2.5.2. 解压发行包 </A></H3>
  <P>如果你一直按照这个指导来作, 那么现在你已经有了一个C编译器, 以及源代码的tarball副本. 下一步, 拷贝或者移动tarball包到工作目录. 
    /usr/local/src对于qmail和ucspi-tcp安装是个不错的选择. daemontools必须建立在/package下. </P>
  <P>现在你应该成为root用户, 如果你还没有, 那就成为root吧. </P>
<PRE>    su
    umask 022
    mkdir -p /usr/local/src
    mv qmail-1.03.tar.gz ucspi-tcp-0.88.tar.gz /usr/local/src
    mkdir -p /package
    mv daemontools-0.76.tar.gz /package
    chmod 1755 /package
</PRE>
  <P>现在你可以解开软件包了. </P>
<PRE>    cd /usr/local/src
    gunzip qmail-1.03.tar.gz
    tar xpf qmail-1.03.tar
    gunzip ucspi-tcp-0.88.tar.gz
    tar xpf ucspi-tcp-0.88.tar
    rm *.tar    <I># 可选的, 除非磁盘空间非常紧张. optional, unless space is very tight</I>
    cd /package
    gunzip daemontools-0.76.tar.gz
    tar xpf daemontools-0.76.tar
    rm *.tar    <I># 可选的, 同上optional, again</I>
</PRE>
  <P>那么, 现在应该有下面几个目录 /usr/local/src/qmail-1.03, /usr/local/src/ucspi-tcp-0.88, 
    和  /package/admin/daemontools-0.76. </P>
  <H3><A name=create-dirs>2.5.3. 建立目录 </A></H3>
  <P>qmail安装程序会自行创建需要的子目录, 你只需要创建qmail的&quot;home&quot;目录. </P>
<PRE>    mkdir /var/qmail
</PRE>
  <P>然后直达下一节. </P>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>如果你想把qmail的全部或者部分文件安装到除了/var的其他地方, 可以在/var/qmail下建立软链接到其他位置.<STRONG> 
  </STRONG>
<P></P>
  <P>举个<strong>例子</strong>, qmail配置文件可以存放在/etc/qmail下面, 如下操作: </P>
<PRE>    mkdir /etc/qmail
    ln -s /etc/qmail /var/qmail/control
</PRE>
<P>
<HR align=left width="80%">

<P></P>
  <H3><A name=create-users>2.5.4. 创建用户和组 </A></H3>
  <P>最容易的创建用户和组的方式是创建一个小脚本文件然后执行它. 在源代码目录下你可以找到一个名字是INSTALL.ids的文件, 它包括了在你的系统平台下创建用户和组的命令行. 
    复制这个文件并命名另外一个名字, 编辑它来运行命令既快捷又简单. </P>
<PRE>    cd /usr/local/src/qmail-1.03
    cp INSTALL.ids IDS
</PRE>
  <P>接下来, 用你最顺手的编辑器, 删除文件其余部分, <strong>除了</strong>保留你的平台需要的命令部分. 举个例子, 下面是为FreeBSD平台编辑之后留下的部分: 
  </P>
<PRE>    pw groupadd nofiles
    pw useradd alias -g nofiles -d /var/qmail/alias -s /nonexistent
    pw useradd qmaild -g nofiles -d /var/qmail -s /nonexistent
    pw useradd qmaill -g nofiles -d /var/qmail -s /nonexistent
    pw useradd qmailp -g nofiles -d /var/qmail -s /nonexistent
    pw groupadd qmail
    pw useradd qmailq -g qmail -d /var/qmail -s /nonexistent
    pw useradd qmailr -g qmail -d /var/qmail -s /nonexistent
    pw useradd qmails -g qmail -d /var/qmail -s /nonexistent
</PRE>
  <P>然后运行这个脚本, 用chmod将脚本设置为可执行或者用sh来运行它. </P>
  <P>第一种方法: </P>
<PRE>    chmod 700 IDS
    ./IDS
</PRE>
  <P>第二种方法: </P>
<PRE>    /bin/sh IDS
</PRE>
  <P>这个脚本运行完毕, 你的所有的用户和组就已经添加完毕, 你可以继续下一节的安装了. </P>
  <P>可是如果你的系统不在INSTALL.ids上怎么办? 那你就必须手动创建用户和组了. 使用你比较顺手的编辑器编辑/etc/group, 增加下面两行: 
  </P>
<PRE>    qmail:*:2107:
    nofiles:*:2108:
</PRE>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>首先确定2107和2108没有被使用, 如果已经被占用, 选择2个文件中未用的数字.<STRONG> </STRONG>
<HR align=left width="80%">

<P></P>
  <P>下一步, 使用vipw(大多数系统都有这个命令, 如果没有你就必须用编辑器手动编辑, 不过这次可是/etc/passwd文件)在文件尾部增加下面这些行: 
  </P>
<PRE>    alias:*:7790:2108::/var/qmail/alias:/bin/true
    qmaild:*:7791:2108::/var/qmail:/bin/true
    qmaill:*:7792:2108::/var/qmail:/bin/true
    qmailp:*:7793:2108::/var/qmail:/bin/true
    qmailq:*:7794:2107::/var/qmail:/bin/true
    qmailr:*:7795:2107::/var/qmail:/bin/true
    qmails:*:7796:2107::/var/qmail:/bin/true
</PRE>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>首先确定7790-7796这些未被占用以及和刚才上面编辑的2107, 2108是同一个组id. 如果任意一个用户ID(UID)被占用, 
  必须选用其他未被占用的用户id.<STRONG> </STRONG>
<HR align=left width="80%">

<P></P>
  <P>你不必一定把这些行加到文件<em>尾部</em>, 这样作只是最容易说明的方式. </P>
  <P>你现在已经可以进入下一节了. </P>
  <H3><A name=do-build>2.5.5. 编译</A></H3>
  <P>现在你可以开始编译qmail了. 进入/usr/local/src/qmail-1.03目录, 我们开始吧! </P>
<PRE>    cd /usr/local/src/qmail-1.03
</PRE>
  <P>在<a href="#verify-compiler">检验编译环境</a>小节, 你定位了你的C编译器. 如果它的名字不是cc或者不在你访问的环境变量PATH定义的任何目录下, 
    你必须修改conf-cc和conf-ld. 假设你的编译器名字是gcc, 并且gcc在你的环境变量PATH内可见, 那么简单来说, 编辑conf-cc和conf-ld然后置换所有&quot;cc&quot;为&quot;gcc&quot;就可以了. 
  </P>
  <P>现在敲入下面的命令: </P>
<PRE>    make setup check
</PRE>
  <P>这个编译完成之后, 你需要作一些安装后配置工作. 运用下面两个脚本用来让工作更简单.</P>
  <P>如果你的DNS配置恰当, 这个脚本就是你要的. </P>
<PRE>    ./config
</PRE>
  <P>如果由于某些原因config不能在DNS找到你的主机名, 你就必须运行config-fast脚本: </P>
<PRE>    ./config-fast <I>the.full.hostname</I>
</PRE>
  <P>举个例子, 如果你的域名是example.com, 你的计算机的主机名是dlphin, 你的config-fast行应该这样写: </P>
<PRE>    ./config-fast dolphin.example.com
</PRE>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>你可能计划在小型本地局域网使用假域名比如&quot;local&quot;, 举例来说, 如果你的主机名是&quot;mash&quot;, 
  你可能要用 ./config-fast mash.local , 如果你这样作了, 要确定配置qmail在返回地址上使用了合法的因特网域名. (参见第3节, 
  <A 
href="#configuration">配置</A>.)<STRONG> </STRONG>
<HR align=left width="80%">

<P></P>
  <P>qmail现在已经安装到你的系统内, 并且准备运行了! 下一节将要介绍运行和测试qmail. </P>
  <H2><A name=install-ucspi>2.6. 安装 ucspi-tcp </A></H2>
  <P>刚才你解压了<I>qmail</I>, <I>ucspi-tcp</I>, 和<I>daemontools </I>的tarball包, 现在进入ucspi-tcp目录. 
  </P>
<PRE>    cd /usr/local/src/ucspi-tcp-0.88
</PRE>
  <P>刚才在<A href="#do-build">编译</A>一节, 如果你修改了conf-cc和conf-ld文件, 你必须在这个目录作同样的修改. </P>
  <P>然后, 运行: </P>
<PRE>    make
    make setup check
</PRE>
  <P>ucspi-tcp安装完毕. </P>
  <H2><A name=install-daemontools>2.7. 安装 daemontools </A></H2>
  <P>进入daemontools安装目录 </P>
<PRE>    cd /package/admin/daemontools-0.76
</PRE>
  <P>再说一次, 如果你在编译qmail和ucspi-tcp的时候修改了conf-cc和conf-ld文件, 你必须在在src目录作同样的修改. </P>
<P>然后, 运行: Then do:</P>
<PRE>    package/install
</PRE>
  <P>在BSD系统上(没有 /etc/inittab), 你必须重新启动计算机再运行svscan, 这是后台服务器的管理服务程序. </P>
  <P>使用 "ps -ef | grep svscan" 或者"ps waux | grep svscan"检查svscan是否在运行. 
  </P>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>在Solaris下, 你必须修改/etc/inittab中关于svscan的启动条目, 将 
  <P></P><PRE>  SV:123456:respawn:/command/svscanboot
</PRE>
  <P>改为: </P>
<PRE>  SV:123456:respawn:/command/svscanboot &lt;/dev/null &gt;/var/log/svscan 2&gt;&amp;1
</PRE>
  <P>或者改为: </P>
<PRE>  SV:123456:respawn:/command/svscanboot &lt;/dev/null &gt;/dev/msglog 2&gt;&amp;1
</PRE>
  <P>这取决于你是想把启动svscan的出错消息记录到log文件里面还是显示到控制台上. 这样作的必要性请参考下面的文章: </P>
<P><A 
href="http://marc.theaimsgroup.com/?l=log&amp;m=100327801309834&amp;w=2">http://marc.theaimsgroup.com/?l=log&amp;m=100327801309834&amp;w=2</A></P>
<P>
<HR align=left width="80%">

<P></P>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>一个Slackware的用户报告x1之前的SV /etc/inittab条目必须被移动, 否则启动后无法运行svscan. 
  <HR align=left width="80%">

<P></P>
  <H2><A name=start-qmail>2.8. 运行 qmail </A></H2>
<H3><A name=rc>2.8.1. /var/qmail/rc</A></H3>
  <P>/var/qmail/boot 目录包含了不同配置的qmail启动脚本示例: /var/spool/mail 方式和$HOME/Mailbox 方式, 
    使用procmail或者.forward 控制文件, 以及这些方式的不同组合配置. 你可以随意考查这些方式, 不过这里我们选用下面的脚本: </P>
<PRE>#!/bin/sh

# Using stdout for logging
# Using control/defaultdelivery from qmail-local to deliver messages by default

exec env - PATH="/var/qmail/bin:$PATH" \
qmail-start "`cat /var/qmail/control/defaultdelivery`"
</PRE>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>这个脚本使用了反引号(`), 而不是单引号('). 最好拷贝和粘贴上文的脚本而不是自己敲一遍, 后者容易出错. 
  <HR align=left width="80%">

<P></P>
  <P>用你的编辑器将上面的脚本保存为 /var/qmail/rc, 然后执行下面这些命令: </P>
<PRE>    chmod 755 /var/qmail/rc
    mkdir /var/log/qmail
</PRE>
  <P>现在你需要决定一下不是由.qmail 文件传送的邮件的默认传输方式, 下面的列表大致阐述了几种一般性的选择: </P>
<TABLE class=columns border=1>
  <TBODY>
  <TR class=heading>
        <TD><STRONG>邮箱格式 </STRONG></TD>
        <TD><STRONG> 名称 </STRONG></TD>
        <TD><STRONG>保存位置</STRONG></TD>
        <TD><STRONG>缺省的传输方式</STRONG></TD>
        <TD><STRONG>注释 </STRONG></TD>
    </TR>
  <TR>
    <TD>mbox </TD>
    <TD>Mailbox </TD>
    <TD>$HOME </TD>
    <TD>./Mailbox </TD>
        <TD>最常见的格式, 大多数MUA都可以正确识别 </TD>
    </TR>
  <TR>
    <TD>maildir </TD>
    <TD>Maildir </TD>
    <TD>$HOME </TD>
    <TD>./Maildir/ </TD>
        <TD>更可靠, MUA支持较少 </TD>
    </TR>
  <TR>
    <TD>mbox </TD>
    <TD>&nbsp;<I>username</I> </TD>
    <TD>/var/spool/mail </TD>
        <TD>参见 INSTALL.vsm文件 </TD>  <TD>传统的UNIX邮箱 </TD>
    </TR></TBODY></TABLE>
  <P>更多信息请参考 INSTALL.mbox, INSTALL.maildir 和 INSTALL.vsm 文件. </P>
  <P>选择缺省的邮箱格式, 只要选择上表里面的&quot;缺省传输方式&quot;的值, 填写到/var/qmail/control/defaultdelivery里面就可以了. 
    例如, 选择标准的qmail /Mailbox 传送格式, 这样作就行了: </P>
<PRE>    echo ./Mailbox &gt;/var/qmail/control/defaultdelivery
</PRE>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>defaultdelivery并不是标准的qmail控制文件. 而是上文/var/qmail/rc 文件的要素. 
  对于qmail-start来说, defaultdelivery 变量 只是在没有实际的 .qmail 文件指定传送指令的情况下作为 .qmail 文件的内容出现的. 
  加上这个指令就不必再引用shell元字符, 避免了出现多行杂乱的命令参数.<STRONG> </STRONG>
<hr align=left width="80%">
<P></P>
  <H3><A name=system-startup>2.8.2. 系统启动文件 </A></H3>
  <H4><A name=qmailctl-script>2.8.2.1. qmailctl 脚本 </A></H4>
  <P>如果你手动执行/varqmail/rc 脚本, qmail只会<em>部分</em>被运行起来. 可是我们希望希望每次系统启动后, qmail都能自动被启动; 
    每次系统停止时候qmail自动被关闭. </P>
  <P>创建一个如下的 /var/qmail/bin/qmailctl 文件可以完成这个愿望: </P>
<PRE>#!/bin/sh

# For Red Hat chkconfig
# chkconfig: - 80 30
# description: the qmail MTA

PATH=/var/qmail/bin:/bin:/usr/bin:/usr/local/bin:/usr/local/sbin
export PATH

QMAILDUID=`id -u qmaild`
NOFILESGID=`id -g qmaild`

case "$1" in
  start)
    echo "Starting qmail"
    if svok /service/qmail-send ; then
      svc -u /service/qmail-send /service/qmail-send/log
    else
      echo "qmail-send supervise not running"
    fi
    if svok /service/qmail-smtpd ; then
      svc -u /service/qmail-smtpd /service/qmail-smtpd/log
    else
      echo "qmail-smtpd supervise not running"
    fi
    if [ -d /var/lock/subsys ]; then
      touch /var/lock/subsys/qmail
    fi
    ;;
  stop)
    echo "Stopping qmail..."
    echo "  qmail-smtpd"
    svc -d /service/qmail-smtpd /service/qmail-smtpd/log
    echo "  qmail-send"
    svc -d /service/qmail-send /service/qmail-send/log
    if [ -f /var/lock/subsys/qmail ]; then
      rm /var/lock/subsys/qmail
    fi
    ;;
  stat)
    svstat /service/qmail-send
    svstat /service/qmail-send/log
    svstat /service/qmail-smtpd
    svstat /service/qmail-smtpd/log
    qmail-qstat
    ;;
  doqueue|alrm|flush)
    echo "Flushing timeout table and sending ALRM signal to qmail-send."
    /var/qmail/bin/qmail-tcpok
    svc -a /service/qmail-send
    ;;
  queue)
    qmail-qstat
    qmail-qread
    ;;
  reload|hup)
    echo "Sending HUP signal to qmail-send."
    svc -h /service/qmail-send
    ;;
  pause)
    echo "Pausing qmail-send"
    svc -p /service/qmail-send
    echo "Pausing qmail-smtpd"
    svc -p /service/qmail-smtpd
    ;;
  cont)
    echo "Continuing qmail-send"
    svc -c /service/qmail-send
    echo "Continuing qmail-smtpd"
    svc -c /service/qmail-smtpd
    ;;
  restart)
    echo "Restarting qmail:"
    echo "* Stopping qmail-smtpd."
    svc -d /service/qmail-smtpd /service/qmail-smtpd/log
    echo "* Sending qmail-send SIGTERM and restarting."
    svc -t /service/qmail-send /service/qmail-send/log
    echo "* Restarting qmail-smtpd."
    svc -u /service/qmail-smtpd /service/qmail-smtpd/log
    ;;
  cdb)
    tcprules /etc/tcp.smtp.cdb /etc/tcp.smtp.tmp &lt; /etc/tcp.smtp
    chmod 644 /etc/tcp.smtp.cdb
    echo "Reloaded /etc/tcp.smtp."
    ;;
  help)
    cat &lt;&lt;HELP
   stop -- stops mail service (smtp connections refused, nothing goes out)
  start -- starts mail service (smtp connection accepted, mail can go out)
  pause -- temporarily stops mail service (connections accepted, nothing leaves)
   cont -- continues paused mail service
   stat -- displays status of mail service
    cdb -- rebuild the tcpserver cdb file for smtp
restart -- stops and restarts smtp, sends qmail-send a TERM &amp; restarts it
doqueue -- schedules queued messages for immediate delivery
 reload -- sends qmail-send HUP, rereading locals and virtualdomains
  queue -- shows status of queue
   alrm -- same as doqueue
  flush -- same as doqueue
    hup -- same as reload
HELP
    ;;
  *)
    echo "Usage: $0 {start|stop|restart|doqueue|flush|reload|stat|pause|cont|cdb|queue|help}"
    exit 1
    ;;
esac

exit 0

</PRE>
  <P>这个脚本可以在线下载, 地址是<A 
href="http://www.lifewithqmail.org/qmailctl-script-dt70">http://www.lifewithqmail.org/qmailctl-script-dt70</A>. 
  </P>
  <P>你可以自己输入这个脚本, 不过我推荐你用浏览器下载上面链接的文件. </P>
  <P>将上面这个qmailctl 脚本设置为可执行脚本, 然后链接到你的用户执行程序目录: </P>
<PRE>    chmod 755 /var/qmail/bin/qmailctl
    ln -s /var/qmail/bin/qmailctl /usr/bin
</PRE>
  <H4><A name=supervise-tree>2.8.2.2. supervise 脚本 </A></H4>
  <P>为 qmail 的服务创建 supervise 目录 </P>
<PRE>    mkdir -p /var/qmail/supervise/qmail-send/log
    mkdir -p /var/qmail/supervise/qmail-smtpd/log
</PRE>
  <P>建立 /var/qmail/supervise/qmail-send/run 文件 </P>
<PRE>#!/bin/sh
exec /var/qmail/rc
</PRE>
  <P>建立 /var/qmail/supervise/qmail-send/log/run 文件: </P>
<PRE>#!/bin/sh
exec /usr/local/bin/setuidgid qmaill /usr/local/bin/multilog t /var/log/qmail
</PRE>
  <P>建立 /var/qmail/supervise/qmail-smtpd/run 文件: </P>
<PRE>#!/bin/sh
QMAILDUID=`id -u qmaild`
NOFILESGID=`id -g qmaild`
MAXSMTPD=`cat /var/qmail/control/concurrencyincoming`
<font color="#FF0000">LOCAL=`head -1 /var/qmail/control/me`</font>
if [ -z "$QMAILDUID" -o -z "$NOFILESGID" -o -z "$MAXSMTPD" -o -z "$LOCAL" ]; then
    echo QMAILDUID, NOFILESGID, MAXSMTPD, or LOCAL is unset in
    echo /var/qmail/supervise/qmail-smtpd/run
    exit 1
fi
if [ ! -f /var/qmail/control/rcpthosts ]; then
    echo "No /var/qmail/control/rcpthosts!"
    echo "Refusing to start SMTP listener because it'll create an open relay"
    exit 1
fi
exec /usr/local/bin/softlimit -m 2000000 \
    <font color="#FF0000">/usr/local/bin/tcpserver -v -R -l "$LOCAL" -x /etc/tcp.smtp.cdb -c "$MAXSMTPD" \</font>
        -u "$QMAILDUID" -g "$NOFILESGID" 0 smtp /var/qmail/bin/qmail-smtpd 2&gt;&amp;1
</PRE>
<P>
<HR align=left width="80%">
<STRONG>注意: </STRONG>concurrencyincoming并不是标准的qmail控制文件. 它是上面脚本的一个要素. 
并且, 第一个LOCAL 行上面的是&quot;破折号 + 数字1&quot;, 下面的tcpserver行上的参数是&quot;破折号 + 小写字母l&quot; 
.<font color="#FF00FF" size="-1"> (由于英文小写字母l和数字1容易混淆, 原作者特意补充的注意事项. 由译者将被提到两行修改成为红色. 
这也是为什么作者希望读者直接拷贝脚本而不是自行输入避免脚本出错的主要原因之一. 译者注)<STRONG> </STRONG></font>
<HR align=left width="80%">

<P></P>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>Solaris系统下一般位置的id程序不能正常工作, 请使用这个位置的 /usr/xpg4/bin/id: 
  <P></P><PRE>    QMAILDUID=`/usr/xpg4/bin/id -u qmaild`
    NOFILESGID=`/usr/xpg4/bin/id -g qmaild`
</PRE>
<P>
<HR align=left width="80%">

<P></P>
<P>
<HR align=left width="80%">
  <STRONG>注意:</STRONG> 根据你的操作系统和硬件平台的不同, 可能需要调整softlimit命令的的内存限制参数. 如果你的系统出现连接25端口失败和无法接收远程系统发送的邮件, 
  试一下把这个参数调整到3000000到4000000. <STRONG> </STRONG>
<HR align=left width="80%">

<P></P>
  <P>建立concurrencyincoming 控制文件. </P>
<PRE>    echo 20 &gt; /var/qmail/control/concurrencyincoming
    chmod 644 /var/qmail/control/concurrencyincoming
</PRE>
  <P>建立 /var/qmail/supervise/qmail-smtpd/log/run 文件 </P>
<PRE>#!/bin/sh
exec /usr/local/bin/setuidgid qmaill /usr/local/bin/multilog t /var/log/qmail/smtpd
</PRE>
  <P>将各个run文件设置为可执行文件: </P>
<PRE>    chmod 755 /var/qmail/supervise/qmail-send/run
    chmod 755 /var/qmail/supervise/qmail-send/log/run
    chmod 755 /var/qmail/supervise/qmail-smtpd/run
    chmod 755 /var/qmail/supervise/qmail-smtpd/log/run
</PRE>
  <P>然后建立log文件目录: </P>
<PRE>    mkdir -p /var/log/qmail/smtpd
    chown qmaill /var/log/qmail /var/log/qmail/smtpd
</PRE>
  <P>最后, 建立 supervise 目录到 /service 目录的链接: </P>
<PRE>    ln -s /var/qmail/supervise/qmail-send /var/qmail/supervise/qmail-smtpd /service
</PRE>
  <P> /service 目录是 <I>daemontools</I> 安装时建立的目录. </P>
<P>
<HR align=left width="80%">
  <STRONG>注意:</STRONG> 建立这个链接之后 qmail 系统会很快自动被启动起来, 如果你还不想立刻运行qmail, 运行下面这个,命令来停止qmail: 
  <P></P><PRE>    qmailctl stop
</PRE>
<P>
<HR align=left width="80%">

<P></P>
  <H4><A name=smtp-access-control>2.8.2.3. SMTP 访问控制 </A></H4>
  <P>允许本地主机通过SMTP方式发送邮件: </P>
<PRE>    echo '127.:allow,RELAYCLIENT=""' &gt;&gt;/etc/tcp.smtp
    qmailctl cdb
</PRE>
  <H3><A name=stop-sendmail>2.8.3. 停止并且禁用(其他)已经安装的MTA </A></H3>
  <P>虽然有可能同时运行qmail和现存的MTA, 比如Sendmail, 不过我建议你除非你知道自己到底在干什么. 否则, 我可不建议你这么干. 其实, 
    说实话, 如果你正在读我这段话, 你可能也不知道自己在干嘛. :-) </P>
  <P>如果现存的MTA是Sendmail, 你应该能利用运行Sendmail的init.d脚本的&quot;stop&quot;参数来停止它的运行. 例如下面命令中的一个可能是有效的: 
  </P>
<PRE>    /etc/init.d/sendmail stop
    /sbin/init.d/sendmail stop
    /etc/rc.d/init.d/sendmail stop
</PRE>
  <P>如果你找不到任何一个init.d/sendmail 下的脚本, 你可以用 "ps -ef|grep sendmail" 或者 "ps 
    waux|grep sendmail" 命令找出 sendmail 的PID, 然后用下面的命令来停止Sendmail: <font color="#FF00FF" size="-1">(kill 
    命令加上Sendmail的PID作参数, 译者注) </font></P>
<PRE>    kill <I>PID-of-sendmail</I>
</PRE>
  <P>如果你的MTA不是Sendmail, 检查相关文档找出正确的停止MTA的方法.</P>
  <P>你应该考虑一下把旧的MTA彻底的从你的系统里面删除. 至少禁用它的 init.d 脚本, 防止下一次系统重启动的时候旧的MTA也被试图重启. </P>
  <P>对于使用rpm方式安装Sendmail的 Red Hat Linux, 执行下面的命令来删除Sendmail: </P>
<PRE>    rpm -e --nodeps sendmail
</PRE>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>如果你使用基于RPM方式的Linux, 比如 Red Hat, 删除MTA可能带来进一步的问题. 系统的很多应用程序将会试图重新安装Sendmail, 
  一些MUA程序将无法安装, 因为他们找不到安装好的MTA. Mate Wierdl 提供了一个占位程序, 称作 "fake_mta", 安装这个程序之后可以防止出现以上的问题. 
  简单的RPM安装包可以在下面的地址取得 <A 
href="http://www.csi.hu/mw/fake_mta-1-1memphis.noarch.rpm">http://www.csi.hu/mw/fake_mta-1-1memphis.noarch.rpm</A>. 
  <STRONG> </STRONG> 
  <P>
<HR align=left width="80%">

<P></P>
  <P>检查一下没有其他程序在监听SMTP服务端口(25). 旧的MTA, inetd, 或者 xinetd 等程序都有可能造成问题. (按照以上步骤执行后, 
    再) 运行下面的命令应该是没有输出结果的(除非这个时候 qmail-smtpd 服务也在运行). </P>
<PRE>    netstat -a | grep smtp
</PRE>
  <P>如果有什么程序在运行, 首先确定不是qmail, 那么先运行下面的命令: </P>
<PRE>    qmailctl stop
</PRE>
  <P>然后重复 netstat 检查: </P>
<PRE>    netstat -a | grep smtp
</PRE>
  <P>如果你还是能看到这个命令有一些输出, 你就必须在qmail 的SMTP服务运行起来之前把肇事程序找出来. </P>
  <P>最后, 将现存的 /usr/lib/sendmail 替代为 qmail 版本. </P>
<PRE>    mv /usr/lib/sendmail /usr/lib/sendmail.old                  <I># 忽略错误提示  ignore errors</I>
    mv /usr/sbin/sendmail /usr/sbin/sendmail.old                <I># 忽略错误提示  ignore errors</I>
    chmod 0 /usr/lib/sendmail.old /usr/sbin/sendmail.old        <I># 忽略错误提示 ignore errors</I>
    ln -s /var/qmail/bin/sendmail /usr/lib
    ln -s /var/qmail/bin/sendmail /usr/sbin
</PRE>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>创建 sendmail 的链接是很重要的, 即使不管以前的MTA, sendmail 命令也是一个会被很多程序调用来发送邮件的重要命令.<STRONG> 
  </STRONG>
<HR align=left width="80%">

<P></P>
  <P>最后步骤是建立两个系统别名. </P>
  <H3><A name=system-aliases>2.8.4. 建立系统别名 </A></H3>
  <P>在所有 qmail 安装上面都要建立三个系统别名: </P>
<TABLE class=columns border=1>
  <TBODY>
  <TR class=heading>
        <TD><STRONG>别名</STRONG></TD>
        <TD><STRONG>使用目的 </STRONG></TD>
    </TR>
  <TR>
    <TD>postmaster </TD>
        <TD>RFC 2821 标准要求, 指向邮件系统管理员(也就是你) </TD>
    </TR>
  <TR>
    <TD>mailer-daemon </TD>
        <TD>反弹邮件事实上的标准接收者 </TD>
    </TR>
  <TR>
    <TD>root </TD>
        <TD>转发根(root)用户的邮件给系统管理者 </TD>
    </TR></TBODY></TABLE>
  <P>建立这些系统别名, 取决于你想让这些邮件发送到哪里(一个本地用户或者一个远程地址)并且适当的创建一个.qmail 文件集合. 举个例子, 加入你想让本地用户 
    dave 接收发给系统管理员和邮件管理员的邮件, 就这么作: </P>
<PRE>    echo dave &gt; /var/qmail/alias/.qmail-root
    echo dave &gt; /var/qmail/alias/.qmail-postmaster
    ln -s .qmail-postmaster /var/qmail/alias/.qmail-mailer-daemon
    chmod 644 /var/qmail/alias/.qmail-root /var/qmail/alias/.qmail-postmaster
</PRE>
<P>在 INSTALL.alias 文件里面有更详细的细节. See INSTALL.alias for more details.</P>
  <H3><A name=start-it>2.8.5. 运行 qmail </A></H3>
  <P>如果依照上文, 你创建 /service 之后就停止了qmail, 你现在应该重新启动 qmail: </P>
<PRE>    qmailctl start
</PRE>
  <H2><A name=test>2.9. 测试安装 </A></H2>
  <P>qmail 现在应该是正在运行的状态. 首先运行 qmailctl stat 来检验那些服务启动并运行中: </P>
<PRE>    # qmailctl stat
    /service/qmail-send: up (pid 30303) 187 seconds
    /service/qmail-send/log: up (pid 30304) 187 seconds
    /service/qmail-smtpd: up (pid 30305) 187 seconds
    /service/qmail-smtpd/log: up (pid 30308) 187 seconds
    messages in queue: 0
    messages in queue but not yet preprocessed: 0
</PRE>
  <P>所有的四个服务都应该是&quot;up&quot;(启动了)1秒钟以上. 如果不是这样, 你可能就是在写脚本的时候写错了一些东西或者你漏过了创建一个甚至多个必要的文件, 
    目录或者链接. 返回上面的安装指导, 一步一步的再检查一下你的工作. </P>
  <P>有时候为了检验配置错误, 手动运行一下服务也会很有帮助的. 举个例子, 如果你的 qmail-smtpd/log 服务正在运行, 那么执行下面的命令:</P>
<PRE>    cd /service/qmail-smtpd/log
    svc -d .
    ./run
    <I>if no errors, enter a line of text and press ENTER</I>
    <I>if still no errors, enter CTRL-D (end of file)</I>
</PRE>
  <P>这个时候, 你应该能够识别问题所在并且解决它了. 这个做完之后, 返回服务目录, 如果有必要, 运行命令: </P>
<PRE>    svc -u .
</PRE>
  <P>一旦那些服务的启动时间都大于1秒钟后, 依照 TEST.deliver 和 TEST.receive 文件里面的指令去校验服务是否正确的工作. 注意, 
    应用这些指令, 由 multilog 运行的日志记录会被写到 /var/log/qmail 下, 而不是 splogger 记录到类似 /var/log/maillog 
    的文件里面. </P>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>如果你选择了 maildir 邮箱格式作为默认的传送方式, 在运行这些指令之前, 你必须在你的主目录和别名的主目录创建 
  Maildir 目录. 参见 <A 
href="#maildir-delivery">maildir</A> 小节查找如何恰当的创建这个目录.<STRONG> </STRONG> 
  <HR align=left width="80%">

<P></P>
<HR>

  <H1><A name=configuration>3. 配置 </A></H1>
  <P>你已经从源代码tarball方式, 或者自编译包方式, 或者var-qmail包方式安装了 qmail. 这一节的内容就是按照你的需要配置qmail. 
  </P>
  <H2><A name=config-files>3.1. 配置文件 </A></H2>
  <P>所有的qmail系统配置文件, 包括在~alias下的 .qmail 文件, 位于 /var/qmail/control 目录下. qmail-control 
    的man手册页包括了一个像下面这样的表: </P>
<TABLE class=columns border=1>
  <TBODY>
  <TR class=heading>
        <TD><STRONG>控制文件</STRONG></TD>
        <TD><STRONG>默认值 </STRONG></TD>
        <TD><STRONG>被用于 </STRONG></TD>
        <TD><STRONG>使用目的 </STRONG></TD>
    </TR>
  <TR>
    <TD><A name=badmailfrom>badmailfrom</A> </TD>
    <TD><I>none</I> </TD>
    <TD>qmail-smtpd </TD>
        <TD>From 地址黑名单 </TD>
    </TR>
  <TR>
    <TD><A name=bouncefrom>bouncefrom</A> </TD>
    <TD>MAILER-DAEMON </TD>
    <TD>qmail-send </TD>
        <TD>反弹的发送者用户名 </TD>
    </TR>
  <TR>
    <TD><A name=bouncehost>bouncehost</A> </TD>
    <TD>me </TD>
    <TD>qmail-send </TD>
        <TD>反弹的发送者主机名 </TD>
    </TR>
  <TR>
    <TD><A name=concurrencyincoming>concurrencyincoming</A> </TD>
    <TD><I>none</I> </TD>
    <TD>/service/qmail-smtpd/run </TD>
        <TD>最大并行 SMTP 连接数 </TD>
    </TR>
  <TR>
    <TD><A name=concurrencylocal>concurrencylocal</A> </TD>
    <TD>10 </TD>
    <TD>qmail-send </TD>
        <TD>最大并行本地传送数 </TD>
    </TR>
  <TR>
    <TD><A name=concurrencyremote>concurrencyremote</A> </TD>
    <TD>20 </TD>
    <TD>qmail-send </TD>
        <TD>最大并行远程传送数 </TD>
    </TR>
  <TR>
    <TD><A name=defaultdelivery>defaultdelivery</A> </TD>
    <TD><I>none</I> </TD>
    <TD>/var/qmail/rc </TD>
        <TD>默认的 .qmail 文件 </TD>
    </TR>
  <TR>
    <TD><A name=defaultdomain>defaultdomain</A> </TD>
    <TD>me </TD>
    <TD>qmail-inject </TD>
        <TD>默认的域名 </TD>
    </TR>
  <TR>
    <TD><A name=defaulthost>defaulthost</A> </TD>
    <TD>me </TD>
    <TD>qmail-inject </TD>
        <TD>默认的主机名 </TD>
    </TR>
  <TR>
    <TD><A name=databytes>databytes</A> </TD>
    <TD>0 </TD>
    <TD>qmail-smtpd </TD>
        <TD>邮件最大字节数 (0 等于无限)</TD>
    </TR>
  <TR>
    <TD><A name=doublebouncehost>doublebouncehost</A> </TD>
    <TD>me </TD>
    <TD>qmail-send </TD>
        <TD>主机名和双重反弹的发送者 </TD>
    </TR>
  <TR>
    <TD><A name=doublebounceto>doublebounceto</A> </TD>
    <TD>postmaster </TD>
    <TD>qmail-send </TD>
        <TD>接收双重反弹邮件的用户 </TD>
    </TR>
  <TR>
    <TD><A name=envnoathost>envnoathost</A> </TD>
    <TD>me </TD>
    <TD>qmail-send </TD>
        <TD>对缺少&quot;@&quot;符号的地址配置的缺省域名 </TD>
    </TR>
  <TR>
    <TD><A name=helohost>helohost</A> </TD>
    <TD>me </TD>
    <TD>qmail-remote </TD>
        <TD>在SMTP HELLO命令里面使用的主机名 </TD>
    </TR>
  <TR>
    <TD><A name=idhost>idhost</A> </TD>
    <TD>me </TD>
    <TD>qmail-inject </TD>
        <TD>在Message-ID 里面使用的主机名 </TD>
    </TR>
  <TR>
    <TD><A name=localiphost>localiphost</A> </TD>
    <TD>me </TD>
    <TD>qmail-smtpd </TD>
        <TD>取代本地 IP 地址的名字 </TD>
    </TR>
  <TR>
    <TD><A name=locals>locals</A> </TD>
    <TD>me </TD>
    <TD>qmail-send </TD>
        <TD>进行本地传送的域 </TD>
    </TR>
  <TR>
    <TD><A name=me>me</A> </TD>
        <TD><I>系统的正式域名 FQDN </I></TD>
    <TD>various </TD>
        <TD>许多控制文件的默认要求 </TD>
    </TR>
  <TR>
    <TD><A name=morercpthosts>morercpthosts</A> </TD>
    <TD><I>none</I> </TD>
    <TD>qmail-smtpd </TD>
        <TD>二级rcphosts(接收主机)数据库 </TD>
    </TR>
  <TR>
    <TD><A name=percenthack>percenthack</A> </TD>
    <TD><I>none</I> </TD>
    <TD>qmail-send </TD>
        <TD>可以使用&quot;%&quot;模式转信的域 </TD>
    </TR>
  <TR>
    <TD><A name=plusdomain>plusdomain</A> </TD>
    <TD>me </TD>
    <TD>qmail-inject </TD>
        <TD>&quot;+&quot;加号拖尾地址的替代域 </TD>
    </TR>
  <TR>
    <TD><A name=qmqpservers>qmqpservers</A> </TD>
    <TD><I>none</I> </TD>
    <TD>qmail-qmqpc </TD>
        <TD>QMQP 服务器IP地址</TD>
    </TR>
  <TR>
    <TD><A name=queuelifetime>queuelifetime</A> </TD>
    <TD>604800 </TD>
    <TD>qmail-send </TD>
        <TD>邮件在队列内可保留秒数 </TD>
    </TR>
  <TR>
    <TD><A name=rcpthosts>rcpthosts</A> </TD>
    <TD><I>none</I> </TD>
    <TD>qmail-smtpd </TD>
        <TD>我们的主机接收邮件的域 </TD>
    </TR>
  <TR>
    <TD><A name=smtpgreeting>smtpgreeting</A> </TD>
    <TD>me </TD>
    <TD>qmail-smtpd </TD>
        <TD>SMTP 问候信息 </TD>
    </TR>
  <TR>
    <TD><A name=smtproutes>smtproutes</A> </TD>
    <TD><I>none</I> </TD>
    <TD>qmail-remote </TD>
        <TD>伪装的SMTP路由 </TD>
    </TR>
  <TR>
    <TD><A name=timeoutconnect>timeoutconnect</A> </TD>
    <TD>60 </TD>
    <TD>qmail-remote </TD>
        <TD>SMTP连接超时秒数 </TD>
    </TR>
  <TR>
    <TD><A name=timeoutremote>timeoutremote</A> </TD>
    <TD>1200 </TD>
    <TD>qmail-remote </TD>
        <TD>远程连接超时秒数 </TD>
    </TR>
  <TR>
    <TD><A name=timeoutsmtpd>timeoutsmtpd</A> </TD>
    <TD>1200 </TD>
    <TD>qmail-smtpd </TD>
        <TD>SMTP客户端超时秒数 </TD>
    </TR>
  <TR>
    <TD><A name=virtualdomains>virtualdomains</A> </TD>
    <TD><I>none</I> </TD>
    <TD>qmail-send </TD>
        <TD>虚拟域和用户 </TD>
    </TR></TBODY></TABLE>
  <P>查找这些特殊控制文件的更多信息, 请参考上面表格 &quot;被用于&quot; 列下的各个模块的 man 手册页. </P>
  <H2><A name=relaying>3.2. 中继转信 </A></H2>
  <H3><A name=relaying-intro>3.2.1. 介绍 </A></H3>
  <P>什么是转信? 转信是 MTA 通过SMTP接收到一封既不是<strong>发给</strong>本地地址也不是<strong>从</strong>本地发送者发来的邮件之后, 
    MTA转发这个邮件的动作就是转信. </P>
  <P>在垃圾邮件时代之前, MTA被配置为开放转信是很常见的: 各种各样的服务器接受来自任何人的邮件, 转发给任何人. </P>
  <P>现代的绝大多数 MTA 都被配置为或者完全禁止转信, 或者只允许某些被信任的用户或者系统使用中继转信功能. </P>
  <P>Chris Johnson 写了一个非常好的关于qmail 用户的文档. 我鼓励你去看一看: <A 
href="http://www.palomine.net/qmail/relaying.html">http://www.palomine.net/qmail/relaying.html</A>. 
  </P>
  <H3><A name=relaying-disabling>3.2.2. 禁止转信</A></H3>
  <P>如果你是按照 qmail 的正式安装指导安装的话, 那么转信默认情况下已经被关闭了. 这个功能是通过把local和virtualdomains(指本地主机)文件里面列出的有充分资格的域名写入 
    /var/qmail/control/rcpthosts 文件来完成的. 而且rcpthosts这个文件名的也是来源于SMTP对话中的的RCPT(接收者)命令. 
    在SMTP对话里面, RCPT是用来确认邮件接收者地址的, 然后, 列出可以出现在RCPT地址里面的有效的主机名. </P>
  <H3><A name=relaying-selective>3.2.3. 允许有选择的转信 </A></H3>
  <P>大多数单用户和小型工作组服务器可以完全禁止转信, 可是如果你维护的是一个分布式的用户社区, 你就必须有一个方式能够允许你的用户, 而且<em>只能</em>是你的用户通过的你的系统转信. 
    本文是通过使用 tcpserver 来设置RELAYCLIENT 环境变量, 使 qmail-smtpd 重载 rcpthosts 文件完成这个功能的. 
  </P>
  <P>如果你是按照这个文档的指导安装的话, 有选择的转信已经在默认情况下安装好了. 如果需要给客户端转信权利, 首先在 /etc/tcp.smtp 文件里面增加类似下面的行: 
  </P>
<PRE>    <I>IP address of client</I>:allow,RELAYCLIENT=""
</PRE>
  <P><font color="#FF00FF" size="-1">(斜体<I>IP address of client</I>代表客户端的IP地址. 译者注) 
    </font>然后重建SMTP的访问许可数据库: </P>
<PRE>    qmailctl cdb
</PRE>
  <P>或者运行下面的命令(重建数据库):</P>
<PRE>    tcprules /etc/tcp.smtp.cdb /etc/tcp.smtp.tmp &lt; /etc/tcp.smtp
    chmod 644 /etc/tcp.smtp*
</PRE>
  <P>如果你是按照正式安装指导安装的, Chris Johnson写了另外一个非常好的如何配置qmail允许选择主机转发邮件的文档, 参见: <A 
href="http://www.palomine.net/qmail/selectiverelay.html">http://www.palomine.net/qmail/selectiverelay.html</A>. 
  </P>
  <H2><A name=multiple-hostnames>3.3. 多主机名 </A></H2>
  <P>如果你的主机名已知配置了多个名字, 例如, 所有的来自<I>user</I>@host1.example.com 的地址也可以被写成 
    <I>user</I>@example.com 或者<I> user</I>@mail.example.com, 那么你就必须告诉 
    qmail 那个地址是它应该本地传送的地址, 那个地址是它应该接受的远程主机发送的地址. </P>
  <P>如果要这样作, 只要把所有的名字加入下面两个控制文件就行了:</P>
<UL>
    <LI>rcpthosts, 这个文件通知 qmail-smtpd 接收这个主机可以接受的地址. 还有
    <LI>locals, 这个文件通知 qmail-send 哪些地址是本地传送地址. </LI>
</UL>
  <P>给 qmail-send 发送一个HUP(挂起)信号来通知它重新读取 locals文件. 如果你使用的是本文的 qmailctl 脚本, 那么运行下面的命令就可以了: 
  </P>
<PRE>    qmailctl reload
</PRE>
  <H2><A name=virtual-domains>3.4. 虚拟域 </A></H2>
  <P>虚拟域和上节提到的多主机名类似, 不过这里面有一些很重要的不同之处. 首先如果 example.net 是 virtual.example.net 虚拟域的宿主主机, 
    那么一个发送给 joe@virtual.example.net 的邮件将<strong>不</strong>会被发送给即使是同一个邮箱的 
    joe@example.net.这里虚拟域的名字空间是冲突的. </P>
  <P>使用 qmail, 虚拟域将在 virtualdomains 文件里面配置, 文件内由型如下面这行的条目构成: </P>
<PRE>    <I>user</I>@<I>domain</I>:<I>prepend</I>
</PRE>
  <P>qmail 转换<I> <I>user</I>@<I>domain</I> </I>为<I><I> prepend</I>-<I>user</I>@<I>domain</I> 
    </I>并且对待这个结果好像是本地域一样.<I> user@ </I>这个是可选的, 如果跳过它, 这个条目将匹配所有<I> @domain </I>域下面的地址<I>. 
    </I></P>
  <P>回到上文的 example 剧情里面, 如果 example.net 邮件管理员希望创建 virtual.example.com 虚拟域, 并且将这个域置于用户 
    john 的管理之下, virtualdomains 文件下面的虚拟域条目应该这样写: </P>
<PRE>    virtual.example.com:john
</PRE>
  <P>这样, 发往 joe@virtual.example.com 的邮件将会被修改为发往 john-joe@virtual.example.com 
    , 然后进行本地传送. 更多信息, 请参见 <A 
href="#dot-qmail-files">.qmail</A> 小节,  以及 <A 
href="#extension-addresses">扩展地址</A> 细目. 那里将介绍 john 如何管理他的虚拟域. </P>
  <P>使用多主机名的时候, 所有的虚拟域都必须在rcphosts列出, 这样 qmail-smtpd 才会知道那些地址应该被接受. 但是不像多主机名方式, 
    虚拟域<strong>不可以</strong>在locals里面设置相应条目. </P>
  <P>修改 virtualdomains文件之后, 发送给 qmail-send 一个 HUP (挂起) 信号, 通知它重新读取配置文件. 如果你使用本文的 
    qmailctl 脚本, 你可以运行如下命令: </P>
<PRE>    qmailctl reload
</PRE>
  <P>同时, 不要忘了在 rcpthosts 里面增加虚拟域条目. </P>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>域名服务器(DNS)的邮件交换器(MX)记录必须被设置为把虚拟域指向恰当的邮件服务器. 这是名字服务器管理员的工作, 
  超出了本文讨论的范围. 
  <HR align=left width="80%">

<P></P>
  <H2><A name=aliases>3.5. 别名</A></H2>
  <P>qmail的标准别名机制是由qmail的本地传送机制自然派生出来的.qmail-local 试图传送地址为<i> localpart</i>@host 
    的邮件给本地叫做<i> localpart </i>名字的用户. 如果没有匹配这个名字的用户存在, 邮件将会被发送给别名 alias 用户, 别名用户是qmail系统里面通常主目录位于 
    /var/qmail/alias 的伪用户.<i> </i></P>
  <P>举例, 如果你想要创建一个叫做 info@example.com 的别名, 这个别名用户将把上文收到的所有无主邮件转发给用户 tom, 在我们举例的 
    example.com 上, 这样作的方式是: 作为 root 用户, 运行下面的命令: </P>
<PRE>    echo \&amp;tom &gt; /var/qmail/alias/.qmail-info
</PRE>
  <P> <A 
href="#dot-qmail-files">.qmail</A> 小节,  以及 <A 
href="#extension-addresses">扩展地址</A> 细目介绍了如何创建 .qmail文件, 这些文件确定了那些别名存在, 以及如何处理哪些发给他们的邮件的. 
  </P>
  <P>附录 <A href="#gotchas">Gotchas</A> 介绍了两个关于别名应用的复杂案例. 那些别名使用了大写字母和小数点(&quot;.&quot;), 
    以及 .qmail 文件的 man 手册页面, 其中包含了完整的关于 .qmail 文件用法的文档. </P>
  <P>注意由于别名在 qmail 里面的实现方式, 别名是<strong>不能够</strong>重载一个合法用户的传送的. 例如, 如果 rachel 是一个普通用户, 
    那么~alias/.qmail-rachel 别名是无效的. </P>
  <P><I><A 
href="#fastforward">fastforward</A></I> 软件包另外提供了一个可行的别名机制, 它将多个别名放入单独一个和Sendmail别名数据库兼容的文件里面. 
  </P>
  <P>下一节, qmail-users, 描述了其他实现别名的机制. </P>
  <H2><A name=qmail-users>3.6. 关于 qmail-users </A></H2>
  <P><I>qmail-users </I>是一个分发地址给用户的系统. 由 /var/qmail/users 下的一系列文件构成. assign 文件是一个分配表. 
    有两种分配表的格式: 单体方式和通配符方式.<I> </I></P>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>assign 文件包含了一系列分配表, 每行一个, 后面接一个包含了一个单独的小数点(.)的行. 如果你手动创建assign文件, 
  不要忘记小数点那一行. 
  <HR align=left width="80%">

<P></P>
  <H3><A name=simple-assignment>3.6.1. 单体分配表 </A></H3>
  <P>一个单体分配表看起来是这个样子的:</P>
<PRE>=<I>address</I>:<I>user</I>:<I>uid</I>:<I>gid</I>:<I>directory</I>:<I>dash</I>:<I>extension</I>:
</PRE>
  <P>这个表的含义是: 作为 <I>address</I> 地址接收的邮件将会被使用用户 <I>user</I> 来传送, 使用指定的 <I>uid</I> 
    和 <I>gid</I>, 并且由<I> directory</I>/.qmail<I>dashextension</I> 这个文件决定邮件如何被传送. 
  </P>
  <H3><A name=wildcard-assignment>3.6.2. 通配符分配表 </A></H3>
  <P>通配符分配表看起来是这个样子的: </P>
<PRE>+<I>prefix</I>:<I>user</I>:<I>uid</I>:<I>gid</I>:<I>directory</I>:<I>dash</I>:<I>prepend</I>:
</PRE>
  <P>这个表的含义是: 作为 <I>prefix</I><I>rest</I> 地址里面匹配的邮件地址接收的邮件, 将会被使用用户 <I>user</I> 
    来传送, 使用指定的 <I>uid</I> 和 <I>gid</I>, <I></I> 并且由 <I>directory</I>/.qmail<I>dash</I><I>extension</I> 
    这个文件决定邮件如何被传送. </P>
  <H3><A name=qmail-user-programs>3.6.3. qmail-user 程序 </A></H3>
  <P>qmail-user 有两个辅助程序: qmail-newu 和 qmail-pw2u. </P>
  <P>qmail-newu 程序处理 assign 文件并且在 /var/qmail/users 下生成一个名为 cdb 的常量数据库(CDB)文件. 
    CDB是二进制格式, 所以在内含数千条分配表的情况下, 仍然可以被 qmail-lspawn 快速访问. </P>
  <P>qmail-pw2u 把系统用户数据库 /etc/passwd 转换为一系列适于 assign 的分配表. qmail-pw2u 使用一套文件集来修改翻译规则. 
    </P>
<UL>
    <LI>include: 要包括的用户 
    <LI>exclude: 不要包括的用户 
    <LI>mailnames: 用户的可替换的&quot;邮件帐户名字&quot;
    <LI>subusers: 用户控制的额外的地址, 使用可选的 .qmail 扩展方式 
    <LI>append: 其他分配表 </LI>
</UL>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>如果你使用qmail-pw2u, 不要忘记在增加和删除用户, 或者改变UID和GID之后, 重新运行一下qmail-pw2u和qmail-newu. 
  标准的运行次序如下所示:<STRONG> </STRONG>
<P></P><PRE>    qmail-pw2u &lt;/etc/passwd &gt;/var/qmail/users/assign
    qmail-newu
</PRE>
<P>
<HR align=left width="80%">

<P></P>
  <H2><A name=spam>3.7. 反垃圾邮件 </A></H2>
  <P>Chris Hardie 写了一个极好的的qmail反垃圾邮件 HOWTO. 可以在这个地址访问到它: <A 
href="http://www.summersault.com/chris/techno/qmail/qmail-antispam.html">http://www.summersault.com/chris/techno/qmail/qmail-antispam.html</A>. 
  </P>
  <H2><A name=viruses>3.8. 病毒扫描 </A></H2>
  <P>Jason Haar编写了 Qmail-Scanner, 一个为qmail设计的内容扫描装置. 更多信息请参见 <A 
href="http://qmail-scanner.sourceforge.net/">http://qmail-scanner.sourceforge.net/</A>. 
  </P>
  <P>Qmail-Scanner 包括了一个简单的内置扫描器, 不过严肃一些的内容扫描需要一个单独的病毒扫描程序--可以是一个Qmail-Scanner支持的商业扫描程序, 
    或者选用 Tomasz Kojm 的免费的 Clam Antivirus 扫描器, 可以在 <A 
href="http://clamav.elektrapro.com/">http://clamav.elektrapro.com/</A> 这个地址找到它. 
  </P>
<HR>

  <H1><A name=usage>4. 使用方法 </A></H1>
  <P>这一节介绍了qmail 针对普通用户的使用方法. 如果你在 qmail 系统上读信和发信, 那么你阅读本节就可以找到如何用qmail 达成你的目的了. 
  </P>
  <H2><A name=dot-qmail-files>4.1. .qmail 文件 </A></H2>
  <P>传送用户邮件通常是由一个或者几个 &quot;.qmail&quot;(发音 dot kyoo mail) 文件控制的. 这些文件位于用户的主目录, 
    文件名由 .qmail 开头. .qmail 的man 手册页面描述了 .qmail 文件使用方法. </P>
  <P>.qmail 文件包括了一个传送指令清单, 每行一个指令. 每行的第一个字符决定了选择那种传送方式. </P>
<TABLE class=columns border=1>
  <TBODY>
  <TR class=heading>
        <TD><STRONG>字符 </STRONG></TD>
        <TD><STRONG>传送类型 </STRONG></TD>
        <TD><STRONG>值 </STRONG></TD>
    </TR>
  <TR>
    <TD># </TD>
        <TD>无<em> (注释)</em> </TD>  <TD>忽略</TD>
    </TR>
  <TR>
    <TD>| </TD>
        <TD>程序 </TD>  <TD>由shell 执行的命令 </TD>
    </TR>
  <TR>
      <TD>/ 或者 . </TD>
        <TD>mbox邮箱格式<em> (如果路径最后一个字符不是一个斜杠)</em> </TD>
      <TD><p>mbox 的路径名<em> (包括斜杠&quot;/&quot;或者 点&quot;.&quot;) </em></p>
        </TD>
    </TR>
  <TR>
      <TD>/ 或者 . </TD>
        <TD>maildir邮箱格式 <em>(如果路径最后一个字符是一个反斜杠)</em> </TD>  <TD>maildir 的路径名 <em> (包括斜杠&quot;/&quot;或者 点&quot;.&quot;)</em> </TD>
    </TR>
  <TR>
    <TD>&amp; </TD>
        <TD>转发 </TD>  <TD>转发邮件的地址 </TD>
    </TR>
  <TR>
        <TD>字母或者数字</TD>  <TD>转发 </TD>  <TD>转发邮件的地址 <em>(包括第一个字符) </em></TD>
    </TR></TBODY></TABLE>
  <H3><A name=program-delivery>4.1.1. 程序传送 </A></H3>
  <P>如果指令是由程序传送, qmail 启动一个 shell (/bin/sh) 来执行这个命令, 然后把邮件的一个副本从标准输入传送给这个命令. </P>
  <P>程序传送是非常强大的, 被用来实现的功能范围非常广阔, 例如邮件过滤, 自动回复, 以及通过第三方传送代理比如procmail来传送邮件. </P>
  <P>例如: </P>
<PRE>    |preline /usr/ucb/vacation djb
</PRE>
  <P>这个指令操作qmail 启动preline, 将 /usr/ucb/vacation 和 djb 作为参数传送给 preline, 并且在标准输入传送邮件的副本给这个命令. 
  </P>
  <H3><A name=mbox-delivery>4.1.2. mbox 格式邮箱的邮件投递 </A></H3>
  <P>mbox 是标准的UNIX邮箱格式, 多个邮件存放在一个独立文件内, 每个邮件由一个&quot;From&quot; 的行开始. 这一行看起来像一个标题字段, 
    不过那不是标题, 那仅仅是传送代理添加的, 便于邮件读出器可以找到每个邮件开始部分的一个标记. </P>
  <P>例如: </P>
<PRE>    ./Mailbox
</PRE>
  <P>这个设置表示邮件将被追加到 $HOME/Mailbox 文件上, 每个邮件由&quot;From&quot;引领. 一个存放了一个单独邮件的简单的mbox 
    的邮箱看起来是下面这个样子的: </P>
<PRE>    From user1@example.net Thu May 13 18:34:50 1999
    Received: (qmail 1287205 invoked from network); 13 May 1999 18:34:49 -0000
    From: user1@example.net
    To: user2@example.com
    Subject: hey

    What's up?
</PRE>
  <P>第一行是 qmail 传送邮件时添加的.</P>
  <H3><A name=maildir-delivery>4.1.3. maildir 格式邮箱的邮件投递 </A></H3>
  <P>maildir 是 Dan Bernstein 为了表明 mbox 邮箱格式的缺陷而创造的格式. 一个 maildir 邮箱包含三个子目录, new, 
    cur, 和 tmp. 在各个子目录下的每个邮件根据状态的不同分别存储在各个子目录下独立的文件中. 未读邮件存储在new中, cur存储已读邮件, 
    tmp 是为那些正在传送过程中的邮件使用的. maildir 的man手册页详细描述了maildir格式的细节. </P>
  <P>maildir 格式的优点之一就是保证邮件传输的安全, 即使在不锁定情况下, 不同邮件代理同时更新邮件, 也能保证传输的可靠. 这意味着maildir 
    邮箱可以安全的建立在以NFS性质挂接的文件系统上. </P>
  <P>例如: </P>
<PRE>    ./Maildir/
</PRE>
  <P>这个设置表示将把邮件存储在 $HOME/Maildir 下面的 maildir 格式的邮箱. </P>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>qmail-local 可以将邮件传送到 maildir 格式邮箱, 但是不能创建这种邮箱. 你需要使用qmail 
  附带的maildirmake 程序来创建 maildir 格式邮箱. 例如: &quot;maildirmake ~/Maildir&quot;. 不过要确定你使用maildir的拥有者运行maildirmake, 
  而<strong>不是</strong> root 用户. 另外的方式, 你的 useradd 和 adduser 命令可能支持&quot;skeleton&quot;骨架目录, 
  例如: /etc/skel, 然后可以直接复制这个目录给所有新用户.<STRONG> </STRONG>
<HR align=left width="80%">

<P></P>
  <H3><A name=forward-delivery>4.1.4. 转发邮件</A></H3>
  <P>转发邮件就是将邮件重发到指定地址. 由.qmail文件内的命令不能包含注释部分和多余的空格. </P>
  <P>下面的写法是<strong>错的</strong>: </P>
<PRE>    &amp;&lt;user@example.com&gt;
    &amp; user@example.com
    &amp;Joe User &lt;user@example.com&gt;
</PRE>
  <P>下面的是正确的写法: </P>
<PRE>    &amp;user@example.com
    user@example.com
    &amp;user
</PRE>
  <P>前两个将邮件副本转发给 user@example.com, 最后一个将邮件副本转发给本地用户 user. </P>
  <H3><A name=extension-addresses>4.1.5. 扩展地址 </A></H3>
  <P>qmail 支持用户控制扩展地址. 在基本地址 <I>username@hostname.domain </I>上扩展的扩展地址为:<I> username-extension@hostname.domain 
    </I>,用户同样可以接收发往扩展地址的邮件. 在本节其余部分, 我们讨论的范围都是在本地系统上, 所以我们将不再使用&quot;@hostname.domain&quot; 
    部分. </P>
  <P>对于型如<I>username</I>-<I>extension</I> 的扩展地址的传送指令由用户目录下的~<I>username</I>/.qmail-<I>extension</I> 
    文件指定. </P>
  <P>举一个例子, dave-lwq@sparge.example.com 这个扩展地址的传送将由文件 ~dave/.qmail-lwq 
    来控制. </P>
  <P>扩展地址可以拥有多个字段, 例如 dave-list-qmail 这个扩展地址, 由 ~dave/.qmail-list-qmail 
    来控制. 在这个例子里面, dave-list-qmai 这个地址被用来订阅 qmail 的邮件列表, ~dave/.qmail-list-qmail 
    则负责归档这个列表的邮件到单独的邮箱里面. </P>
  <P>.qmail 文件可以用-default 后缀进行匹配。 所以 dave-list-qmail 可以由 ~dave/.qmail-list-default 
    操作. 这个文件可以一对多方式用一个.qmail文件控制所有型如 dave-list-加上任何后缀的地址. 注意 dave-list 不能由 ~dave/.qmail-list-default 
    控制, 因为在&quot;list&quot;后面没有&quot;-&quot;. </P>
  <P><I>qmail </I>会使用最接近的匹配方式. 例如, <I>qmail在传送一个标志着送给dave-list-qmail这个地址的邮件时, 会按照下面顺序查找.qmail控制文件, 
    并按照最先匹配的.qmail文件传送这个邮件. </I></P>
<PRE>    .qmail-list-qmail
    .qmail-list-default
    .qmail-default
</PRE>
  <P>如果没有找到相匹配的.qmail文件, 传送失败, 并且将邮件反弹给发送者. </P>
  <H2><A name=sending-messages>4.2. 发送邮件 </A></H2>
  <P>邮件用户通常并不直接发送邮件. 典型的方式是利用邮件用户代理(Mail User Agent, MUA)程序, 例如 pine 或者 mutt 编写并发送邮件. 
    MUA程序调用MTA传送邮件. 这个处理邮件到MTA的调用过程称为注入(injection). </P>
  <P>有两种方式完成注入, 一种利用SMTP协议(Simple Mail Transfer Protocol, SMTP), 或者利用MTA提供的的特定程序. 
  </P>
  <H3><A name=smtp>4.2.1. SMTP 方式 </A></H3>
  <P>MUA程序可以使用TCP协议连接到标准的SMTP协议端口25, 可以是本地主机或者指定的邮件服务器. MUA和MTA后续进行的回话导致两个结果: </P>
<UL>
    <LI>邮件被传送给MTA, 或者
    <LI>返回一份错误报告给MUA </LI>
</UL>
  <P>SMTP没有身份认证的机制, 所以发送邮件的过程是不要求用户名和密码的. 但是, 大多数MTA拒绝接收既不是来自本地用户也不是发送给本地用户的邮件的. 
    如果一个恰当的格式的邮件被MTA拒绝, 最大的可能就是转信限制造成. 参见<a href="#relaying">转信</a>小节查看更多的如何配置转信的信息. 
  </P>
  <H3><A name=/var/qmail/bin/sendmail>4.2.2. /var/qmail/bin/sendmail 文件 </A></H3>
  <P>很多年以来, UNIX MTA一直都是Sendmail. 由于Sendmail的应用十分普遍, 许多程序员假定它是默认的MTA. 结果, Sendmail的本地注入机制成为标准的本地邮件注入的应用编程接口(Application 
    Programmer's Interface, API). qmail 以及其他非Sendmail的MTA因此也提供一个sendmail程序应用于本地注入方式上, 
    它的工作方式和真正的Sendmail 的 sendmail程序一样. </P>
  <P>qmail 的用于替换Sendmail相应部分的 sendmail 程序, 通常位于 /var/qmail/bin/sendmail, 典型的Sendmail的程序包括下面这些位置: 
  </P>
<UL>
  <LI>/usr/lib/sendmail 
  <LI>/usr/sbin/sendmail</LI></UL>
  <P>在qmail系统里面, 使用命令"ls -l <I>path-to-sendmail</I>"将会显示出, sendmail实际上是一个指向/var/qmail/bin/sendmail 
    的符号连接. </P>
<PRE>  $ ls -l /usr/lib/sendmail
  lrwxrwxrwx   1 root     root           29 Feb 19 11:04 /usr/lib/sendmail -&gt; /var/qmail/bin/sendmail
</PRE>
  <H3><A name=qmail-inject>4.2.3. qmail-inject </A></H3>
  <P>除了模仿 sendmail 的 API之外, qmail 也拥有自己的注入程序: qmail-inject. 实际上, qmail提供的sendmail 
    程序只是一个qmail-inject的外壳程序. </P>
  <P>作为一个API标准, sendmail可能更好用, 因为它使用广泛. qmail的API由qmail-inject提供, 只能在qmail系统下运行, 
    而sendmail接口几乎是通用的. </P>
  <P>举一个例子, 可以这样发送一个空白邮件给 joe@example.com: </P>
<PRE> echo To: joe@example.com | /var/qmail/bin/qmail-inject
</PRE>
  <H2><A name=environment-variables>4.3. 环境变量 </A></H2>
  <P>一些qmail程序设定和使用环境变量, 下面的表格列出了这些变量并且描述了他们的用法. </P>
<TABLE class=columns border=1>
  <TBODY>
  <TR class=heading>
        <TD><STRONG>名字 </STRONG></TD>
        <TD><STRONG>Man 帮助页</STRONG></TD>
        <TD><STRONG>设置/使用</STRONG></TD>
        <TD><STRONG>使用目的</STRONG></TD>
    </TR>
  <TR>
    <TD><A name=DATABYTES>DATABYTES</A> </TD>
    <TD>qmail-smtpd </TD>
        <TD>使用 </TD>
        <TD>重载control/databytes文件 </TD>
    </TR>
  <TR>
    <TD><A name=DEFAULT>DEFAULT</A> </TD>
    <TD>qmail-command </TD>
        <TD>设置 </TD>
        <TD>在.qmail文件名中匹配&quot;-default&quot;的地址部分 </TD>
    </TR>
  <TR>
    <TD><A name=DTLINE>DTLINE</A> </TD>
    <TD>qmail-command </TD>
        <TD>设置 </TD>
        <TD>邮件头Delivered-To部分 </TD>
    </TR>
  <TR>
    <TD><A name=EXT>EXT</A> </TD>
    <TD>qmail-command </TD>
        <TD>设置 </TD>
        <TD>地址扩展 </TD>
    </TR>
  <TR>
    <TD><A name=EXT2>EXT2</A> </TD>
    <TD>qmail-command </TD>
        <TD>设置 </TD>
        <TD>第一个破折号后面的EXT的一部分 </TD>
    </TR>
  <TR>
    <TD><A name=EXT3>EXT3</A> </TD>
    <TD>qmail-command </TD>
        <TD>设置 </TD>
        <TD>第二个破折号后面的EXT的一部分 </TD>
    </TR>
  <TR>
    <TD><A name=EXT4>EXT4</A> </TD>
    <TD>qmail-command </TD>
        <TD>设置 </TD>
        <TD>第三个破折号后面的EXT的一部分 </TD>
    </TR>
  <TR>
    <TD><A name=HOME>HOME</A> </TD>
    <TD>qmail-command </TD>
        <TD>设置 </TD>
        <TD>用户的主目录 </TD>
    </TR>
  <TR>
    <TD><A name=HOST>HOST</A> </TD>
    <TD>qmail-command </TD>
        <TD>设置 </TD>
        <TD>接收地址的域名部分 </TD>
    </TR>
  <TR>
    <TD><A name=HOST2>HOST2</A> </TD>
    <TD>qmail-command </TD>
        <TD>设置 </TD>
        <TD>在最后的点前面的HOST部分 </TD>
    </TR>
  <TR>
    <TD><A name=HOST3>HOST3</A> </TD>
    <TD>qmail-command </TD>
        <TD>设置 </TD>
        <TD>在倒数第二个的点前面的HOST的一部分 </TD>
    </TR>
  <TR>
    <TD><A name=HOST4>HOST4</A> </TD>
    <TD>qmail-command </TD>
        <TD>设置 </TD>  <TD>在倒数第三个的点前面的HOST的一部分 </TD>
    </TR>
  <TR>
    <TD><A name=LOCAL>LOCAL</A> </TD>
    <TD>qmail-command </TD>
        <TD>设置</TD>
        <TD>接收地址的local部分 </TD>
    </TR>
  <TR>
    <TD><A name=LOGNAME>LOGNAME</A> </TD>
    <TD>qmail-inject </TD>
        <TD>使用 </TD>  <TD>在邮件头From中的用户名(4) </TD>
    </TR>
  <TR>
    <TD><A name=MAILHOST>MAILHOST</A> </TD>
    <TD>qmail-inject </TD>
        <TD>使用 </TD>
        <TD>在邮件头From中的主机名(2)</TD>
    </TR>
  <TR>
    <TD><A name=MAILNAME>MAILNAME</A> </TD>
    <TD>qmail-inject </TD>
        <TD>使用 </TD>  <TD>在邮件头From中的个人姓名(2) </TD>
    </TR>
  <TR>
    <TD><A name=MAILUSER>MAILUSER</A> </TD>
    <TD>qmail-inject </TD>
        <TD>使用 </TD>
        <TD>在邮件头From中的用户名(2) </TD>
    </TR>
  <TR>
    <TD><A name=NAME>NAME</A> </TD>
    <TD>qmail-inject </TD>
        <TD>使用 </TD>
        <TD>在邮件头From中的个人姓名(3) </TD>
    </TR>
  <TR>
    <TD><A name=NEWSENDER>NEWSENDER</A> </TD>
    <TD>qmail-command </TD>
        <TD>设置 </TD>
        <TD>转发的发送人地址(参考命令&quot;man dot-qmail&quot;) </TD>
    </TR>
  <TR>
    <TD><A name=QMAILDEFAULTDOMAIN>QMAILDEFAULTDOMAIN</A> </TD>
    <TD>qmail-inject </TD>
        <TD>使用 </TD>  <TD>重载ontrol/defaultdomain 文件 </TD>
    </TR>
  <TR>
    <TD><A name=QMAILDEFAULTHOST>QMAILDEFAULTHOST</A> </TD>
    <TD>qmail-inject </TD>
        <TD>使用 </TD>  <TD>重载control/defaulthost 文件 </TD>
    </TR>
  <TR>
    <TD><A name=QMAILHOST>QMAILHOST</A> </TD>
    <TD>qmail-inject </TD>
        <TD>使用 </TD>  <TD>在邮件头From中的主机名(1)</TD>
    </TR>
  <TR>
    <TD><A name=QMAILIDHOST>QMAILIDHOST</A> </TD>
    <TD>qmail-inject </TD>
        <TD>使用 </TD>
        <TD>重载control/idhost 文件 </TD>
    </TR>
  <TR>
    <TD><A name=QMAILINJECT>QMAILINJECT</A> </TD>
    <TD>qmail-inject </TD>
        <TD>使用 </TD>
        <TD>指定几个选项(参见下面的表格) </TD>
    </TR>
  <TR>
    <TD><A name=QMAILMFTFILE>QMAILMFTFILE</A> </TD>
    <TD>qmail-inject </TD>
        <TD>使用 </TD>
        <TD>包含下一级跟踪的邮件地址列表的文件 </TD>
    </TR>
  <TR>
    <TD><A name=QMAILNAME>QMAILNAME</A> </TD>
    <TD>qmail-inject </TD>
        <TD>使用 </TD>
        <TD>在邮件头From中的个人姓名(1) </TD>
    </TR>
  <TR>
    <TD><A name=QMAILPLUSDOMAIN>QMAILPLUSDOMAIN</A> </TD>
    <TD>qmail-inject </TD>
        <TD>使用 </TD>
        <TD>重载 control/plusdomain 文件</TD>
    </TR>
  <TR>
    <TD><A name=QMAILSHOST>QMAILSHOST</A> </TD>
    <TD>qmail-inject </TD>
        <TD>使用 </TD>
        <TD>信封上发送者地址中的主机名 </TD>
    </TR>
  <TR>
    <TD><A name=QMAILSUSER>QMAILSUSER</A> </TD>
    <TD>qmail-inject </TD>
        <TD>使用 </TD>
        <TD>信封上发送者地址中的用户名 </TD>
    </TR>
  <TR>
    <TD><A name=QMAILUSER>QMAILUSER</A> </TD>
    <TD>qmail-inject </TD>
        <TD>使用 </TD>
        <TD>在邮件头From中的用户名(1) </TD>
    </TR>
  <TR>
    <TD><A name=RECIPIENT>RECIPIENT</A> </TD>
    <TD>qmail-command </TD>
        <TD>设置</TD>  <TD>信封上接收者的地址 </TD>
    </TR>
  <TR>
    <TD><A name=RELAYCLIENT>RELAYCLIENT</A> </TD>
    <TD>qmail-smtpd </TD>
        <TD>使用 </TD>
        <TD>忽略 control/rcpthosts 文件然后在接收地址后添加值 </TD>
    </TR>
  <TR>
    <TD><A name=RPLINE>RPLINE</A> </TD>
    <TD>qmail-command </TD>
        <TD>设置 </TD>  <TD>邮件头返回路径 </TD>
    </TR>
  <TR>
    <TD><A name=SENDER>SENDER</A> </TD>
    <TD>qmail-command </TD>
        <TD>设置 </TD>
        <TD>信封上发送者地址</TD>
    </TR>
  <TR>
    <TD><A name=UFLINE>UFLINE</A> </TD>
    <TD>qmail-command </TD>
        <TD>设置 </TD>  <TD>UUCP风格的&quot;From&quot;行 </TD>
    </TR>
  <TR>
    <TD><A name=USER>USER</A> </TD>
    <TD>qmail-command </TD>
        <TD>设置 </TD>  <TD>当前的用户 </TD>
    </TR>
  <TR>
    <TD><A name=USER>USER</A> </TD>
    <TD>qmail-inject </TD>
        <TD>使用 </TD>
        <TD>邮件头From中的用户名 (3) </TD>
    </TR></TBODY></TABLE>
<TABLE class=columns border=1>
  <CAPTION align=top>
  QMAILINJECT 标志位 QMAILINJECT Flags 
  </CAPTION>
  <TBODY>
    <TR class=heading> 
        <TD><STRONG>字母</STRONG></TD>  <TD><STRONG>使用目的 </STRONG></TD>
    </TR>
    <TR> 
      <TD>c </TD>
        <TD>为From部分使用地址注释风格</TD>
    </TR>
    <TR> 
      <TD>s </TD>
        <TD>不考虑任何进入邮件的返回路径部分 </TD>
    </TR>
    <TR> 
      <TD>f </TD>
        <TD>删除所有进入邮件的From部分 </TD>
    </TR>
    <TR> 
      <TD>i </TD>
        <TD>删除所有进入邮件的Message-ID部分 </TD>
    </TR>
    <TR> 
      <TD>r </TD>
        <TD>使用每接收者VERP </TD>
    </TR>
    <TR> 
      <TD>m </TD>
        <TD>使用每邮件VERP </TD>
    </TR>
  </TBODY>
</TABLE>
<HR>

  <H1><A name=advanced-topics>5. 高级话题</A></H1>
<H2><A name=procmail>5.1. 关于 <I>procmail</I></A></H2>
  <P>procmail 是一个流行的邮件传送代理( Message Delivery Agent , MDA). MDA的功能是从MTA为特定用户或者邮箱接收邮件, 
    然后按照用户的要求传送邮件的程序. procmail 可以用来针对邮件主体或者不同的邮件头内容过滤邮件. 举一个例子, 从某个特定的人发来的邮件可以被定向传送到某个专门为这个人准备的邮箱.</P>
  <P>在qmail上应用procmail有两个技巧. 第一个, procmail 通常被配置成传送邮件到/var/spool/mail 下的邮箱. 你可以重新设置安装procmail到缺省的$HOME路径下, 
    或者指导用户不要依赖procmail 投递邮件到默认的mbox位置. 除非你为$HOME邮件投递打补丁, 否则, procmail依然会使用/var/spool/mail 
    作为临时文件. </P>
  <P>另外一个问题是qmail-command和procmail使用的退出码是不同的. procmail使用的是标准UNIX退出码: 零代表成功, 非零代表失败, 
    失败的原因由/usr/include/sys/errno.h 定义. qmail-command 使用某个非零码指示永久错误, 其余作为临时码. 解决方式可以应用一个小的shell脚本为 
    qmail-command 翻译退出码. 这样的一个shell脚本曾经在qmail 邮件列表刊登, 现在被存档在这个位置<a href="http://www.ornl.gov/its/archives/mailing-lists/qmail/1998/04/msg00487.html">http://www.ornl.gov/its/archives/mailing-lists/qmail/1998/04/msg00487.html</a>. 
  </P>
  <P>同样的情况, 旧版本的procmail(3.14之前)不能直接传送邮件给maildir格式的邮箱. 最好的办法是升级你的procmail到最新版本. 
    另外一个解决办法是使用safecat, 这个程序将标准输入的邮件写入指定的maildir格式的邮箱. 用户可以使用 procmail 处方(传送指令)来使用<I><A 
href="#safecat">safecat</A></I> 保存邮件. 也可以完全跳过procmail, 使用<I><A 
href="#maildrop">maildrop</A></I>. </P>
  <P>最后, procmail 认为邮件将被接收到mbox格式的邮箱, 常规的qmail传送程序仅仅包括实际的邮件, 而不包括&quot;From&quot;行. 
    这里可以使用preline 命令来格式化邮件, 以保证procmail的要求. 上面链接的脚本就包括了 preline. </P>
  <P>举一个例子, 假设用户&quot;dave&quot;希望用procmail来处理他的邮件. 他的系统管理员设置procmail来传送邮件到默认的$HOME, 
    并且已经配置好了上面的退出码翻译脚本程序, 位置在 /usr/local/bin/qmail-procmail, 那么他的.qmail文件应该是这个样子的: 
  </P>
<PRE>    |/usr/local/bin/qmail-procmail
</PRE>
  <H2><A name=pop-imap-servers>5.2. POP 和 IMAP 服务器 </A></H2>
  <P>qmail包括一个POP服务器, qmail-pop3d, 不过并没有作为qmail\安装过程的一部分. 你可以选用其他POP或者IMAP服务器, 尽管他们大多数都是为Sendmail编写的, 
    在qmail下运行这些服务器时, 需要作一些额外工作. </P>
<H3><A name=qmail-pop3d>5.2.1. <I>qmail-pop3d</I></A></H3>
  <P>qmail-pop3d 是qmail自带的很不错的POP服务器. 很多qmail站点都使用它作为POP服务器. 它是模块化的, 可以通过不同的认证模块支持多种认证方案. 
  </P>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>qmail-pop3d<STRONG>只</STRONG>支持maildir格式的邮箱, 所以如果你的用户登录到POP服务器并且在本地运行MUA程序, 
  这些程序必须支持maildir格式的邮箱. 如果所有用户都是通过POP来读取邮件, 那么服务器端的邮箱格式就不是什么问题了. 
  <HR align=left width="80%">

<P></P>
  <H4><A name=pop3d-arch>5.2.1.1. qmail-pop3d的结构 </A></H4>
  <P>qmail-pop3d服务器包括三个模块: </P>
<UL>
    <LI>qmail-popup: 取得用户名/密码 
    <LI>checkpassword: 鉴别用户名/密码 
    <LI>qmail-pop3d: POP后台服务程序</LI>
</UL>
  <P>典型的, qmail-popup由inetd 或者 tcpserver运行, 在110端口监听, 一旦有连接, 它将提示输入用户名和密码, 然后它调用checkpassword来校验用户名/密码, 
    通过校验后调用qmail-pop3d. </P>
  <H4><A name=pop3d-installation>5.2.1.2. 安装 qmail-pop3d </A></H4>
  <P>1. 完整安装并测试qmail. 如果你希望所有用户都拥有POP可收发的邮箱, 确定 defaultdelivery 参数已经设置为 ./Maildir/. 
    如果你是按照本文的安装小节安装的qmail, /var/qmail/rc脚本已经被安装到恰当位置, 那么在文件 control/defaultdelivery 
    中配置了这个参数. 如果不是这样安装的, 可能在/var/qmail/rc 的 qmail-start 命令行上. </P>
  <P>2. 从<A 
href="http://www.qmail.org/top.html#checkpassword">http://www.qmail.org/top.html#checkpassword</A>下载checkpassword 
    程序. 如果你不需要其他特别的东西, 也可以在<A 
href="http://cr.yp.to/checkpwd.html">http://cr.yp.to/checkpwd.html</A> 下载标准的checkpassword程序. 
  </P>
  <P>3. 按照安装指导编译并安装checkpassword程序. 确定你安装程序到 /bin/checkpassword 下. </P>
  <P>4. 创建一个/var/qmail/supervise/qmail-pop3d/run 脚本, 包括如下内容: </P>
<PRE>    #!/bin/sh
    exec /usr/local/bin/softlimit -m 2000000 \
        /usr/local/bin/tcpserver -v -R -H -l 0 0 110 /var/qmail/bin/qmail-popup \
            <I>FQDN</I> /bin/checkpassword /var/qmail/bin/qmail-pop3d Maildir 2&gt;&amp;1
</PRE>
  <P>这里 <em>FQDN</em> 是你建立的POP服务器的完整的有资格的正式域名, 例如, pop.example.net. </P>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>由softlimit命令指定的内存使用限度是可以依赖于你是用的的硬件平台和操作系统适当提高的. 当连接到110端口失败或者POP3连接以难以理解的方式失败情况下, 
  试着将这个参数提高到3000000或者5000000. 
  <HR align=left width="80%">

<P></P>
  <P>5. 创建包括以下内容的/var/qmail/supervise/qmail-pop3d/log/run 文件. </P>
<PRE>    #!/bin/sh
    exec /usr/local/bin/setuidgid qmaill /usr/local/bin/multilog t \
        /var/log/qmail/pop3d
</PRE>
  <P>6. 建立log日志文件夹并且设置相应的run脚本, 将脚本链接到 /service 目录: </P>
<PRE>    chmod +t /var/qmail/supervise/qmail-pop3d   <I># if daemontools &lt; 0.75</I>
    mkdir /var/log/qmail/pop3d
    chown qmaill /var/log/qmail/pop3d
    chmod 755 /var/qmail/supervise/qmail-pop3d/run
    chmod 755 /var/qmail/supervise/qmail-pop3d/log/run
    ln -s /var/qmail/supervise/qmail-pop3d /service
</PRE>
  <P>7. 将下面内容加入qmailctl脚本的&quot;start&quot;部分 </P>
<PRE>    if svok /service/qmail-pop3d ; then
      svc -u /service/qmail-pop3d /service/qmail-pop3d/log
    else
      echo qmail-pop3d supervise not running
    fi
</PRE>
  <P>8. 将下面内容加入qmailctl脚本的&quot;stop&quot;部分 </P>
<PRE>    echo "  qmail-pop3d"
    svc -d /service/qmail-pop3d /service/qmail-pop3d/log
</PRE>
  <P>9. 将下面内容加入qmailctl脚本的&quot;stat&quot;部分 </P>
<PRE>    svstat /service/qmail-pop3d
    svstat /service/qmail-pop3d/log
</PRE>
  <P>10. 将下面内容加入qmailctl脚本的&quot;pause&quot;部分 </P>
<PRE>    echo "Pausing qmail-pop3d"
    svc -p /service/qmail-pop3d
</PRE>
  <P>11. 将下面内容加入qmailctl脚本的&quot;cont&quot;部分 </P>
<PRE>    echo "Continuing qmail-pop3d"
    svc -c /service/qmail-pop3d
</PRE>
  <P>12. 将下面内容加入qmailctl脚本的&quot;restart&quot;部分 </P>
<PRE>    echo "* Restarting qmail-pop3d."
    svc -t /service/qmail-pop3d /service/qmail-pop3d/log
</PRE>
<H3><A name=qpopper>5.2.2. <I>Qpopper</I></A></H3>
  <P>如果你需要一个在mbox格式邮箱下工作的的POP后台服务程序, 你可以选用 Qualcomm的 Qpoper. 它的主页在<A 
href="http://www.eudora.com/qpopper_general/">http://www.eudora.com/qpopper_general/</A>. 
  </P>
<H3><A name=solidpop>5.2.3. <I>SolidPOP</I></A></H3>
  <P>SolidPOP这个POP3服务器同时支持maildir和mbox格式的邮箱. 可以在 <A 
href="http://solidpop3d.pld.org.pl/">http://solidpop3d.pld.org.pl/</A> 访问它. </P>
<H3><A name=bincimap>5.2.4. <I>Binc IMAP</I></A></H3>
  <P>Andreas Hanssen 编写了 Binc IMAP服务器, 目前还处于 beta(开发) 状态. Binc IMAP被设计为和qmail-pop3d使用相同的认证机制(checkpassword), 
    所以它很适合于qmail服务器. 和qmail-pop3d一样, 它只支持maildir格式的邮箱. 可以在<A 
href="http://www.bincimap.andreas.hanssen.name/">http://www.bincimap.andreas.hanssen.name/</A> 
    访问到它. </P>
<H3><A name=imap-maildir>5.2.5. <I>imap-maildir</I></A></H3>
  <P>David R. Harris 整理了有关 University of Washington IMAP 服务器的关于 maildir 格式支持的补丁, 
    并且存档了安装过程. 参见<A 
href="http://www.davideous.com/imap-maildir/">http://www.davideous.com/imap-maildir/</A> 
    . </P>
<H3><A name=courier-imap>5.2.6. <I>Courier-IMAP</I></A></H3>
  <P>Sam Varshavchik 编写了一个<strong>只</strong>支持maildir邮箱的IMAP 服务器. 可以在这里 <A 
href="http://www.inter7.com/courierimap/">http://www.inter7.com/courierimap/</A> 
    访问. </P>
  <H2><A name=pop-imap-clients>5.3. POP 和 IMAP 客户端 </A></H2>
<H3><A name=fetchmail>5.3.1. <I>fetchmail</I></A></H3>
  <P><I>fetchmail 是一个从POP或者IMAP服务器接收邮件并且再次本地注入的程序. fetchmail从qmail服务器接收邮件是没有问题的, 
    不过作为qmail的客户端, 要让它良好的工作, 有两个技巧. </I></P>
  <P>这里是一个在qmail系统上为某个用户配置的.fetchmailrc例子: </P>
<PRE>poll mail.example.net proto pop3 nodns
    user dsill with password flubgart is dave here
    fetchall forcecr
</PRE>
  <P>这个文件指示fetchmail 通过POP3协议连接mail.example.net服务器, 作为用户dsill\登录, 密码flubgart, 接收所有邮件, 
    然后传送这些邮件到 dave@localhost. forcecr 标志使fetchmail将每个邮件通过SMTP方式注入本地系统前对邮件的每行以回车符结束. 
    qmail要求如此. </P>
<H3><A name=getmail>5.3.2. <I>getmail</I></A></H3>
  <P>getmail 从POP服务器接收邮件然后传送到maildir格式的邮箱. 实际上它是个Python 脚本, 所以你在使用getmail之前需要安装Python解释器. 
  </P>
  <P>getmail 由 Charles Cazabon 编写, 他在这个位置<A 
href="http://www.qcc.sk.ca/~charlesc/software/getmail-2.0/getmail.html">http://www.qcc.sk.ca/~charlesc/software/getmail-2.0/getmail.html</A> 
    为getmail维护了一个网页.<I> </I></P>
  <H2><A name=multi-rcpt>5.4. Multi-RCPT 与 Single RCPT 传送方式的比较 </A></H2>
  <P>假如你是一个MTA, 你的一个用户发送一封邮件给 hostx.example.com上的三个人. 那么你有以下几种方式可以达成目标. </P>
<OL>
    <LI>你可以建立一个连接到hostx主机, 发送邮件的一个拷贝给第一个用户, 发送一个拷贝给第二个用户, 发送一个拷贝给第三个用户, 然后关闭连接. 
    <LI>你可以开始三个过程, 每一个都建立一个和hostx的SMTP连接, 给每个用户发送一份邮件的副本, 然后关闭连接. 
    <LI>你可以建立一个SMTP连接, 然后发送一个标志着传送给所有三个用户的副本, 然后关闭连接. </LI>
</OL>
  <P>第一个方法明显劣于第三个. 甚至邮件很小的情况下, 整个邮件传送也需要最长的时间. 如果邮件很大, 那么将会使用很长时间并且浪费大量网络带宽. </P>
  <P>所以, 划掉第一个. </P>
  <P>第二个和第三个方法有点意思. </P>
  <P>第三个方法仅仅建立一个连接到hostx, 而且只发送一个邮件的副本, 这个方式取得了最有效的带宽利用率. </P>
  <P>第二种方式建立多个连接, 并且传送了邮件的多个副本, 这是非常浪费带宽的, 不过由于SMTP协议的现状, 这个方式可以得到更少的来回往返延迟, 从而比第三中方式更快. 
    而且比第三种方式更简单, 进而MTA可以被编写使用一个更直接了当的方式来传送邮件. 最后, 由于每个接收者接收到属于他自己的哪一份邮件副本, 这样才有可能让MTA实现VERPs(参见下一节) 
  </P>
  <P>qmail 总是使用第二种方式(single RCPT). 而且没有补丁让qmail实现第三种方式(multiple RCPT)的传送-- 因为那将是一个<strong>非常大</strong>的修补工作.<I> 
    </I></P>
  <P>虽然有些病态的案例表明第二种方式比第三种方式更慢, 整体上, 系统的简单性和VERP取得的优势比这个更为重要. </P>
  <P>Single RCPT 传送方式比multiple RCPT方式的确使用了更多的带宽, 不过差别常常是被夸大了的. 绝大多数邮件至多只有两个接收者, 
    而他们通常是本别两个主机上的用户, 对于这样的情形, multi-RCPT没有任何优势. 甚至情况特殊些, 在一个邮件列表服务器上, 相对来说, multi-RCPT看起来会有很大帮助可是潜在的是非常微小的, 
    因为SMTP利用的往往只是带宽的很细碎的份额, 在绝大多数连接上, HTTP通常占用了最大的部分. </P>
  <P>举一个例子, 你的上行带宽的10%用于SMTP, 那么如果应用multi-RCPT, 假设你的SMTP带宽被降低, 比如, 25%, 那么实际上仅仅让你的SMTP需求带宽达到了总带宽的7.5%. 
  </P>
<H2><A name=verp>5.5. 关于 VERP</A></H2>
  <P>一旦一个邮件未能被传送, MTA的反应应该是按照信封上的返回路径(envelope return path, ERP)发送一个反弹邮件. 反弹邮件应该包括接收者的地址, 
    未能发送的原因, 以及故障是暂时的还是永久的信息. 尽管某些MTA做的不是正确的事情, 他们发送反弹邮件给邮件头的From区域标志的地址, 或者反弹邮件干脆不能识别接收者. 
  </P>
  <P>对于大多数用户到用户的邮件, 这种问题没什么大不了. 人们可以按照反弹定时和邮件内容来处理. 可是对于邮件列表, 糟糕的反弹将会严重的多. 订阅者移动, 
    转发邮件到他们的新地址, 如果新地址发生传送问题, 并且反弹邮件只包含了新地址, 那就无法知道到底是哪个订户的邮件被反弹了. </P>
  <P>Dan Bernstein 为这个问题提出一个解决方案称为VERP(Variable Envelope Return Path). 使用VERP, 发送给每个邮件列表订户的邮件都拥有唯一的返回路径. 
    这让反弹控制可以控制查找有问题的订阅者. </P>
  <P>举一个例子, 一个典型的非VERP邮件列表拥有的返回地址型如<I>listname</I>-owner@<I>domain</I>. 
    而对于VERP类型的邮件列表, 返回地址型如<I>listname</I>-owner-<U><I>subscriber</I>=<I>sdomain</I></U>@<I>ldomain</I>, 
    这里订户的地址 subscriber@sdomain被嵌入到列表拥有者&quot;owner&quot;和符号&quot;@&quot;之间了. (订阅者邮件地址的&quot;@&quot;符号被置换成等号&quot;=&quot;.) 
  </P>
  <P><I><A href="#ezmlm">ezmlm</A></I>邮件列表管理器使用VERP来自动控制反弹. 对于列表暂时的传送问题造成的某些邮件丢失, 
    这个管理器也提供让订阅者从列表存档文件中单独接收的功能. T</P>
  <P>Russell Nelson 为qmail下的Majordomo写了一个反弹控制器, 不过他没有再继续维护这个软件. 可以在这里<A 
href="http://www.qmail.org/bounceman-0.4.shar">http://www.qmail.org/bounceman-0.4.shar</A> 
    访问到它. </P>
  <H2><A name=troubleshooting>5.6. 故障处理 </A></H2>
  <H3><A name=processes>5.6.1. 进程</A></H3>
  <P>一个恰当运行着的, 完整的, 最小化安装的应该拥有下面的四个进程. </P>
<UL>
    <LI> 由用户qmails 运行的 qmail-send 
    <LI>由用户qmailq运行的qmail-clean 
    <LI>由用户qmailr运行的qmail-rspawn 
    <LI>由用户root运行的qmail-lspawn </LI>
</UL>
  <P>取决于你使用的何种UNIX, 下面两个命令的一个可能列出这些进程, 而且可能还要多一点: </P>
<PRE>    ps -ef | grep qmail
    ps waux | grep qmail
</PRE>
  <P>举个例子:</P>
<PRE>[dave@sparge dave]$ <B>ps waux|grep qmail</B>
dave      2222  0.0  0.8   836   348  p4 S    10:25   0:00 grep qmail
qmaild     351  0.0  1.0   840   400  ?  S N  12:43   0:00 /usr/local/bin/tcpserver -v -x /etc/tcp.smtp.cdb -u 49491 -g 31314 0 smtp /var/qmail/bin/qmail-smtpd-
qmaild    2220  0.0  1.0   844   420  ?  S N  10:25   0:00 /usr/local/bin/tcpserver -v -x /etc/tcp.smtp.cdb -u 49491 -g 31314 0 smtp /var/qmail/bin/qmail-smtpd-
qmaill     365  0.0  0.8   748   344  ?  S N  12:43   0:00 splogger qmail
<B>qmailq     368  0.0  0.7   736   292  ?  S N  12:43   0:00 qmail-clean</B>
<B>qmailr     367  0.0  0.6   732   272  ?  S N  12:43   0:00 qmail-rspawn</B>
<B>qmails     350  0.0  0.8   776   336  ?  S N  12:43   0:00 qmail-send</B>
root       340  0.0  0.6   724   252  ?  S N  12:43   0:00 /usr/local/sbin/supervise /var/supervise/qmail-send /var/qmail/rc
root       341  0.0  0.6   724   252  ?  S N  12:43   0:00 /usr/local/sbin/supervise /var/supervise/tcpserver-qmail /usr/local/bin/tcpserver -v -x /etc/tcp.smtp
<B>root       366  0.0  0.7   736   276  ?  S N  12:43   0:00 qmail-lspawn ./Mailbox</B>
[dave@sparge dave]$
</PRE>
  <P>如果你在supervise下运行qmail或qmail-smtpd, 像上面的例子那样, 你应该能看到上面那些进程. 如果你在tcpserver下运行qmail-smtpd, 
    你将看到一个父tcpserver进程加上每个活动的SMTP访问建立的连接的tcpserver进程. </P>
  <P>如果你使用splogger (或者 multilog 或者 cyclog) 来控制日志, 你应该还有一个 splogger(或者 multilog 或者 
    cyclog) 进程由用户qmaill运行着.</P>
  <P>同时, 如果qmail忙于传送本地和远程邮件, 你将会看到最高上限为 concurrencylocal 个数的qmail-local进程, 或者最高上限为 
    concurrencyremote 个数的qmail-remote 进程. </P>
  <H3><A name=logs>5.6.2. 日志 </A></H3>
<H4><A name=multilog>5.6.2.1. multilog</A></H4>
<H4></H4>
  <P>multilog, 是<I><A 
href="#daemontools">daemontools</A></I> 软件包内的一部分, 功能是将日志记录到指定文件夹内一系列文件上. </P>
  <P>日志文件夹将在multilog命令行上指定, 所以你可以检查你的qmail运行脚本来确定文件夹的位置. </P>
  <P>log文件夹内文件数量以及每个log文件的最大长度, 是由multilog的选项决定的. log日志文件名是以文件开始记录时刻的TAI (Temps 
    Atomique International) 时间戳命名的. daemontools里面的另外一个命令 tai64nlocal , 可以转换TAI时间戳为当地人类易读时间戳. 
  </P>
  <P>一个标准的multilog日志条目看起来是下面这样的: </P>
<PRE>@4000000038c3eeb104a6ecf4 delivery 153: success: did_1+0+0/
</PRE>
  <P>"@4000000038c3eeb104a6ecf4"是TAI时间戳, 为可选部分, 不过推荐在日志条目里面加上这个段, "delivery 153: 
    success: did_1+0+0/" 是日志消息本身. </P>
<H4><A name=splogger>5.6.2.2. splogger</A></H4>
  <P>splogger 使用syslog 日志记录系统给消息打时间戳, 然后将消息送往syslog后台服务程序. Syslog的配置文件为 /etc/syslog.conf. 
    发送给syslog的消息拥有功能和优先级属性. syslog按照定义在/etc/syslog.conf里面的条目过滤消息, 并依据功能和优先级将消息发往以下目标: 
    log日志文件, 远程日志主机, 或者控制台. splogger 默认情况下将记录到mail 功能下面, 所以用grep命令在syslog.conf文件里面查找&quot;mail&quot;可以显示出qmail的日志消息的配置.</P>
  <P>典型的位置包括: </P>
<UL>
  <LI>/var/log/syslog 
  <LI>/var/adm/SYSLOG 
  <LI>/var/log/maillog</LI></UL>
  <P>典型的syslog日志条目看起来是这样的: </P>
<PRE>Jun  3 11:35:23 sparge qmail: 928424123.963558 delivery 153: success: did_1+0+0/
</PRE>
  <P>"Jun 3 11:35:23" 是syslog时间戳 </P>
  <P>"sparge" 是发送这条消息的系统名子. </P>
  <P>"qmail:" 是splogger 放置在所有qmail日志条目前的标签. </P>
  <P>"928424123.963558" 是一个可选的TAI 时间戳 (参看下一节) </P>
  <P>"delivery 153: success: did_1+0+0/" 是日志消息本身.</P>
  <H4><A name=log-messages>5.6.2.3. 日志消息</A></H4>
  <P>下面是一段从本地系统发送一个邮件到远程系统的日志片断: </P>
<PRE><B>1</B> @4000000038c3eeb027f41c7c new msg 93869
<B>2</B> @4000000038c3eeb027f6b0a4 info msg 93869: bytes 2343 from &lt;dave@sill.org&gt; qp 18695 uid 49491
<B>3</B> @4000000038c3eeb02877ee94 starting delivery 2392: msg 93869 to remote lwq@w3.to
<B>4</B> @4000000038c3eeb0287b55ac status: local 0/10 remote 1/20
<B>5</B> @4000000038c3eeb104a13804 delivery 2392: success: 209.85.127.177_accepted_message.
   /Remote_host_said:_250_CAA01516_Message_accepted_for_delivery/
<B>6</B> @4000000038c3eeb104a4492c status: local 0/10 remote 0/20
<B>7</B> @4000000038c3eeb104a6ecf4 end msg 93869
</PRE>
  <P>第 1 行指出qmail接收到一条新邮件, 邮件的队列ID是93869. 队列ID是 /var/qmail/queue/mess/<I>NN</I>/ 
    包含这个邮件的队列文件的 i 节点数字. 队列ID将在这个消息存在于队列中的过程里保持全局唯一. </P>
  <P>第 2 行表明邮件来自 dave@sill.org, 并且大小为2343字节. </P>
  <P>第 3 行表明qmail-remote开始传送这个邮件到lwq@w3.to, 并且为这个传送指定了ID 2392. </P>
  <P>第 4 行指出 0 个本地传送和 1 个远程传送处于等待状态. </P>
  <P>第 5 行显示出 ID 2392 这个传送已经成功完成, 并且返回远程主机的回应, 这个回应里面常常包含了远程邮件管理员对于跟踪这个传送的有用信息. 
    在我们这个例子里面, "CAA01516"是远程系统的传送ID. </P>
  <P>第 6 行指出 0 个本地传送和 0个远程传送处于等待状态. 也就是传送已经完成了. </P>
  <P>第 7 行指出这个消息已经被传送完毕并且被移出队列. 这个时候, 队列ID 93869, 已经可以重用于其他传送ID了. </P>
  <H2><A name=big-servers>5.7. 大型服务器 </A></H2>
  <P>同时参考 <a href="#qmail-ldap">qmail-ldap</a> </P>
  <H3><A name=scalable-parallelism>5.7.1. 可伸缩的并行运算 </A></H3>
  <P>使用快速NFS网络文件服务器储存用户文件夹. 在文件服务器上建立多个平等优先级SMTP服务器传送maildir格式邮箱. </P>
  <H2><A name=migrating-to-qmail>5.8. 从 Sendmail 转移到 qmail </A></H2>
  <P>查看Dan Bernstein 的 Sendmail-&gt;qmail 网页 <A 
href="http://cr.yp.to/qmail/sendmail.html">http://cr.yp.to/qmail/sendmail.html</A>. 
  </P>
  <H2><A name=mailing-list-managers>5.9. 邮件列表管理器 </A></H2>
  <P>邮件列表管理器(MLM)是帮助邮件列表所有者运行邮件列表的的程序. 它的功能由两部分组成: 管理订阅者列表, 还有就是控制对订阅者的邮件再发. </P>
  <P>大多数(全部?)UNIX邮件列表管理器都可以和qmail 合作运行. </P>
<H3><A name=mlm-ezmlm>5.9.1. <I>ezmlm</I></A></H3>
  <P>ezmlm 是qmail的作者Dan Bernstein为qmail编写的邮件列表管理器. 它依赖于qmail服务器的几个特点工作, 最显著的, 就是它使用<A 
href="#verp">VERPs</A> 来可靠的处理反弹邮件. ezmlm 在众多邮件列表管理器(MLM)中显得有点独特, 它不是处理传送到中央MLM地址的命令, 
    而是将命令附加在列表名字后面. 例如, 发送邮件到&quot;foo-subscribe@list.example.net&quot; 来订阅 &quot;foo@list.example.net&quot; 
    的邮件列表, . </P>
  <P>关于ezmlm的更多信息, 参见 <A 
href="http://www.ezmlm.org/">http://www.ezmlm.org/</A>, 这是ezmlm的非正式web站点. ezmlm-idx的正式站点, 
    介绍了这个非常棒的add-on插件ezmlm-idx, 它包括了很多有用的特色. </P>
<H3><A name=mlm-majordomo>5.9.2. <I>Majordomo</I></A></H3>
  <P>Majordomo 是最受欢迎的UNIX MLM之一. 只要作很少的简单修改就可以使它和qmail很好的合作了. Russ Allbery曾经写了一个关于qmail和Majordomo的FAQ, 
    可以在这个位置访问<A 
href="http://www.eyrie.org/~eagle/faqs/mjqmail.html">http://www.eyrie.org/~eagle/faqs/mjqmail.html</A> 
    <I>.</I></P>
<H2><A name=patches>5.10. 补丁 Patches</A></H2>
  <P>qmail拥有各种各样的源代码补丁. 为了安装补丁, 下载补丁并且进入qmail源代码目录树, 使用patch 命令施加补丁. </P>
<PRE>    cd /usr/local/src/qmail/qmail-1.03
    patch -p0 &lt;/tmp/patchfile
</PRE>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>参考 patch 的 man 帮助页取得更多信息. 这仅仅是个例子. 你可能需要使用最新版本的GNU patch 
  来施加补丁, 参见<A 
href="http://www.gnu.org/software/patch/patch.html">http://www.gnu.org/software/patch/patch.html</A>. 
  <STRONG> </STRONG>
<P></P>
<P>
<HR align=left width="80%">
<P></P>
  <P>终止 qmail-send 来停止qmail, 或者如果你安装了 qmailctl 脚本, 那么这样: </P>
  <PRE>    qmailctl stop
</PRE>
  <P>然后重新编译和安装新的二进制代码: </P>
  <PRE>    make setup check
</PRE>
  <P>然后重新启动:</P>
  <PRE>    qmailctl start
</PRE>
  <P>最后测试qmail, 尤其是你打补丁的部分. </P>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>虽然<A 
href="http://www.qmail.org/">http://www.qmail.org/</A>列出了qmail的大量补丁, 但是他们中的<strong>任何一个都没有</strong>得到qmail作者的认可. 
  这些补丁可能引入qmail原本没有的安全, 可靠性, 效率以及功能性问题. 绝大多数qmail安装只是要求某些推荐的补丁.<STRONG> 请不要安装任何你不是明确需要的补丁. 
  </STRONG>
<P></P>
<P>
<HR align=left width="80%">

<P></P>
  <H3><A name=recommended-patches>5.10.1. 推荐的补丁 </A></H3>
  <P>qmail.org 有一个"Recommended Patches"小节 <A 
href="http://qmail.org/top.html#patches">http://qmail.org/top.html#patches</A> 
    . 这些补丁用于几个已知的qmail的bug. </P>
<H4><A name=errno-patch>5.10.1.1. errno.h patch</A></H4>
  <P>这个补丁修复 errno.h 头文件缺失问题. 参考 <A 
href="http://news.gmane.org/article.php?id=13960&amp;group=gmane.mail.qmail.general">http://news.gmane.org/article.php?id=13960&amp;group=gmane.mail.qmail.general</A> 
    查看这个补丁的细节解释. </P>
<H4><A name=qmail-local-tab-patch>5.10.1.2. qmail-local TAB patch</A></H4>
  <P>这个补丁修补处理.qmail文件内TAB字符开头问题的小bug. 参见<A 
href="http://www.ornl.gov/its/archives/mailing-lists/qmail/2000/10/msg00696.html">http://www.ornl.gov/its/archives/mailing-lists/qmail/2000/10/msg00696.html</A></P>
<H4><A name=0.0.0.0-patch>5.10.1.3. IP 0.0.0.0 patch</A></H4>
  <P>这个补丁将使qmail把 0.0.0.0 这个IP地址作为本地主机处理. <A 
href="http://www.suspectclass.com/~sgifford/qmail/qmail-0.0.0.0.patch">http://www.suspectclass.com/~sgifford/qmail/qmail-0.0.0.0.patch</A> 
    .</P>
<H3><A name=dns-patches>5.10.2. DNS</A></H3>
  <P>在历史上, DNS 的回答被限制在512字节以内. 一些大型站点反馈的 MX 记录要长于这个限度. 这样qmail和其他很多程序都会遇到这个DNS返回查询记录过长的问题. 
    有三种方式来修补qmail. </P>
  <H4><A name=dnscache>5.10.2.1. 从 djbdns 运行 dnscache </A></H4>
  <P>dnscache 顾名思义, 是一个DNS的缓存服务器. 它知道如何掌握很长的DNS反馈记录并且通常可以为所有服务提高DNS查询性能. 由于它不用给qmail打补丁, 
    这是目前为止最好的解决方式. 参见 <A 
href="#related-packages">相关软件包</A> 下的 <A 
href="#djbdns">djbdns</A> 节取得更多信息. </P>
  <H4><A name=dns-bump>5.10.2.2. 提高包缓存长度到65536 </A></H4>
  <P> 如果DNS反馈设置有切断位, 在近来的BIND解析库下工作时, 解析器编码为自动进行TCP查询. 虽然取决于你的系统如何管理系统内存页的情况下, 内存的最大浪费成为潜在存在的可能性, 
    不过这却是最简单的修补. 作这个修补, 只需要替换 dns.c 文件内的PACKETSZ为 65536, 然后重新编译安装qmail就行了. </P>
  <H4><A name=dns-davis></A>5.10.2.3. Christopher K. Davis' 的补丁, <A 
href="http://www.ckdhr.com/ckd/qmail-103.patch">http://www.ckdhr.com/ckd/qmail-103.patch</A> 
  </H4>
  <P>这是一个 Chuck Foster的补丁的改写版, 这个补丁可以在任何解析库下工作, 无论多旧, 它使用一个保护字节来避免&quot;置于缓冲中的字节数&quot;这个库bug. 
    它仅仅重分配一次缓存为65536字节, 而不是分配正好需要的大小, 所以它可能比Chuck的补丁内存效率低一些(虽然如此, 像Chuck的这个补丁仅在反馈长度大于PACKETSZ--默认为512字节--情况下重分配缓存) 
    重分配之后, 它强制一个TCP查询, 而不是要求解析库来作查询(尽管在qmail和名字服务器同在一个机器或者同在一个局域网络里面的情况下, 这种查询不算什么负担, 
    这样作还是避免了在qmail和名字服务器之间额外的往返). </P>
<H3><A name=qmail-ldap>5.10.3. <I>qmail-ldap</I></A></H3>
  <P>这个补丁, 由 Andre Oppermann等人编写, 实现了qmail的Lightweight Directory Access Protocol 
    (LDAP)支持. LDAP像一个网络电话簿. 使用 qmail-ldap, 它可以使一个POP服务器支持数以千计的众多用户. 参见<A 
href="http://www.nrg4u.com/">http://www.nrg4u.com/</A>. </P>
<H2><A name=qmtp>5.11. QMTP</A></H2>
  <P>QMTP 是 Quick Mail Transfer Protocol 的缩写, 由Dan Bernstein设计的用来替代SMTP的协议. 这个协议定义在 
    <A 
href="http://cr.yp.to/proto/qmtp.txt">http://cr.yp.to/proto/qmtp.txt</A> . QMTP比SMTP更简单, 
    更快速以及兼容SMTP. qmail包含一个QMTP服务器, qmail-qmtp, 它运行起来非常类似于 qmail-smtp. QMTP通常使用端口209. 
  </P>
  <P>qmail并不包括QMTP的客户端, 不过 serialmail 软件包包括一个客户端. maildirqmtp 命令接收maildir格式邮箱并以QMTP协议传送邮箱内的邮件到指定的QMTP服务器. 
    <I> </I></P>
  <P>QMTP不是一个drop-in方式的SMTP的替代品, 在因特网上的使用也不是很普遍. </P>
  <P>Russ Nelson 为qmail-remote写了一个支持QMTP的补丁. 可以在 这里 <A 
href="http://www.qmail.org/qmail-1.03-qmtpc.patch">http://www.qmail.org/qmail-1.03-qmtpc.patch</A> 
    取得这个补丁. 他也编写了一个tarball安装方式的程序, 可以展开到 /service 目录下进行QMTP服务. 可以在这里<A 
href="http://www.qmail.org/qmtpd-service.tar.gz">http://www.qmail.org/qmtpd-service.tar.gz</A> 
    取得这个tarball包. </P>
<HR>

  <H1><A name=acknowledgments>附录 A. 致谢 </A></H1>
  <P>首先, 感谢Dan Bernstein 编写了这样一个强大而优雅的系统. 经过五年的使用, qmail依然给我深刻的印象. </P>
  <P>我想感谢那些qmail邮件列表的成员. 作为最有帮助的, 最有耐心的, 以及最知识渊博和有趣的撰稿人之一, Russell Nelson 应该被特别提及, 
    他对于qmail 社区的贡献仅次于DJB. </P>
  <P>感谢每一个评论或者对这个文档作出贡献的人, 他们包括: </P>
<UL>
  <LI>Vince Vielhaber 
  <LI>Chris Green 
  <LI>Christopher K. Davis 
  <LI>Scott Schwartz 
  <LI>Fred Lindberg 
  <LI>Russell P. Sutherland 
  <LI>Alex Miller 
  <LI>Tim Hunter 
  <LI>Frank D. Cringle 
  <LI>Mahlon Smith 
  <LI>Rogerio Brito 
  <LI>Tony Hansmann 
  <LI>Matthias Andree 
  <LI>Tillman Hodgson 
  <LI>Stefan Witzel 
  <LI>Scott Gifford 
  <LI>有太多可被提及的其他的人了....too many others to mention...</LI>
</UL>
  <P>特殊感谢Henning Brauer捐赠了lifewithqmail.org 域名, 并维护服务器! </P>
  <P><U>Life with qmail</U> 使用Simple Document Format (SDF) 编写, 一个非常酷的Perl 编写的标记语言产生HTML, 
    纯文本, PostScript, POD以及其他格式. 这个工具使工作变得特别容易, 参见<A 
href="http://search.cpan.org/author/IANC/sdf-2.001/">http://search.cpan.org/author/IANC/sdf-2.001/</A> 
    查找关于这个工具的更多信息. </P>
<HR>

  <H1><A name=related_packages id="related_packages">附录 B. 相关软件包介绍 </A></H1>
<H2><A name=dot-forward>B.1. <I>dot-forward</I></A></H2>
  <P>Sendmail 使用.forward(发音 dot forward)文件来允许用户控制传输他们收到的邮件. qmail使用一种类似的机制: .qmail文件. 
    dot-forward软件包给予qmail使用.forward文件的能力. 使用Sendmail和其他使用.forward控制文件的MTA可以利用dot-forward程序避免使用.forward文件的等效物.qmail文件而不是使用.forward文件, 
    或者简单地对于用户来说, 在使用qmail平台时尽量少的改变用户原来使用Sendmail时看得到的东西., 比如直接使用. forward文件的习惯. 
  </P>
  <P>dot-forward程序是一个小软件包, 很容易安装配置. 源代码可以在<A 
href="ftp://cr.yp.to/software/dot-forward-0.71.tar.gz">ftp://cr.yp.to/software/dot-forward-0.71.tar.gz</A>这里取得. 
  </P>
  <P>dot-forward 由Dan Bernstein编写, 他为这个软件维护了一个web页面<A 
href="http://cr.yp.to/dot-forward.html">http://cr.yp.to/dot-forward.html</A><I> 
    . d</I></P>
<H2><A name=fastforward>B.2. <I>fastforward</I></A></H2>
  <P>fastforward是另一个Sendmail兼容插件. Sendmail使用保存在一个单一文件内的中心别名数据库, 通常是 /etc/aliases. 
    qmail使用/var/qmail/alias下的一系列文件, 一个别名一个文件. 如果你要从Sendmail迁移到qmail, dot-qmail文件还不想转换Sendmail格式的的别名文件, 
    那么fastforward赋予qmail按照原样使用Sendmail别名文件的能力.<I> </I></P>
  <P>源代码可以在 <A 
href="ftp://cr.yp.to/software/fastforward-0.51.tar.gz">ftp://cr.yp.to/software/fastforward-0.51.tar.gz</A> 
    这里取得. </P>
  <P>fastforward 由Dan Bernstein 编写, 他在 <A 
href="http://cr.yp.to/fastforward.html">http://cr.yp.to/fastforward.html</A> 这里维护了一个web页面.<I> 
    f</I></P>
<H2><A name=ucspi-tcp>B.3. <I>ucspi-tcp</I></A></H2>
  <P>qmail的SMTP服务器并不是按照一个独立的后台服务程序运行的, 必须依靠例如 inetd, xinetd 或者 tcpserver 这些助手程序运行. 
    当这些助手程序接受一个到达25端口, SMTP端口, 的TCP连接之后, 将执行一个qmail-smtpd的副本. </P>
  <P>inetd 是标准网络服务器&quot;super-server&quot;. 可以通过配置/etc/inetd.conf 来运行qmail-smtpd, 
    不过推荐的工具是tcpserver, 它是ucspi-tcp软件包的一部分. ucspi-tcp是UNIX Client-Server Program 
    Interface for TCP的缩写, 发音是 ooks-pie tee see pee.<I> </I></P>
  <P>tcpserver 优于 inetd的几条原因: </P>
<UL>
    <LI>tcpserver 允许限制并行访问服务的数量. inetd使用连接率限制机制在&quot;太忙&quot;情况下阻断服务. 
    <LI>tcpserver 可以被配置为拒绝某些主机连接或者认可并标志本地主机, 使qmail-smtpd 可以分别对待. 
    <LI>tcpserver 是唯一的qmail 作者认可的服务器. </LI>
</UL>
  <P>源代码可以在这里<A 
href="ftp://cr.yp.to/ucspi-tcp/ucspi-tcp-0.88.tar.gz">ftp://cr.yp.to/ucspi-tcp/ucspi-tcp-0.88.tar.gz</A>取得. 
  </P>
  <P>Gerrit Pape 为ucspi-tcp作为 man 帮助页分发的文档可以在这里<A 
href="http://smarden.org/pape/djb/">http://smarden.org/pape/djb/</A> 访问到. </P>
  <P>ucspi-tcp由Dan Bernstein编写, 他在这里<A 
href="http://cr.yp.to/ucspi-tcp.html">http://cr.yp.to/ucspi-tcp.htm</A>维护了一个web页.<I> 
    </I></P>
<H2><A name=daemontools>B.4. <I>daemontools</I></A></H2>
  <P>daemontools软件包包含了一系列控制和监视服务的实用工具. 高度推荐而不强制使用, 特别是对于繁忙的系统. 它包括: </P>
<UL>
    <LI>superivse, 监视服务并在服务停止后重新启动之. 
    <LI>svc, 和supervise会话并且允许停止, 暂停, 或者重启动服务器. 
    <LI>multilog, 维护服务的日志, 可以自动回转记录以保持低于配置大小. 
    <LI>seruidgid, 使用普通用户的UID和GID为超级用户运行程序. </LI>
</UL>
  <P>daemontools的源码可以在这里<A 
href="http://cr.yp.to/daemontools/daemontools-0.76.tar.gz">http://cr.yp.to/daemontools/daemontools-0.76.tar.gz</A>取得. 
  </P>
  <P>Gerrit Pape 为daemontools作为 man 帮助页分发的文档可以在这里<A 
href="http://smarden.org/pape/djb/">http://smarden.org/pape/djb/</A>访问到. </P>
  <P>daemontools 由Dan Bernstein编写, 他在这里<A 
href="http://cr.yp.to/daemontools.html">http://cr.yp.to/daemontools.html</A> 维护了一个web页面. 
  </P>
<H2><A name=qmailanalog>B.5. <I>qmailanalog</I></A></H2>
  <P>qmailanalog处理qmail的日志文件并且生成一系列的报告. 报告指示出系统正在工作的类型和工作量. 如果你需要有多少邮件被发送和接收的统计, 
    以及他们有多大, 他们被处理的有多快, qmailanalog都能显示出来. </P>
  <P>作为一个意外收获, matchup 程序合并qmail 的每个邮件投递的多个日志行为一行 -- 有点类似于Sendmail的日志. </P>
  <P>qmailanalog的源代码可以在这里<A 
href="http://cr.yp.to/software/qmailanalog-0.70.tar.gz">http://cr.yp.to/software/qmailanalog-0.70.tar.gz</A>取得. 
  </P>
  <P>qmailanalog 由Dan Bernstein编写, 他在这里<A 
href="http://cr.yp.to/qmailanalog.html">http://cr.yp.to/qmailanalog.html</A>维护了一个web页面.<I> 
    </I></P>
<P>
<HR align=left width="80%">
  <STRONG>注意: </STRONG>qmailanalog 依赖于由accustamp 使用的小数秒格式的日志条目时间戳. 为了使用它和multilog生成的TAI64N格式的日志, 
  你必须将他们转换成旧格式. 一个完成这个转换工作的程序可以在这里<A 
href="http://www.qmail.org/tai64nfrac">http://www.qmail.org/tai64nfrac</A>取得.<STRONG> 
  </STRONG>
<HR align=left width="80%">

<P></P>
<H2><A name=rblsmtpd>B.6. <I>rblsmtpd</I></A></H2>
  <P>如果你从未被垃圾邮件骚扰, 可以说你太幸运了. 绝大多数的电子邮件用户都太熟悉Unsolicited Bulk E-mail (UBE)了, UBE也被称为&quot;spam&quot;. 
    绝大多数垃圾邮件都是色情站点, 邮件锁链和其他诡计的广告. 回到过去的的旧时光, 直到1998年左右, 绝大多数因特网上的MTA都是开放转信的, 也就是说, 
    他们将会接收任何人给人和人的邮件, 甚至没有发信人也没有本地收信人的邮件. 垃圾邮件发送者利用这些开放转信服务, 尽可能找到他们能找的服务器传送他们的垃圾邮件. 
    这样就隐藏了他们的踪迹, 栽赃给那些&quot;无罪的&quot;开放转信站点, (通过浪费开放转信站点的资源) 为垃圾邮件制造者节省了大量的CPU和带宽. 
  </P>
  <P>从那个时期开始, 这样的开放转信的站点被认为是<strong>非常</strong>糟糕的, 几个反垃圾邮件义务组织创造了一个机制来识别开放转信和其他垃圾邮件的普通来源, 
    这样他们就能够避免来自垃圾邮件商的SMTP连接. </P>
  <P><I>rblsmtpd</I> <I>是一个 RBL SMTP后台服务程序. 它位于tcpserver和qmail-smtpd之间, 并且拒绝系统认定的那些列表里面系统的连接. 
    </I></P>
  <P>举一个例子, 在tcpserver下运行rblsmtpd, 试试下面这样的写法: </P>
<PRE>    #!/bin/sh
    QMAILDUID=`id -u qmaild`
    NOFILESGID=`id -g qmaild`
    MAXSMTPD=`cat /var/qmail/control/concurrencyincoming`
    exec /usr/local/bin/softlimit -m 2000000 \
    /usr/local/bin/tcpserver -v -R -H -l 0 -x /etc/tcp.smtp.cdb -c "$MAXSMTPD" \
        -u "$QMAILDUID" -g "$NOFILESGID" 0 smtp /usr/local/bin/rblsmtpd\
        -r relays.ordb.org /var/qmail/bin/qmail-smtpd 2&gt;&amp;1
</PRE>
  <P>rblsmtpd 以前是作为一个分立的软件包, 现在被捆绑在<A 
href="#ucspi-tcp">ucspi-tcp</A> 里面. </P>
  <P>rblsmtpd 由Dan Bernstein 编写, 他在这里<A 
href="http://cr.yp.to/ucspi-tcp/rblsmtpd.html">http://cr.yp.to/ucspi-tcp/rblsmtpd.html</A> 
    维护了一个web页面.<I> </I></P>
<H2><A name=serialmail>B.7. <I>serialmail</I></A></H2>
  <P>qmail 是为全部时间高速连接设计的. serialmail 一个工具集让qmail更好的适用于断断续续的, 低速的连接. 在这样的系统上使用serialmail, 
    qmail被配置为传送所有远程邮件到一个单独的maildir文件夹. 一旦网络连通, serialmail的maildirsmtp 命令将用来上传这个maildir到ISP的邮件网络中心. 
    如果ISP支持QMTP(参看 <a href="#advanced-topics">高级话题</a> 下的 <a href="#qmtp">QMTP</a>), 
    maildirqmtp也可以被使用. </P>
  <P>serialmail 可以被用于ISP方面, 用来实现 AutoTURN, 这是一个 由客户端发起的SMTP 连接, 导致服务器开始反向连接到客户端 
    , 然后发送服务器端的邮件队列给客户端的过程. 这个和ETRN SMTP机制很相似.</P>
  <P>serialmail的源代码可以在这里<A 
href="http://cr.yp.to/software/serialmail-0.75.tar.gz">http://cr.yp.to/software/serialmail-0.75.tar.gz</A> 
    得到. </P>
  <P>serialmail 由Dan Bernstein编写, 他在这里<A 
href="http://cr.yp.to/serialmail.html">http://cr.yp.to/serialmail.html</A>维护了一个web页面. 
  </P>
<H2><A name=mess822>B.8. <I>mess822</I></A></H2>
  <P>mess822 是一个处理 RFC822兼容邮件的库和一系列应用程序. 这些程序包括: </P>
<UL>
    <LI>ofmipd: 一个,从客户端接收邮件并基于数据库记录改写From邮件头部分的后台服务程序. 
    <LI>new-inject: 一个qmail-inject的替代程序, 支持用户控制的主机名改写. 
<LI>iftocc: 一个.qmail应用程序, 用来检查是否邮件被发送到指定地址. iftocc: a .qmail 
    utility for checking whether a message was sent to a specific address. 
    <LI>822header, 822field, 822date, 和 822received: 
      从邮件中摘录信息.  
    <LI>822print: 优美的打印邮件. </LI>
</UL>
  <P>mess822的源代码可以在这里 <A 
href="http://cr.yp.to/software/mess822-0.58.tar.gz">http://cr.yp.to/software/mess822-0.58.tar.gz</A>取得. 
  </P>
  <P>mess822 由Dan Bernstein编写, 他在这里<A href="http://cr.yp.to/mess822.html">http://cr.yp.to/mess822.html</A>维护了一个web页面. 
  </P>
<H2><A name=ezmlm>B.9. <I>ezmlm</I></A></H2>
  <P>ezmlm 是一个为qmail设计的高效, 易用的邮件列表管理器(MLM). 如果你熟悉 LISTSERV 或者 Majordomo, 你会知道邮件列表管理器能作什么. 
    更多在qmail下的关于邮件列表的信息可以在<a href="#advanced-topics">高级话题</a> 下面的 <a href="#mailing-list-managers">邮件列表管理器</a> 
    找到. </P>
  <P>ezmlm的源代码可以在<A 
href="http://cr.yp.to/software/ezmlm-0.53.tar.gz">http://cr.yp.to/software/ezmlm-0.53.tar.gz</A>这里取得. 
  </P>
  <P>ezmlm 由 Dan Bernstein编写, 他在这里<A href="http://cr.yp.to/ezmlm.html">http://cr.yp.to/ezmlm.html</A>维护着一个web页面. 
  </P>
  <P>Fred Lindberg 和 Fred B. Ringel 为ezmlm开发了一个扩展, 叫做ezmlm-idx, 后者增加了大量的有用特色, 
    我特别推荐使用它. 可以在 <A 
href="http://www.ezmlm.org/">http://www.ezmlm.org/</A> 这里访问 ezmlm-idx. </P>
<H2><A name=safecat>B.10. <I>safecat</I></A></H2>
  <P>safecat 可靠的将文件写入maildir 邮箱中. 在使用procmail 处方时候它特别用来帮助归档邮件.举一个例子, 下面的处方将所有Maildir中的邮件存档. 
  </P>
<PRE>:0w
|safecat Maildir/tmp Maildir/new
</PRE>
  <P>safecat 由 Len Budney 编写, 他在这里<a 
href="http://www.pobox.com/~lbudney/linux/software/safecat.html">http://www.pobox.com/~lbudney/linux/software/safecat.html</a>为safecat 
    维护了一个web页面. </P>
<H2><A name=djbdns>B.11. <I>djbdns</I></A></H2>
  <P>djbdns 是qmail作者编写的DNS服务器. 它包括 tinydns, 一个DNS内容服务器, 和 dnscache, 一个 DNS 缓冲服务器.<I> 
    </I></P>
  <P>djbdns的正式页面在 <A 
href="http://cr.yp.to/djbdns.html">http://cr.yp.to/djbdns.html</A>. </P>
<H2><A name=maildrop>B.12. <I>maildrop</I></A></H2>
  <P>maildrop是一个和procmail类似的邮件过滤器. <I>m</I></P>
  <P>maildrop 由 Sam Varshavchik 编写, 他在这里<A 
href="http://www.flounder.net/~mrsam/maildrop">http://www.flounder.net/~mrsam/maildrop</A>为maildrop维护了一个web页面.<I> 
    </I></P>
<H2><A name=syncdir>B.13. <I>syncdir</I></A></H2>
  <P>syncdir 是一个小型使 link() 系统调用同步的库. 在一个不能同步执行 link() 的文件系统上运行qmail队列时, syncdir是必要的. 
    例如 Linus的 ext2fs, Reiserfs, SGI的 XFS以及BSD的使用softupdates的FFS系统. </P>
  <P>syncdir 由 Bruce Guenter编写, 可以在这个web页面<A 
href="http://untroubled.org/syncdir/">http://untroubled.org/syncdir/</A>访问. 安装指导在这个位置<A 
href="http://www.ornl.gov/its/archives/mailing-lists/qmail/2001/12/msg00949.html">http://www.ornl.gov/its/archives/mailing-lists/qmail/2001/12/msg00949.html</A>. 
  </P>
<HR>
  <H1><A name=how-mail-works>附录 C. 因特网邮件工作原理 </A></H1>
  <H2><A name=from-a-to-b>C.1. 邮件如何从A点到达B点 </A></H2>
  <P>当一个主机上的用户想要发送一个邮件给另一个主机上的用户时, 许多事情发生了, 这个场景后面的东西很多是不必要知道的那么确切的. </P>
  <P>假设一个用户 Alice, alice@alpha.example.com 想要发送一个邮件给 Bob, bob@beta.example.com, 
    下面是发送接收过程: </P>
  <P>1. Alice 用她的邮件用户代理(MUA)编写邮件, 比如使用 mutt 或者 pine. 她在 To 这一栏指定接收者, Subject 这一栏填写邮件主题, 
    加上邮件本身的文本部分. 整个邮件看起来是下面这样的: </P>
<PRE>    To: bob@beta
    Subject: lunch

    How about pizza?
</PRE>
  <P>2. 当她觉得这封邮件已经满意之后, 她指派 MUA 发送邮件. </P>
  <P>3. 这时候, MUA 会加上附加的邮件头部分, 比如日期 Date 和邮件ID(Message-Id) 并且修改Alice输入的值(例如, 将 bob@beta 
    替换为"Bob &lt;bob@beta.example.com&gt;") 下一步, MUA 将邮件注入邮件系统. 有两种方式进行注入: 
    MUA 运行一个由邮件系统提供的为注入邮件为目的的程序; 或者使用SMTP协议和本地或者远程邮件服务器建立连接, 举个例子, 我们假定 MUA 使用本地注入程序将邮件传送给 
    MTA, 对于不同的MTA, 注入细节都是不同的, 不过对于UNIX系统, 使用sendmail 程序注入已经成了事实上的标准. 使用这种方式, MUA 
    可以将邮件头和邮件主体放置在一个文件内, 由空行分隔, 然后传递这个文件到 sendmail 程序. </P>
  <P>4. 如果注入成功--邮件句法正确, 并且 sendmail 调用适当--那么现在邮件已经在 MTA 的职责内了. 不同的 MTA 细节是完全不同的, 
    通常MTA首先检查邮件头决定邮件将发往何处. 然后建立一个到主机beta的SMTP连接, 转发邮件给 beta 系统上的MTA. SMTP对话要求邮件被分成两部分发送: 
    信封, 这个部分确定了接收者的地址(bob@beta.example.com)和返回地址(alice@alpha.example.com), 以及邮件本身, 
    包括邮件头和邮件主体. </P>
  <P>5. 如果beta主机的MTA拒绝这个邮件, 可能原因是在beta系统上没有这个bob用户, 在alpha 上的MTA发送一个反弹邮件给返回地址, 也就是 
    alice@alpha, 通知她邮件发送出现了问题. </P>
  <P>6. 如果 beta主机上的 MTA接收了邮件, 它查看接收者地址, 决定是发送给本地local 还是远程 remote系统的邮件. 这个例子里面, 
    接收者是本地用户, 然后MTA或者传送邮件给 mail delivery agent (MDA), 比如 /bin/mail或者传送给 procmail. 
  </P>
  <P>7. 如果传输失败了, 可能是Bob的邮箱超过了使用限额, beta 主机上的 MTA 将发送一个反弹信息给信封上的返回地址, 即 alice@alpha. 
  </P>
  <P>8. 如果传输成功, 邮件将在Bob的邮箱中等待, 直到他使用MUA来阅读和显示邮件. </P>
<H2><A name=more-information>C.2. 其他资料 C.2. More information</A></H2>
  <P>关于因特网邮件工作方式的更多信息, 请查看下面的信息: </P>
<UL>
    <LI>Internet mail, 由qmail作者撰写 <A 
  href="http://cr.yp.to/im.html">http://cr.yp.to/im.html</A> . 
    <LI>SMTP, 由qmail作者撰写 <A 
  href="http://cr.yp.to/smtp.html">http://cr.yp.to/smtp.html</A> 
    <LI>Internet mail message header format, 由qmail作者撰写 <A 
  href="http://cr.yp.to/immhf.html">http://cr.yp.to/immhf.html</A> </LI>
</UL>
  <H3><A name=rfcs>C.2.1. 因特网的RFC文档 </A></H3>
  <P>Internet Requests for Comment, 缩写为Internet RFC是因特网得正式文档. 大部分Internet RFC 文档已经度过了评论期, 
    进入稳定状态, 他们定义了包括诸如 TCP, FTP, Telnet和各种各样得邮件标准和协议. </P>
<UL>
  <LI>RFC 821, Simple Mail Transfer Protocol (obsoleted by RFC 2821) <A 
  href="http://www.ietf.org/rfc/rfc0821.txt">http://www.ietf.org/rfc/rfc0821.txt</A> 

  <LI>RFC 822, Standard for the Format of ARPA Internet Text Messages (obsoleted 
  by RFC 2822) <A 
  href="http://www.ietf.org/rfc/rfc0822.txt">http://www.ietf.org/rfc/rfc0822.txt</A> 

  <LI>RFC 931, Authentication Server. <A 
  href="http://www.ietf.org/rfc/rfc0931.txt">http://www.ietf.org/rfc/rfc0931.txt</A> 

  <LI>RFC 974, Mail Routing and the Domain System. <A 
  href="http://www.ietf.org/rfc/rfc0974.txt">http://www.ietf.org/rfc/rfc0974.txt</A> 

  <LI>RFC 1123, Requirements for Internet Hosts -- Application and Support. <A 
  href="http://www.ietf.org/rfc/rfc1123.txt">http://www.ietf.org/rfc/rfc1123.txt</A> 

  <LI>RFC 1413, Identification Protocol. <A 
  href="http://www.ietf.org/rfc/rfc1413.txt">http://www.ietf.org/rfc/rfc1413.txt</A> 

  <LI>RFC 1423, Privacy Enhancement for Internet Electronic Mail: Part III: 
  Algorithms, Modes, and Identifiers. <A 
  href="http://www.ietf.org/rfc/rfc1423.txt">http://www.ietf.org/rfc/rfc1423.txt</A> 

  <LI>RFC 1651, SMTP Service Extensions. <A 
  href="http://www.ietf.org/rfc/rfc1651.txt">http://www.ietf.org/rfc/rfc1651.txt</A> 

  <LI>RFC 1652, SMTP Service Extension for 8bit-MIMEtransport. <A 
  href="http://www.ietf.org/rfc/rfc1652.txt">http://www.ietf.org/rfc/rfc1652.txt</A> 

  <LI>RFC 1806, Content disposition. header. <A 
  href="http://www.ietf.org/rfc/rfc1806.txt">http://www.ietf.org/rfc/rfc1806.txt</A> 

  <LI>RFC 1854, SMTP Service Extension for Command Pipelining. <A 
  href="http://www.ietf.org/rfc/rfc1854.txt">http://www.ietf.org/rfc/rfc1854.txt</A> 

  <LI>RFC 1891, SMTP Service Extension for Delivery Status Notifications. <A 
  href="http://www.ietf.org/rfc/rfc1891.txt">http://www.ietf.org/rfc/rfc1891.txt</A> 

  <LI>RFC 1892, The Multipart/Report Content Type for the Reporting of Mail 
  System Administrative Messages. <A 
  href="http://www.ietf.org/rfc/rfc1892.txt">http://www.ietf.org/rfc/rfc1892.txt</A> 

  <LI>RFC 1893, Enhanced mail system status codes. <A 
  href="http://www.ietf.org/rfc/rfc1893.txt">http://www.ietf.org/rfc/rfc1893.txt</A> 

  <LI>RFC 1894, An Extensible Message Format for Delivery Status Notifications. 
  <A 
  href="http://www.ietf.org/rfc/rfc1894.txt">http://www.ietf.org/rfc/rfc1894.txt</A> 

  <LI>RFC 1939, Post Office Protocol - Version 3. <A 
  href="http://www.ietf.org/rfc/rfc1939.txt">http://www.ietf.org/rfc/rfc1939.txt</A> 

  <LI>RFC 1985, SMTP Service Extension for Remote Message Queue Starting (ETRN). 
  <A 
  href="http://www.ietf.org/rfc/rfc1985.txt">http://www.ietf.org/rfc/rfc1985.txt</A> 

  <LI>RFC 1991, PGP Message Exchange Formats. <A 
  href="http://www.ietf.org/rfc/rfc1991.txt">http://www.ietf.org/rfc/rfc1991.txt</A> 

  <LI>RFC 2015, MIME Security with Pretty Good Privacy. (PGP). <A 
  href="http://www.ietf.org/rfc/rfc2015.txt">http://www.ietf.org/rfc/rfc2015.txt</A> 

  <LI>RFC 2045, MIME Internet message bodies. <A 
  href="http://www.ietf.org/rfc/rfc2045.txt">http://www.ietf.org/rfc/rfc2045.txt</A> 

  <LI>RFC 2046, MIME Media Types. <A 
  href="http://www.ietf.org/rfc/rfc2046.txt">http://www.ietf.org/rfc/rfc2046.txt</A> 

  <LI>RFC 2047, MIME Headers. <A 
  href="http://www.ietf.org/rfc/rfc2047.txt">http://www.ietf.org/rfc/rfc2047.txt</A> 

  <LI>RFC 2048, MIME Registration Procedures. <A 
  href="http://www.ietf.org/rfc/rfc2048.txt">http://www.ietf.org/rfc/rfc2048.txt</A> 

  <LI>RFC 2049, MIME Conformance Criteria. <A 
  href="http://www.ietf.org/rfc/rfc2049.txt">http://www.ietf.org/rfc/rfc2049.txt</A> 

  <LI>RFC 2142, Mailbox names for common services. <A 
  href="http://www.ietf.org/rfc/rfc2142.txt">http://www.ietf.org/rfc/rfc2142.txt</A> 

  <LI>RFC 2183, Content Disposition header. <A 
  href="http://www.ietf.org/rfc/rfc2183.txt">http://www.ietf.org/rfc/rfc2183.txt</A> 

  <LI>RFC 2821, Simple Mail Transfer Protocol. <A 
  href="http://www.ietf.org/rfc/rfc2821.txt">http://www.ietf.org/rfc/rfc2821.txt</A> 

  <LI>RFC 2822, Internet Message Format <A 
  href="http://www.ietf.org/rfc/rfc2822.txt">http://www.ietf.org/rfc/rfc2822.txt</A></LI></UL>
  <P>一个综合性的邮件相关RFC列表可以在Internet Mail Consortium的web网站上找到 <A 
href="http://www.imc.org/mail-standards.html">http://www.imc.org/mail-standards.html</A>. 
  </P>
<HR>

  <H1><A name=architecture-apdx>附录 D. 体系结构 </A></H1>
  <H2><A name=modular>D.1. 模块化系统结构 </A></H2>
  <P>因特网MTA可以完成多种任务. 早期如 Sendmail和 smail的设计是整体式的, 换句话说就是他们是一个大而复杂的程序, 其中一部分是SMTP服务器, 
    另一部分是SMTP客户端, 另外的是本地邮件注入, 还有管理邮件队列的部分,等等. </P>
  <P>qmail是模块化的, 每个功能都是由单独的程序执行的, 结果程序更小, 更简单, 而且更不容易出现功能和安全方面的问题. 为了进一步增强qmail的安全性, 
    qmail模块以不同的权限模式运行, 模块之间互不&quot;信任&quot;, 他们不是假定其他模块总是按照他们设计的那样去运行的. </P>
  <P>这些是qmail的核心模块:</P>
<TABLE class=columns border=1>
  <TBODY>
  <TR class=heading>
        <TD><STRONG>模块 </STRONG></TD>
        <TD><STRONG>功能 </STRONG></TD>
    </TR>
  <TR>
    <TD>qmail-smtpd </TD>
        <TD>接收/拒收通过SMTP传递的邮件</TD>
    </TR>
  <TR>
    <TD>qmail-inject </TD>
        <TD>本地邮件注入 </TD>
    </TR>
  <TR>
    <TD>qmail-rspawn/qmail-remote </TD>
        <TD>控制远程传输 </TD>
    </TR>
  <TR>
    <TD>qmail-lspawn/qmail-local </TD>
        <TD>控制本地传输 </TD>
    </TR>
  <TR>
    <TD>qmail-send </TD>
        <TD>处理队列 </TD>
    </TR>
  <TR>
    <TD>qmail-clean </TD>
        <TD>清除队列 </TD>
    </TR></TBODY></TABLE>
  <P>模块化也有一些不利因素, 不像整体式的MTA, 模块之间的相互作用定义良好, 而且模块之间只是交换最小的必要信息. 这通常是大好事, 可是有时这种方式使处理某些事情变的困难起来. 
    举个例子, 为了debug目的, 运行sendmail 并使用&quot;-v&quot;选项, 使 Sendmail 打印它的活动跟踪消息到标准输出, 
    由于所有的包括邮件注入, 队列控制, 别名处理, .forward文件处理, 以及远程SMTP转发邮件等等都是由一个 sendmail 二进制程序控制, 
    那么可以很容易的跟踪整个邮件传送过程直到邮件被送抵目的地. 这样的等价物在qmail里面是不存在的, 如果在qmail上执行这样的&quot;debug&quot;过程, 
    需要实质性的改变源码以及在模块到模块之间的过程调试, 这增加了的很大复杂性. </P>
  <H2><A name=file-structure>D.2. 文件结构 </A></H2>
  <P>/var/qmail 是qmail的文件结构的根. 在qmail 编译安装的时候可以选择改变这个目录的位置, 不过最好还是不作改动的安装到默认位置, 
    这样其他的管理员就知道到哪里能找到需要的东西. 如果你真的想重新定位部分或者全部的qmail 目录树, 最好的办法是使用符号连接方式. 详细信息请参看<a href="interactions">创建目录</a> 
    小节中的细目. </P>
  <P>qmail 根目录下面的一级子目录: </P>
<TABLE class=columns border=1>
  <TBODY>
  <TR class=heading>
        <TD><STRONG>目录</STRONG></TD>
        <TD><STRONG>内容</STRONG></TD>
    </TR>
  <TR>
    <TD>alias </TD>
        <TD>系统级别名定义的.qmail文件</TD>
    </TR>
  <TR>
    <TD>bin </TD>
        <TD>二进制程序和可执行脚本 </TD>
    </TR>
  <TR>
    <TD>boot </TD>
        <TD>启动脚本 </TD>
    </TR>
  <TR>
    <TD>control </TD>
        <TD>配置文件 </TD>
    </TR>
  <TR>
    <TD>doc </TD>
        <TD>文档(不包括man 手册页) </TD>
    </TR>
  <TR>
    <TD>man </TD>
        <TD>man 手册页 </TD>
    </TR>
  <TR>
    <TD>queue </TD>
        <TD>未送出的邮件 </TD>
    </TR>
  <TR>
    <TD>users </TD>
        <TD>qmail-users 的数据库文件 </TD>
    </TR></TBODY></TABLE>
  <H2><A name=queue-structure>D.3. 队列结构 </A></H2>
  <P>在qmail的安装目录下的 INTERNALS文件更充分的讨论了有关的细节信息. 下面是一些更宽泛的队列结构的概述. </P>
<TABLE class=columns border=1>
  <TBODY>
  <TR class=heading>
        <TD><STRONG>子目录</STRONG></TD>
        <TD><STRONG>内容 </STRONG></TD>
    </TR>
  <TR>
    <TD>bounce </TD>
        <TD>永久传送错误 </TD>
    </TR>
  <TR>
    <TD>info* </TD>
        <TD>信封发送者地址 </TD>
    </TR>
  <TR>
    <TD>intd </TD>
        <TD>由qmail-queue构建的信封 </TD>
    </TR>
  <TR>
    <TD>local* </TD>
        <TD>本地信封接收者地址</TD>
    </TR>
  <TR>
    <TD>lock </TD>
        <TD>文件锁文件</TD>
    </TR>
  <TR>
    <TD>mess* </TD>
        <TD>邮件文件 </TD>
    </TR>
  <TR>
    <TD>pid </TD>
        <TD>由qmail-queue使用用来获得 i 节点编号 </TD>
    </TR>
  <TR>
    <TD>remote* </TD>
        <TD>远程信封接收者地址</TD>
    </TR>
  <TR>
    <TD>todo </TD>
        <TD>完成的信封 </TD>
    </TR></TBODY></TABLE>
<P>
<HR align=left width="80%">
  <STRONG>注意:</STRONG> 由&quot;*&quot;标志的目录包含了一系列分开的由&quot;0&quot;, &quot;1&quot;,..., 
  (最大数字直到conf-split 减去 1)这些数字命名的子目录. 这里conf-split 是由源代码目录下的conf-split 文件设定的一个参数, 
  在编译源码时确定, 默认是23. 分离出多个子目录是为了在繁忙的服务器上降低单个目录里面的文件数量. conf-split 必须是个质数.<STRONG> 
  </STRONG>
<HR align=left width="80%">

<P></P>
  <P>在mess组目录下的文件由它们的 i 节点编号命名. 这就意味着你不能使用标准的UNIX工具, 比如mv, dump/restore还有 tar来手动地移动这些文件. 
    这里有两个用户提供的实用工具, 可以使用它们来正确地重命名队列文件. 可以在这里<A 
href="http://www.qmail.org/">http://www.qmail.org/</A> 找到这些工具. </P>
<P>
<HR align=left width="80%">
  <STRONG>注意: 当qmail正在运行地时候, 修改队列文件是不安全的.</STRONG> 如果你想更改队列, 首先停止 qmail, 然后仔细的处理队列, 
  然后重启qmail. <STRONG> </STRONG> 
  <HR align=left width="80%">

<P></P>
  <H2><A name=pictures>D.4. 图片 </A></H2>
  <P>在 /var/qmail/doc 下面有一系列的以 PIC 名字开头的文件. 这些是qmail处理不同情况的文本&quot;图片&quot;. 它们显示了qmail 
    在各个模块之间处理的控制流, 在处理问题和建立复杂系统配置的时候这些图片将大有裨益. </P>
<TABLE class=columns border=1>
  <TBODY>
  <TR class=heading>
        <TD><STRONG>文件名</STRONG></TD>
        <TD><STRONG>处理场景 </STRONG></TD>
    </TR>
  <TR>
    <TD>PIC.local2alias </TD>
        <TD>本地注入邮件传递给本地别名</TD>
    </TR>
  <TR>
    <TD>PIC.local2ext </TD>
        <TD>本地注入邮件传递给扩展地址</TD>
    </TR>
  <TR>
    <TD>PIC.local2local </TD>
        <TD>本地注入邮件传递给本地用户</TD>
    </TR>
  <TR>
    <TD>PIC.local2rem </TD>
        <TD>本地注入邮件传递给远程地址 </TD>
    </TR>
  <TR>
    <TD>PIC.local2virt </TD>
        <TD>本地注入邮件传递给本地虚拟域上的一个地址 </TD>
    </TR>
  <TR>
    <TD>PIC.nullclient </TD>
        <TD>邮件注入到空用户 </TD>
    </TR>
  <TR>
    <TD>PIC.relaybad </TD>
        <TD>使用本地主机转信失败 </TD>
    </TR>
  <TR>
    <TD>PIC.relaygood </TD>
        <TD>使用本地主机转信成功 </TD>
    </TR>
  <TR>
    <TD>PIC.rem2local </TD>
        <TD>通过SMTP为本地用户接收邮件 </TD>
    </TR></TBODY></TABLE>
  <P>这些图片也可以在线观看, 地址如下: </P>
<UL>
  <LI><A 
  href="http://www.qmail.org/man/index.html">http://www.qmail.org/man/index.html</A></LI></UL>
  <P>如果你想看qmail的&quot;真实&quot;图片, 那么请查看Andre Opperman 的 "big qmail picture", 地址在<A 
href="http://www.nrg4u.com/">http://www.nrg4u.com/</A> . </P>
<HR>

  <H1><A name=IAQ>附录 E. 一些不常见的问题 Infrequently Asked Questions</A></H1>
  <P>一些没有资格称为常见问题的问题, 可是还是很重要也不容易回答的. </P>
  <H2><A name=retry-schedule>E.1. qmail如何处理延期发送的邮件? </A></H2>
  <P>每个邮件都有自己的重试时间表, 越长时间不能发送的邮件, 得到qmail重发的机会就越少. 重试时间表是不可配置的. 下面的表格显示了一个发往远程接收者的邮件, 
    从每次都无法发送到这封邮件被反弹的整个重试时间表. 本地传送邮件使用一个相似的不过频率更高的时间表. </P>
<TABLE class=columns border=1>
  <TBODY>
  <TR class=heading>
        <TD align=middle><STRONG>重试次数 </STRONG></TD>
        <TD align=right><STRONG>秒 </STRONG></TD>
        <TD align=right><STRONG>天-小时-分钟-秒</STRONG></TD>
    </TR>
  <TR>
    <TD align=middle>1 </TD>
    <TD align=right>0 </TD>
    <TD align=right>0-00:00:00 </TD></TR>
  <TR>
    <TD align=middle>2 </TD>
    <TD align=right>400 </TD>
    <TD align=right>0-00:06:40 </TD></TR>
  <TR>
    <TD align=middle>3 </TD>
    <TD align=right>1600 </TD>
    <TD align=right>0-00:26:40 </TD></TR>
  <TR>
    <TD align=middle>4 </TD>
    <TD align=right>3600 </TD>
    <TD align=right>0-01:00:00 </TD></TR>
  <TR>
    <TD align=middle>5 </TD>
    <TD align=right>6400 </TD>
    <TD align=right>0-01:46:40 </TD></TR>
  <TR>
    <TD align=middle>6 </TD>
    <TD align=right>10000 </TD>
    <TD align=right>0-02:46:40 </TD></TR>
  <TR>
    <TD align=middle>7 </TD>
    <TD align=right>14400 </TD>
    <TD align=right>0-04:00:00 </TD></TR>
  <TR>
    <TD align=middle>8 </TD>
    <TD align=right>19600 </TD>
    <TD align=right>0-05:26:40 </TD></TR>
  <TR>
    <TD align=middle>9 </TD>
    <TD align=right>25600 </TD>
    <TD align=right>0-07:06:40 </TD></TR>
  <TR>
    <TD align=middle>10 </TD>
    <TD align=right>32400 </TD>
    <TD align=right>0-09:00:00 </TD></TR>
  <TR>
    <TD align=middle>11 </TD>
    <TD align=right>40000 </TD>
    <TD align=right>0-11:06:40 </TD></TR>
  <TR>
    <TD align=middle>12 </TD>
    <TD align=right>48400 </TD>
    <TD align=right>0-13:26:40 </TD></TR>
  <TR>
    <TD align=middle>13 </TD>
    <TD align=right>57600 </TD>
    <TD align=right>0-16:00:00 </TD></TR>
  <TR>
    <TD align=middle>14 </TD>
    <TD align=right>67600 </TD>
    <TD align=right>0-18:46:40 </TD></TR>
  <TR>
    <TD align=middle>15 </TD>
    <TD align=right>78400 </TD>
    <TD align=right>0-21:46:40 </TD></TR>
  <TR>
    <TD align=middle>16 </TD>
    <TD align=right>90000 </TD>
    <TD align=right>1-01:00:00 </TD></TR>
  <TR>
    <TD align=middle>17 </TD>
    <TD align=right>102400 </TD>
    <TD align=right>1-04:26:40 </TD></TR>
  <TR>
    <TD align=middle>18 </TD>
    <TD align=right>115600 </TD>
    <TD align=right>1-08:06:40 </TD></TR>
  <TR>
    <TD align=middle>19 </TD>
    <TD align=right>129600 </TD>
    <TD align=right>1-12:00:00 </TD></TR>
  <TR>
    <TD align=middle>20 </TD>
    <TD align=right>144400 </TD>
    <TD align=right>1-16:06:40 </TD></TR>
  <TR>
    <TD align=middle>21 </TD>
    <TD align=right>160000 </TD>
    <TD align=right>1-20:26:40 </TD></TR>
  <TR>
    <TD align=middle>22 </TD>
    <TD align=right>176400 </TD>
    <TD align=right>2-01:00:00 </TD></TR>
  <TR>
    <TD align=middle>23 </TD>
    <TD align=right>193600 </TD>
    <TD align=right>2-05:46:40 </TD></TR>
  <TR>
    <TD align=middle>24 </TD>
    <TD align=right>211600 </TD>
    <TD align=right>2-10:46:40 </TD></TR>
  <TR>
    <TD align=middle>25 </TD>
    <TD align=right>230400 </TD>
    <TD align=right>2-16:00:00 </TD></TR>
  <TR>
    <TD align=middle>26 </TD>
    <TD align=right>250000 </TD>
    <TD align=right>2-21:26:40 </TD></TR>
  <TR>
    <TD align=middle>27 </TD>
    <TD align=right>270400 </TD>
    <TD align=right>3-03:06:40 </TD></TR>
  <TR>
    <TD align=middle>28 </TD>
    <TD align=right>291600 </TD>
    <TD align=right>3-09:00:00 </TD></TR>
  <TR>
    <TD align=middle>29 </TD>
    <TD align=right>313600 </TD>
    <TD align=right>3-15:06:40 </TD></TR>
  <TR>
    <TD align=middle>30 </TD>
    <TD align=right>336400 </TD>
    <TD align=right>3-21:26:40 </TD></TR>
  <TR>
    <TD align=middle>31 </TD>
    <TD align=right>360000 </TD>
    <TD align=right>4-04:00:00 </TD></TR>
  <TR>
    <TD align=middle>32 </TD>
    <TD align=right>384400 </TD>
    <TD align=right>4-10:46:40 </TD></TR>
  <TR>
    <TD align=middle>33 </TD>
    <TD align=right>409600 </TD>
    <TD align=right>4-17:46:40 </TD></TR>
  <TR>
    <TD align=middle>34 </TD>
    <TD align=right>435600 </TD>
    <TD align=right>5-01:00:00 </TD></TR>
  <TR>
    <TD align=middle>35 </TD>
    <TD align=right>462400 </TD>
    <TD align=right>5-08:26:40 </TD></TR>
  <TR>
    <TD align=middle>36 </TD>
    <TD align=right>490000 </TD>
    <TD align=right>5-16:06:40 </TD></TR>
  <TR>
    <TD align=middle>37 </TD>
    <TD align=right>518400 </TD>
    <TD align=right>6-00:00:00 </TD></TR>
  <TR>
    <TD align=middle>38 </TD>
    <TD align=right>547600 </TD>
    <TD align=right>6-08:06:40 </TD></TR>
  <TR>
    <TD align=middle>39 </TD>
    <TD align=right>577600 </TD>
    <TD align=right>6-16:26:40 </TD></TR>
  <TR>
    <TD align=middle>40 </TD>
    <TD align=right>608400 </TD>
    <TD align=right>7-01:00:00 </TD></TR></TBODY></TABLE>
  <H2><A name=dns-problem>E.2. 为什么我无法给一个有很多MX记录的大站点发送邮件? </A></H2>
  <P>如果你得到下面的错误提示: </P>
<PRE>deferral: CNAME_lookup_failed_temporarily._(#4.4.3)/
</PRE>
  <P>出问题的原因是qmail不能处理名字服务器返回的大尺寸查询反馈. 安装 <A 
href="#djbdns">djbdns</A> 来解决这个问题. 参考高级话题下面的<a href="#dns-patches"> 补丁</a> 小节. 
  </P>
  <P>不过也有一些人使用这样的系统但是却没有遇到这样的问题. 本质上说, 这取决于对你本地名字服务器查询的定时和排序, 名字服务器对于&quot;aol.com&quot;的ANY查询返回的可能是大于512 
    字节 的 UDP 数据包, 或者可能不是. </P>
  <P>&quot;可能不是&quot; 这种情况可能是碰巧查询的A记录和MX记录超时, 而NS记录没有超时. 由于 .COM的服务器设置的TTL记录生命期为2天, 
    而AOL的TTL只有1个小时, 这种超时现象会经常在较少的某些比较忙的名字服务器上发生. 比较忙碌的名字服务器更大的可能在所有开放时间把这些记录放在他们的高速缓存中. 
    查询超时而又没有打补丁的qmail将会试着去查询CNAME记录. </P>
  <P>一个更好的测试方式是发送邮件到nosuchuser@large-mx.ckdhr.com这里; 如果邮件被清除出了你的邮件队列, 并且从ckdhr.com反弹信息给你, 
    就表明你的MTA可以发送邮件给拥有超过512字节MX列表记录的主机. (如果使用单一查询项目, 在意个TTL生命期中, 尽管查询结果超过了512字节, 
    可是由于单一查询不依赖于定时和排序, 这个问题将不会被表现出来) </P>
  <H2><A name=queue_extra>E.3. QUEUE_EXTRA 是什么? </A></H2>
  <P>QUEUE_EXTRA是一个编译时的配置参数, 用它来确定每个邮件传送的一个附加的接收者. 这个参数首先用于日志记录. 例如, FAQ里面描述的如何使用QUEUE_EXTRA来保存所有的进出邮件. 
    </P>
  <P>要使用QUEUE_EXTRA, 编辑 extra.h 使用"T<I>recipient</I>\0"这个格式确定附加的接收者, 
    QUEUE_EXTRA的长度由QUEUE_EXTRALEN确定(&quot;\0&quot;算成一个字符). 举一个例子: 
  </P>
<PRE>    #define QUEUE_EXTRA "Tlog\0"
    #define QUEUE_EXTRALEN 5
</PRE>
  <P>关掉正在运行的qmail. 如果你按照本文安装顺序, 运行下面的命令: </P>
<PRE>    qmailctl stop
</PRE>
  <P>如果你没有qmailctl脚本, 你可以使用你的 启动/关闭 脚本, 或者给qmail-send发送一个TERM信号.</P>
  <P>然后重编译qmail, 使用命令: </P>
<PRE>    make setup check
</PRE>
  <P>设置 ~alias/.qmail-log 来定义你想要记录的内容. 比如, 需要记录邮件 ID(Message-ID), 那么就这样编写这个文件内容: 
  </P>
<PRE>    | awk '/^$/ { exit } /^[mM][eE][sS][sS][aA][gG][eE]-/ { print }'
</PRE>
  <P>最后, 重新启动qmail. </P>
<HR>

  <H1><A name=error-messages>附录 F. 错误讯息 </A></H1>
  <P>qmail的错误讯息以及他们的含义. </P>
  <P>参见 <A href="#rfcs">RFC 1893</A> 标准文档内括号内每个错误信息的说明部分.</P>
  <P><I>这个附录时不完整的. </I></P>
<HR>

  <H1><A name=gotchas>附录 G. 新手常见问题(Gotchas) </A></H1>
  <P>这个&quot;gotchas&quot; 经常给qmail新手带来问题. </P>
  <H2><A name=root-delivery>G.1. qmail 不能给超级用户发邮件. <I> </I></A></H2>
  <P>为了防止qmail-local以特权用户运行命令的可能性, qmail忽略所有UID是0的用户. 这个文档请看 qmail-getpw 的 man 手册页. 
  </P>
  <P>不过这并不意味着qmail不能给root用户传送邮件, 只是邮件传送必须由一个非特权用户来执行. 典型情况, 为root用户创建一个系统别名文件 ~alias/.qmail-root. 
  </P>
  <H2><A name=home-dir-ownership>G.2. qmail不能给没有主目录的用户发邮件. </A></H2>
  <P>这是另外一个安全特色, 也是一个新手的很好的练习机会. 看看 qmail-getpw的man 手册页面找答案吧. </P>
  <H2><A name=uppercase-usernames>G.3. qmail 不能给名字里面含有大写字符的用户投递邮件. </A></H2>
  <P>qmail 将整个&quot;本地部分&quot; -- 邮件地址中&quot;@&quot; 符号左面的所有部分转换为小写. man 手册页面里面没有提到和表示, 
    不过代码里面有相关表示. 实际上在qmail-getpw 的 man 手册页面里面有关于qmail忽略使用大写字符名字用户的文档.</P>
  <H2><A name=dots-in-extensions>G.4. qmail处理扩展地址的时候, 用冒号(:)替换掉了点(.). </A></H2>
  <P>这是qmail另一个安全特色. 是为了防止扩展地址里面&quot;..&quot;和文件树冲突, 点(.)置换为冒号(:)之后, qmail就可以确定使用的每个用户的所有 
    .qmail 文件都位于他们的主目录下面. 这个问题存档于 dot-qmail 的 man 手册页里面. </P>
  <H2><A name=uppercase-in-extensions>G.5. qmail 处理扩展地址的时候把大写字符转换成了小写字符. <I> </I></A></H2>
  <P>这是另外一个qmail转换地址的整个部分为小写字符的后果. 文档参见 dot-qmail 的 man 手册页. </P>
  <H2><A name=etc-hosts>G.6. qmail 不使用 /etc/hosts 文件<I> </I></A></H2>
  <P><I>qmail <strong>从不</strong>使用 /etc/hosts 来确定一个主机名关联的IP地址. 如果你在控制文件内使用主机名而不是IP地址, 
    qmail必须能够访问名字服务器. </I></P>
  <P>即使在没有名字服务器的情况下, 也可以运行qmail, 在control 文件内的主机由 IP 地址确定, IP地址两边必须加上方括号([ ]). 例如: 
  </P>
<PRE>    [10.1.2.219]
</PRE>
  <P>实际上, 方括号不总是必要的--不过用上它们无论如何是恰当的. </P>
  <H2><A name=no-smtp-logging>G.7. qmail 不在日志记录 SMTP 的活动.<I> </I></A></H2>
  <P>由于很多原因, qmail 并不记录 SMTP 的连接, 拒绝, 非法命令, 或者有效命令, tcpserver可以用来记录连接, recordio 
    可以用来记录整个 SMTP 对话. recordio 是 <I><A 
href="#ucspi-tcp">ucspi-tcp</A></I> 的一部分. 这个过程存档在FAQ里面. 可以在这个地址 <A 
href="http://cr.yp.to/qmail/faq/servers.html#recordio">http://cr.yp.to/qmail/faq/servers.html#recordio</A> 
    访问到它. </P>
  <H2><A name=deferral-notices>G.8. qmail 不生成邮件延迟通知. </A></H2>
  <P>如果在几个小时内 Sendmail 无法传递邮件, 代表性的是4个小时, 它就会发送一个邮件延迟通知给邮件原始发送者. 这个通知有点像反弹邮件, 不过还不表示邮件传送永久失败了. 
  </P>
  <P>qmail 并不发送这样的警告. 未发送邮件在队列内等待发送直到超过 queuelifetime 规定的时间后还能发送, 才会被反弹给邮件原始发送者. 
  </P>
  <H2><A name=trigger>G.9. qmail 由于/var/qmail/queue/lock/trigger 文件丢失、权限设置错误或者错误的文件属性设置等原因变的很慢<I> 
    </I></A></H2>
  <P>qmail-queue 和 qmail-send 使用一个称作 /var/qmail/queue/lock/trigger 的命名管道进行通讯. 
    如果这个管道陷入混乱, qmail-send 将在大约半个小时内无法注意到新邮件.</P>
  <P>最好的方式是正确设置qmail, 在源代码目录下使用&quot;make check&quot;命令检查. 如果不能这样作, 那么像下面这样确定一下: 
  </P>
<PRE># ls -l /var/qmail/queue/lock/trigger
prw--w--w-   1 qmails   qmail           0 Jul  5 21:25 /var/qmail/queue/lock/trigger
</PRE>
  <P>特别注意那一行开头的&quot;p&quot;(表明这是一个命名管道), 状态(特别是任意用户可写状态), 以及用户和用户组的归属. </P>
  <H2><A name=smtp-slow>G.10. DNS 或者 IDENT 查询使 SMTP 变慢 </A></H2>
  <P>如果 qmail-smtpd 对连接的反应变慢, 原因可能使由于DNS反相查询或者 IDENT 查询. 如果你 使用 tcpserver 运行 qmail-smtpd, 
    删除 &quot;-h&quot;, &quot;-p&quot;, 和 &quot;-r&quot; 选项, 并增加 "-H", "-P", "-R", 
    和 "-l <I>hostname</I>" 选项. </P>
  <P>参看 <A 
href="http://cr.yp.to/ucspi-tcp/tcpserver.html">http://cr.yp.to/ucspi-tcp/tcpserver.html</A> 
    这里的 tcpserver 的文档查看这些选项的说明. </P>
  <H2><A name=cr>G.11. 回车(Carriage Return)和换行(CRLF)不同 </A></H2>
  <P>qmail-inject 和其他本地注入机制比如 sendmail 不能正确接受DOS风格的回车/换行符. 不像 Sendmail, qmail 要求本地注入邮件使用 
    Unix 换行(只有 LF). 这和PHP 脚本遇到的问题一样.</P>
  <H2><A name=log-block>G.12. 日志回滚造成qmail-send 和 tcpserver 停止 </A></H2>
  <P>如果你使用第二节描述的受到监控的日志服务, 日志服务将会因为以下任何原因停止: 磁盘满, run 脚本打字错误, 日志目录配置错误, 等等. 而管道将被填满, 
    导致服务被阻塞, 或者被挂起. 解决这个问题(参看 <a href="#troubleshooting">故障处理</a>)之后, 所有部分都会恢复正常. 
  </P>
  <H2><A name=smtp-rejection>G.13. qmail-smtpd 不能使地址的本地部分生效 </A></H2>
  <P>假如 example.com 被列入control/rcpthosts 文件, 发给 anything@example.com 的邮件在SMTP会话期间将会被接受. 
    如果 anything 不是一个合法用户或者别名, qmail 将发送一个反弹邮件给信封上的发送者地址.</P>
  <P>一些单纯的转信测试假设如果邮件被接受, 那么一定会被传送, 这是错的. 如果某人宣称你的系统使开放转信的, 你要查看通过转信的邮件的副本--包括完整的邮件头, 
    特别是 Received 部分--比较一下这些部分和你的日志记录. </P>
  <H2><A name=firewalls>G.14. 设置防火墙导致远程无法连接 SMTP/POP3/IMAP 服务器 </A></H2>
  <P>如果安装了 SMTP, POP3 和 IMAP 服务器, 你可以在本机或者本地网络的主机连接到这些服务器, 但是无法从远程服务器连接, 很有可能是防火墙的问题.</P>
  <P>第一个查看的地方是服务器本身. 举例, Red Hat Linux, 使用 iptables 在默认配置下是阻塞 SMTP 服务的. 其他包过滤机制比如 
    ipchains 也会和这个问题有关系. </P>
  <P>也有可能是你的因特网服务提供商 (ISP) 阻塞了某些端口来防止垃圾邮件骚扰或者强制执行他们的服务条款(Terms of Service, TOS). 
    确认不是包过滤的原因以及你没有违反ISP的服务条款(TOS)之后, 可以联系你的ISP的技术支持解决问题. </P>
  <H2><A name=anonymous>G.15. 如果USER 和 LOGNAME 没有设置的话, qmail-inject 将设置邮件发送方字段(From)为匿名(anonymous) 
    </A></H2>
  <P>如果通过 qmail-inject 发送邮件, 并且邮件不包括 From 字段, qmail-inject 将查找环境变量来得知是那个用户发送的邮件. 
    查找变量的顺序为: QMAILUSER, MAILUSER, USER, 然后 LOGNAME. 
  </P>
  <P>普通用户登录期间通常要设置USER和LOGNAME变量, 不过某些批处理任务, 比如以 cron 执行的任务, 将不会设置这两个环境变量. </P>
  <P>为了使你的 cron 任务发送的邮件有一个合法的 From 字段, 请在发信之前设置一个环境变量就可以了. </P>
<HR>
  <H1><A name=lwq-faq>附录 H. 关于本文 <U>Life with qmail</U> 的常见话题 </A></H1>
  <H2><A name=lwq-version>H.1. 这个 <U>Life with qmail</U> 的版本是多少? </A></H2>
  <P>这是LWQ 2003年02月23日的英文版本(翻译). </P>
  <H2><A name=lwq-copyright>H.2. 谁拥有 <U>Life with qmail</U>? </A></H2>
<P>版权所有1999-2003, David E. Sill</P>
<P>网址:<A 
href="http://web.infoave.net/~dsill/dave.html">http://Web.InfoAve.Net/~dsill/dave.html</A></P>
  <P> <U> </U></P>
<H2><A name=lwq-license>H.3. <U>Life with qmail</U> 的版权信息? How is <U>Life with 
  qmail</U> licensed?</A></H2>
  <P><U>Life with qmail</U> 使用OpenContent 1.0 版本许可证, <U>参见 <A 
href="http://www.opencontent.org/opl.shtml">http://www.opencontent.org/op</A></U><A 
href="http://www.opencontent.org/opl.shtml">l.shtml</A> 查看完整的版权许可证. 基本上, 你可以拷贝, 
    再发布, 或者修改 <U>Life with qmail</U> , 只要是重建的版本, 如果重发布, 也需要在 OpenContent 的版权许可证规定范围内.</P>
  <H2><A name=lwq-announce-list>H.4. 我怎么取得新版 LWQ 的发布通知? </A></H2>
  <P>发送邮件到 <A 
href="mailto:lwq-announce-subscribe@sws1.ctd.ornl.gov">lwq-announce-subscribe@sws1.ctd.ornl.gov</A> 
    加入 lwq-announce 邮件列表. </P>
  <H2><A name=lwq-list>H.5. 在哪里可以为 LWQ 投稿, 捐助以及讨论它? </A></H2>
  <P>发送邮件到 <A 
href="mailto:lwq-subscribe@sws1.ctd.ornl.gov">lwq-subscribe@sws1.ctd.ornl.gov</A> 
    加入lwq邮件列表. </P>
  <H2><A name=lwq-translations>H.6. <u>Life with qmail</u> 被翻译成其他语言了吗? </A></H2>
  <P>或许LWQ已经被翻译成了几种语言. 参见 <A 
href="http://lifewithqmail.org/trans.html">http://lifewithqmail.org/trans.html</A> 
    查看更多关于LWQ的翻译消息. </P>
  <H2><A name=lwq-formats>H.7. <u>Life with qmail</u> 有没有 PostScript, PDF, plain 
    text, 或者其他任何除了HTML的格式? </A></H2>
  <P>有的, 其他格式的可以在这里 <A 
href="http://lifewithqmail.org/">http://lifewithqmail.org/</A> 取得. </P>
  <H2><A name=lwq-warranty>H.8. 我按照 Life with qmail 说的作了, 可是我的系统崩溃了, 或者弄坏了我的硬盘, 
    或者毁了我的爱情, 或者弄死了我的狗, 等等问题, 我该怎么办? <font color="#FF00FF" size="-1">(这属于老外的幽默啦. 
    ^_^, 译者注)</font> </A></H2>
  <P>我很抱歉, 真的很抱歉. 可是使用 <U>Life with qmail</U> 是没有任何担保的. 请参考上面提到的 OpenContent 版权许可证. 
    我不是为了赚钱才写<U>Life with qmail</U> 的, 我只是想为 qmail 社区作出一些有益的贡献. </P>
  <P>其实, <U>Life with qmail</U> 并不是一个FAQ, 反而我希望这是个 NAQ (Never Asked Question). </P>
  <H2><A name=contributions>H.9. 我怎么为 LWQ捐赠和投稿? </A></H2>
  <P>请把对 LWQ 的修正意见, 建议以及抱怨等等发送到 <a href="mailto:lwq@sill.org">lwq@sill.org</a>. 
  </P>
  <P>如果你想要作更大的投稿, 比如, 比如文章的新的小部分或者附录, 那太棒了! 首先请和我协商以便确认哪些我想要在LWQ里面添加的内容还有就是核实是否已经有人在作同样的工作了. 
  </P>
  <P>如果你喜欢捐赠现金, 这个一直都是最受欢迎的 :-) 请联系我然后作安排, 或者使用 PayPal 电子支付系统. 使用 PayPal, 你可以&quot;瞬间&quot;把电子货币发送到我的电子邮件地址 
    paypal@dave.sill.org 上, 总计最小份额 0.01 美金, 而且你和我都没有任何其他花销--甚至使用信用卡转帐. 
    如果你用这个 <A 
href="https://secure.paypal.com/refer/pal=paypal@dave.sill.org">https://secure.paypal.com/refer/pal=paypal@dave.sill.org</A> 
    链接签约, 哪我还能得到推荐提成. </P>
  <P>其他免费支持LWQ的方式是在 Amazon.com 购物的时候使用这个链接 <A 
href="http://www.amazon.com/exec/obidos/redirect-home/davesill">http://www.amazon.com/exec/obidos/redirect-home/davesill</A> 
    . </P>
  <A 
href="http://www.opencontent.org/"><IMG 
src="http://www.opencontent.org/takeone.gif" alt="Take One!" width="85" height="33" border=0></A> 
</DIV>
<DIV class=footer>
<DIV class=navigate></DIV></DIV></BODY></HTML>
